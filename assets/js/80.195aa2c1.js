(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{778:function(s,a,t){"use strict";t.r(a);var n=t(5),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"使用go-zero构建微服务项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用go-zero构建微服务项目"}},[s._v("#")]),s._v(" 使用go-zero构建微服务项目")]),s._v(" "),t("h2",{attrs:{id:"前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),t("p",[s._v("这里我们首先以书店服务作为示例，并且只实现其中的增加书目和检查价格功能，写此书店服务是为了整体上演示go-zero构建完整微服务的过程，实现细节尽可能简化")]),s._v(" "),t("p",[s._v("此外，秉承着工具大于约定和文档的理念，尽可能减少开发人员的心智负担，把精力投入到产生业务价值的代码上，减少重复代码的编写，因此开发了 goctl 工具")]),s._v(" "),t("h2",{attrs:{id:"书店微服务架构图"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#书店微服务架构图"}},[s._v("#")]),s._v(" 书店微服务架构图")]),s._v(" "),t("p",[s._v("首先请求过来后，通过的是网关，然后在请求各自的 Add服务 和 Check服务")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/image-20201112211825959.png",alt:"image-20201112211825959"}})]),s._v(" "),t("h2",{attrs:{id:"goctl各层代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#goctl各层代码"}},[s._v("#")]),s._v(" goctl各层代码")]),s._v(" "),t("p",[s._v("所有绿色背景的功能模块都是自动生成的，按需激活，红色模块是需要自己写的，也就是增加下依赖、编写业务特有逻辑，各层示意图分别如下")]),s._v(" "),t("h3",{attrs:{id:"网关"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#网关"}},[s._v("#")]),s._v(" 网关")]),s._v(" "),t("p",[s._v("网关是所有请求的入口，在这里可以进行如下的操作")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/image-20201112212113852.png",alt:"image-20201112212113852"}})]),s._v(" "),t("h3",{attrs:{id:"rpc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rpc"}},[s._v("#")]),s._v(" RPC")]),s._v(" "),t("p",[s._v("RPC被称为远程过程调用")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/image-20201112212124771.png",alt:"image-20201112212124771"}})]),s._v(" "),t("h3",{attrs:{id:"model"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#model"}},[s._v("#")]),s._v(" Model")]),s._v(" "),t("p",[s._v("model是模型层")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/image-20201112212325244.png",alt:"image-20201112212325244"}})]),s._v(" "),t("h2",{attrs:{id:"准备工作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),t("h3",{attrs:{id:"安装软件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装软件"}},[s._v("#")]),s._v(" 安装软件")]),s._v(" "),t("p",[s._v("通过上面的架构图我们发现，我们使用到了 etcd、mysql、redis，因此我们首先需要安装如下服务")]),s._v(" "),t("h3",{attrs:{id:"安装-protoc-gen-go-工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-protoc-gen-go-工具"}},[s._v("#")]),s._v(" 安装 protoc-gen-go 工具")]),s._v(" "),t("p",[s._v("然后在安装 protoc-gen-go")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置代理")]),s._v("\ngo "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("env")]),s._v(" -w "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GO111MODULE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on\ngo "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("env")]),s._v(" -w "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOPROXY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://goproxy.cn/,direct\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载")]),s._v("\ngo get -u github.com/golang/protobuf/protoc-gen-go\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"安装-goctl工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-goctl工具"}},[s._v("#")]),s._v(" 安装 goctl工具")]),s._v(" "),t("p",[s._v("goctl工具主要用于代码生成")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("go get -u github.com/tal-tech/go-zero/tools/goctl\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"创建目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建目录"}},[s._v("#")]),s._v(" 创建目录")]),s._v(" "),t("p",[s._v("安装完成后，我们就创建 bookstore 目录，然后执行下面代码，初始化go mod依赖管理")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 初始化go mod")]),s._v("\ngo mod init bookstore\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"编写api-gateway代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写api-gateway代码"}},[s._v("#")]),s._v(" 编写API Gateway代码")]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("bookstore/api")]),s._v(" 目录下通过goctl生成 "),t("code",[s._v("api/bookstore.api")])]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("goctl api -o bookstore.api\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("编辑"),t("code",[s._v("bookstore.api")]),s._v("，为了简洁，去除了文件开头的"),t("code",[s._v("info")]),s._v("，代码如下：")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\taddReq "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tbook  "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('`form:"book"`')]),s._v("\n\t\tprice "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int64")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('`form:"price"`')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\taddResp "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tok "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bool")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('`json:"ok"`')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\tcheckReq "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tbook "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('`form:"book"`')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\tcheckResp "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tfound "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bool")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('`json:"found"`')]),s._v("\n\t\tprice "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int64")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('`json:"price"`')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nservice bookstore"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("api "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t@"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t\thandler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" AddHandler\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tget "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("addReq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("returns")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("addResp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\t@"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t\thandler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CheckHandler\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tget "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("check")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("checkReq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("returns")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("checkResp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br")])]),t("ul",[t("li",[t("p",[s._v("type用法和go一致，service用来定义get/post/head/delete等api请求，解释如下：")])]),s._v(" "),t("li",[t("ul",[t("li",[t("code",[s._v("service bookstore-api {")]),s._v("   这一行定义了service名字")])])]),s._v(" "),t("li",[t("ul",[t("li",[t("code",[s._v("@server")]),s._v(" 部分用来定义server端用到的属性")])])]),s._v(" "),t("li",[t("ul",[t("li",[t("code",[s._v("handler")]),s._v("定义了服务端handler名字")])])]),s._v(" "),t("li",[t("ul",[t("li",[t("code",[s._v("get /add(addReq) returns(addResp)")]),s._v("定义了get方法的路由、请求参数、返回参数等")])])])]),s._v(" "),t("p",[s._v("使用goctl生成API Gateway代码")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("goctl api go -api bookstore.api -dir "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("生成的文件结构如下：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("api\n├── bookstore.api                  // api定义\n├── bookstore.go                   // main入口定义\n├── etc\n│   └── bookstore-api.yaml         // 配置文件\n└── internal\n    ├── config\n    │   └── config.go              // 定义配置\n    ├── handler\n    │   ├── addhandler.go          // 实现addHandler\n    │   ├── checkhandler.go        // 实现checkHandler\n    │   └── routes.go              // 定义路由处理\n    ├── logic\n    │   ├── addlogic.go            // 实现AddLogic\n    │   └── checklogic.go          // 实现CheckLogic\n    ├── svc\n    │   └── servicecontext.go      // 定义ServiceContext\n    └── types\n        └── types.go               // 定义请求、返回结构体\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("p",[s._v("启动API Gateway服务，默认侦听在8888端口")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("go run bookstore.go -f etc/bookstore-api.yaml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("启动完成后，我们使用如下命令来测试API Gateway服务")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:8888/check?book=go-zero"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("返回结果如下")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("HTTP/1.1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\nContent-Type: application/json\nDate: Thu, 03 Sep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" 06:46:18 GMT\nContent-Length: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"found"')]),s._v(":false,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"price"')]),s._v(":0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[t("p",[s._v("可以看到我们API Gateway其实啥也没干，就返回了个空值，接下来我们会在rpc服务里实现业务逻辑")])]),s._v(" "),t("li",[t("p",[s._v("可以修改"),t("code",[s._v("internal/svc/servicecontext.go")]),s._v("来传递服务依赖（如果需要）")])]),s._v(" "),t("li",[t("p",[s._v("实现逻辑可以修改"),t("code",[s._v("internal/logic")]),s._v("下的对应文件")])]),s._v(" "),t("li",[t("p",[s._v("可以通过"),t("code",[s._v("goctl")]),s._v("生成各种客户端语言的api调用代码")])]),s._v(" "),t("li",[t("p",[s._v("到这里，你已经可以通过goctl生成客户端代码给客户端同学并行开发了，支持多种语言，详见文档")])])]),s._v(" "),t("h2",{attrs:{id:"编写add-rpc服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写add-rpc服务"}},[s._v("#")]),s._v(" 编写add rpc服务")]),s._v(" "),t("p",[s._v("在"),t("code",[s._v("rpc/add")]),s._v("目录下编写"),t("code",[s._v("add.proto")]),s._v("文件，可以通过命令生成proto文件模板")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("goctl rpc template -o add.proto\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("修改文件内容如下")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("syntax "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"proto3"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\npackage "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmessage addReq "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    string book "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    int64 price "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nmessage addResp "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    bool ok "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" adder "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    rpc add"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("addReq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" returns"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("addResp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("用"),t("code",[s._v("goctl")]),s._v("生成rpc代码，在"),t("code",[s._v("rpc/add")]),s._v("目录下执行命令")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("goctl rpc proto -src add.proto\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("生成的目录结构如下")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("rpc/add\n├── add.go                      // rpc服务main函数\n├── add.proto                   // rpc接口定义\n├── adder\n│   ├── adder.go                // 提供了外部调用方法，无需修改\n│   ├── adder_mock.go           // mock方法，测试用\n│   └── types.go                // request/response结构体定义\n├── etc\n│   └── add.yaml                // 配置文件\n├── internal\n│   ├── config\n│   │   └── config.go           // 配置定义\n│   ├── logic\n│   │   └── addlogic.go         // add业务逻辑在这里实现\n│   ├── server\n│   │   └── adderserver.go      // 调用入口, 不需要修改\n│   └── svc\n│       └── servicecontext.go   // 定义ServiceContext，传递依赖\n└── pb\n    └── add.pb.go\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[s._v("直接可以运行，如下")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ go run add.go -f etc/add.yaml\nStarting rpc server at "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:8080"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("code",[s._v("etc/add.yaml")]),s._v("文件里可以修改侦听端口等配置")]),s._v(" "),t("h2",{attrs:{id:"编写check-rpc服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#编写check-rpc服务"}},[s._v("#")]),s._v(" 编写check rpc服务")]),s._v(" "),t("p",[s._v("在"),t("code",[s._v("rpc/check")]),s._v("目录下编写"),t("code",[s._v("check.proto")]),s._v("文件，可以通过命令生成proto文件模板")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("goctl rpc template -o check.proto\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("修改后文件内容如下：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("syntax "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"proto3"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\npackage check"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmessage checkReq "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    string book "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nmessage checkResp "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    bool found "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    int64 price "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" checker "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    rpc check"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("checkReq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" returns"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("checkResp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("用 "),t("code",[s._v("goctl")]),s._v(" 生成rpc代码，在 "),t("code",[s._v("rpc/check")]),s._v(" 目录下执行命令：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("goctl rpc proto -src check.proto\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("文件结构如下：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("rpc/check\n├── check.go                    // rpc服务main函数\n├── check.proto                 // rpc接口定义\n├── checker\n│   ├── checker.go              // 提供了外部调用方法，无需修改\n│   ├── checker_mock.go         // mock方法，测试用\n│   └── types.go                // request/response结构体定义\n├── etc\n│   └── check.yaml              // 配置文件\n├── internal\n│   ├── config\n│   │   └── config.go           // 配置定义\n│   ├── logic\n│   │   └── checklogic.go       // check业务逻辑在这里实现\n│   ├── server\n│   │   └── checkerserver.go    // 调用入口, 不需要修改\n│   └── svc\n│       └── servicecontext.go   // 定义ServiceContext，传递依赖\n└── pb\n    └── check.pb.go\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("p",[t("code",[s._v("etc/check.yaml")]),s._v("文件里可以修改侦听端口等配置，需要修改"),t("code",[s._v("etc/check.yaml")]),s._v("的端口为"),t("code",[s._v("8081")]),s._v("，因为"),t("code",[s._v("8080")]),s._v("已经被"),t("code",[s._v("add")]),s._v("服务使用了，直接可以运行，如下")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ go run check.go -f etc/check.yaml\nStarting rpc server at "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:8081"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"修改api-gateway代码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改api-gateway代码"}},[s._v("#")]),s._v(" 修改API Gateway代码")]),s._v(" "),t("p",[s._v("修改API Gateway代码调用add/check rpc服务")]),s._v(" "),t("p",[s._v("我们现在需要修改的就是配置文件，"),t("code",[s._v("/etc/bookstore-api.yaml")]),s._v("，增加如下内容")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Etcd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" add.rpc\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Check")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Etcd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Hosts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2379")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" check.rpc\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("通过etcd自动去发现可用的add /check服务")]),s._v(" "),t("p",[s._v("修改 "),t("code",[s._v("internal/config/config.go")]),s._v(" ，增加 add/check 服务依赖")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" Config "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    rest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("RestConf\n    Add   zrpc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("RpcClientConf     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 手动代码")]),s._v("\n    Check zrpc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("RpcClientConf     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 手动代码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("修改"),t("code",[s._v("internal/svc/servicecontext.go")]),s._v("，如下：")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" ServiceContext "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    Config  config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Config\n    Adder   adder"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Adder          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 手动代码")]),s._v("\n    Checker checker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Checker      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 手动代码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewServiceContext")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("ServiceContext "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("ServiceContext"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        Config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        Adder"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("   adder"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewAdder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("zrpc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("MustNewClient")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Add"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 手动代码")]),s._v("\n        Checker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" checker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewChecker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("zrpc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("MustNewClient")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Check"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 手动代码")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("通过ServiceContext在不同业务逻辑之间传递依赖,修改"),t("code",[s._v("internal/logic/addlogic.go")]),s._v("里的"),t("code",[s._v("Add")]),s._v("方法，如下：")]),s._v(" "),t("h2",{attrs:{id:"来源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#来源"}},[s._v("#")]),s._v(" 来源")]),s._v(" "),t("p",[s._v("https://www.yuque.com/tal-tech/go-zero/rm435c")])])}),[],!1,null,null,null);a.default=e.exports}}]);