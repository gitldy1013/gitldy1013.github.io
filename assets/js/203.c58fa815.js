(window.webpackJsonp=window.webpackJsonp||[]).push([[203],{900:function(s,a,e){"use strict";e.r(a);var t=e(5),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"vue中防止xss脚本攻击"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#vue中防止xss脚本攻击"}},[s._v("#")]),s._v(" Vue中防止XSS脚本攻击")]),s._v(" "),e("p",[s._v("最近写了一个博客评论模块，因为引入了表情包，所以就将原来的v-text的形式，改成了v-html，也就是渲染html标签，但是这样不可不免的会带来问题，就是XSS跨站脚本攻击")]),s._v(" "),e("p",[s._v("XSS解决方案官网："),e("a",{attrs:{href:"https://jsxss.com/zh/index.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("点我传送"),e("OutboundLink")],1)]),s._v(" "),e("h2",{attrs:{id:"xss脚本攻击"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#xss脚本攻击"}},[s._v("#")]),s._v(" XSS脚本攻击")]),s._v(" "),e("p",[s._v("跨站脚本攻击缩写为XSS。恶意攻击者往Web页面里插入恶意Script代码，当用户浏览该页面时，嵌入Web里面的Script代码会被执行，从而达到恶意攻击用户的目的。XSS攻击针对的是用户层面的攻击！")]),s._v(" "),e("p",[s._v("例如我在评论框输入以下内容")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("<a onclick='let count=10;while(count>0){alert(\"xss攻击\");count=count-1;}'>链接</a>\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("这个时候评论就会出现一个超链接")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20200430090311752.png",alt:"image-20200430090311752"}})]),s._v(" "),e("p",[s._v("只要我们点击这个链接后，就会出现一个alert弹框")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20200430090351946.png",alt:"image-20200430090351946"}})]),s._v(" "),e("p",[s._v("上面代码因为写的的是循环10次后，alert消失，但是如果是"),e("code",[s._v("while(true)")]),s._v("，那么后果不堪设想，会进入无止无休的弹框")]),s._v(" "),e("h2",{attrs:{id:"解决xss脚本攻击"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解决xss脚本攻击"}},[s._v("#")]),s._v(" 解决XSS脚本攻击")]),s._v(" "),e("p",[s._v("首先需要安装"),e("code",[s._v("xss")]),s._v("模块")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("npm install xss --save\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("然后在"),e("code",[s._v("main.js")]),s._v("中引入")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("import xss from 'xss'\n// 定义全局XSS解决方法\nObject.defineProperty(Vue.prototype, '$xss', {\n  value: xss\n})\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("然后针对需要渲染的页面，调用"),e("code",[s._v("$xss()")]),s._v("方法")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('<div class="rightCenter" v-html="$xss(item.content)"></div>\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("我们在点击刚刚的页面，发现已经不会有弹框了，但是有出来了新的问题，就是我引入的标签也被过滤了")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20200430092519608.png",alt:"image-20200430092519608"}})]),s._v(" "),e("p",[s._v("引入xss后")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20200430092619240.png",alt:"image-20200430092619240"}})]),s._v(" "),e("p",[s._v("这个时候，我们就需要自定义拦截规则了，我们在data中添加如下配置，下面是自定义白名单，也就是什么标签以及标签的属性能够正常使用，其它的都会被拦截")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("    data() {\n      return {\n        // xss白名单配置\n        options : {\n          whiteList: {\n            a: ['href', 'title', 'target'],\n            span: ['class']\n          }\n        }\n      };\n    },\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("然后在使用的时候，增加option配置")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('<div class="rightCenter" v-html="$xss(item.content, options)"></div>\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("这个时候，表情已经成功显示了，并且原来的脚本攻击也不生效，达到了我们的目的~")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20200430092858561.png",alt:"image-20200430092858561"}})])])}),[],!1,null,null,null);a.default=n.exports}}]);