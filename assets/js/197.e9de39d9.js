(window.webpackJsonp=window.webpackJsonp||[]).push([[197],{894:function(s,a,e){"use strict";e.r(a);var n=e(5),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"elementui中upload组件如何批量上传"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#elementui中upload组件如何批量上传"}},[s._v("#")]),s._v(" ElementUI中Upload组件如何批量上传")]),s._v(" "),e("h2",{attrs:{id:"前言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),e("p",[s._v("最近一直使用Element提供的文件上传组件，但是使用后发现，其实当我们批量选中的时候，文件不是一次性都上传进去的，而是把它又拆分成一个个的文件进行上传。首先这容易造成的问题就是我们如果同时提交多个图片文件的时候，会重复的请求接口，造成接口并发访问的时可能出现的问题，下面是Element 的Github写的一个Issue")]),s._v(" "),e("p",[s._v("地址："),e("a",{attrs:{href:"https://github.com/ElemeFE/element/issues/15036",target:"_blank",rel:"noopener noreferrer"}},[s._v("Element"),e("OutboundLink")],1)]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20200411115231912.png",alt:"image-20200411115231912"}})]),s._v(" "),e("p",[s._v("上面也是提出了这个问题，就是希望能够合并请求提交，但是得到的官方回复却是：这个合并提交不在计划内，并不打算支持。")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20200411115319703.png",alt:"image-20200411115319703"}})]),s._v(" "),e("h2",{attrs:{id:"解决方案"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[s._v("#")]),s._v(" 解决方案")]),s._v(" "),e("p",[s._v("后面通过查看issue发现，有一篇能够解决图片合并上传的需求："),e("a",{attrs:{href:"https://github.com/ElemeFE/element/issues/8052",target:"_blank",rel:"noopener noreferrer"}},[s._v("issue"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("主要是定义了两个方法，首先就是我们写的upload组件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('      <el-upload\n        class="upload-demo"\n        ref="uploadFile"\n        name="filedatas"\n        :headers="importHeaders"\n        :action="uploadAdminHost"\n        :auto-upload="false"\n        multiple\n      >\n        <el-button slot="trigger" size="small" type="primary">选取博客文件</el-button>\n        <el-button style="margin-left: 10px;" size="small" type="success" @click="submitUpload">提交到服务器</el-button>\n      </el-upload>\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("p",[s._v("然后我们是上传逻辑，我们首先获取到upload组件上的dom，然后获取文件，上传地址和数据")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("    // 文件上传\n    submitUpload() {\n      let {uploadFiles, action, data} = this.$refs.uploadFile      \n      this.uploadFiles({\n        uploadFiles,\n        data,\n        action,\n        success: (response) => {\n          console.log(response)\n          // 上传成功后，将里面的内容删除\n          this.$refs.uploadFile.clearFiles();\n          this.$refs.uploadPicture.clearFiles();\n        },\n        error: (error) => {\n          console.log('失败了', error)\n        }\n      })\n    },\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("p",[s._v("下面封装了一个 uploadFiles 方法，这里uploadFiles 就可以是多文件，通过封装ajax方式")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('    /**\n     * 自定义上传文件\n     * @param fileList 文件列表\n     * @param data 上传时附带的额外参数\n     * @param url 上传的URL地址\n     * @param success 成功回调\n     * @param error 失败回调\n     */\n    uploadFiles({uploadFiles, headers, data, action, success, error}) {\n      let form = new FormData()\n      // 文件对象\n      uploadFiles.map(file => form.append("filedatas", file.raw))\n      // 附件参数\n      for (let key in data) {\n        form.append(key, data[key])\n      }\n      let xhr = new XMLHttpRequest()\n      // 异步请求\n      xhr.open("post", action, true)\n      // 设置请求头\n      xhr.setRequestHeader("Authorization", getToken());\n      xhr.onreadystatechange = function() {\n        if (xhr.readyState == 4){\n          if ((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304){\n            success && success(xhr.responseText)\n          } else {\n            error && error(xhr.status)\n          }\n        }\n      }\n      xhr.send(form)\n    }\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br")])]),e("p",[s._v("最后后台接口，同时接受多个文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('    @PostMapping("/pictures")\n    public Object uploadPics(HttpServletRequest request, List<MultipartFile> filedatas) {\n          // 逻辑代码\n\t}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("最后我们查看请求，会同时携带多个文件")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20200411172208388.png",alt:"image-20200411172208388"}})]),s._v(" "),e("p",[s._v("并且返回多个上传成功的结果")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20200411172255665.png",alt:"image-20200411172255665"}})])])}),[],!1,null,null,null);a.default=t.exports}}]);