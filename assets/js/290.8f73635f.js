(window.webpackJsonp=window.webpackJsonp||[]).push([[290],{987:function(s,e,a){"use strict";a.r(e);var n=a(5),t=Object(n.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"乐观锁和悲观锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#乐观锁和悲观锁"}},[s._v("#")]),s._v(" 乐观锁和悲观锁")]),s._v(" "),a("h2",{attrs:{id:"乐观锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#乐观锁"}},[s._v("#")]),s._v(" 乐观锁")]),s._v(" "),a("h3",{attrs:{id:"概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[s._v("#")]),s._v(" 概念")]),s._v(" "),a("p",[s._v("乐观锁：顾名思义，就是十分乐观，它总是认为不会出现问题，无论干什么都不去上锁~，如果出现了问题，再次更新值测试，这里使用了version字段。")]),s._v(" "),a("p",[s._v("也就是每次更新的时候同时维护一个version字段")]),s._v(" "),a("h3",{attrs:{id:"乐观锁实现方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#乐观锁实现方式"}},[s._v("#")]),s._v(" 乐观锁实现方式")]),s._v(" "),a("ul",[a("li",[s._v("取出记录时，获取当前的version")]),s._v(" "),a("li",[s._v("更新时，带上这个version")]),s._v(" "),a("li",[s._v("执行更新时，set version = newVersion where version = oldVersion")]),s._v(" "),a("li",[s._v("如果version不对，就更新失败")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('乐观锁：1：先查询，获得版本号 version =1\n\n-- A 线程\nupdate user set name = "陌溪", version = version + 1 \nwhere id = 2 and version = 1\n\n-- B 线程抢先完成，这个时候Version = 2，导致A修改失败\nupdate user set name = "陌溪", version = version + 1 \nwhere id = 2 and version = 1\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"mybatisplus使用乐观锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mybatisplus使用乐观锁"}},[s._v("#")]),s._v(" MybatisPlus使用乐观锁")]),s._v(" "),a("p",[s._v("首先需要在数据库增加version字典，默认为1")]),s._v(" "),a("p",[a("img",{attrs:{src:"/images/image-20200329172158610.png",alt:"image-20200329172158610"}})]),s._v(" "),a("p",[s._v("然后在实体类增加对应的字段")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 乐观锁Version注解\n@Version\nprivate Integer version;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("注册组件，在MybatisPlusConfig中配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 注册乐观锁\n@Bean\npublic OptimisticLockerInterceptor optimisticLockerInterceptor() {\n\treturn new OptimisticLockerInterceptor();\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"悲观锁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#悲观锁"}},[s._v("#")]),s._v(" 悲观锁")]),s._v(" "),a("p",[s._v("顾名思义，就是十分悲观，它总是认为什么时候都会出现问题，无论什么操作都会上锁，再次操作")])])}),[],!1,null,null,null);e.default=t.exports}}]);