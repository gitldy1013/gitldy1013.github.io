(window.webpackJsonp=window.webpackJsonp||[]).push([[416],{1112:function(s,e,a){"use strict";a.r(e);var n=a(5),r=Object(n.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"docker-compose-使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-使用"}},[s._v("#")]),s._v(" Docker Compose 使用")]),s._v(" "),a("h2",{attrs:{id:"术语"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#术语"}},[s._v("#")]),s._v(" 术语")]),s._v(" "),a("p",[s._v("首先介绍几个术语。")]),s._v(" "),a("ul",[a("li",[s._v("服务 ("),a("code",[s._v("service")]),s._v(")：一个应用容器，实际上可以运行多个相同镜像的实例。")]),s._v(" "),a("li",[s._v("项目 ("),a("code",[s._v("project")]),s._v(")：由一组关联的应用容器组成的一个完整业务单元。")])]),s._v(" "),a("p",[s._v("可见，一个项目可以由多个服务（容器）关联而成，"),a("code",[s._v("Compose")]),s._v(" 面向项目进行管理。")]),s._v(" "),a("h2",{attrs:{id:"场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#场景"}},[s._v("#")]),s._v(" 场景")]),s._v(" "),a("p",[s._v("最常见的项目是 web 网站，该项目应该包含 web 应用和缓存。")]),s._v(" "),a("p",[s._v("下面我们用 "),a("code",[s._v("Python")]),s._v(" 来建立一个能够记录页面访问次数的 web 网站。")]),s._v(" "),a("h3",{attrs:{id:"web-应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#web-应用"}},[s._v("#")]),s._v(" web 应用")]),s._v(" "),a("p",[s._v("新建文件夹，在该目录中编写 "),a("code",[s._v("app.py")]),s._v(" 文件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    from flask import Flask\n    from redis import Redis\n    \n    app = Flask(__name__)\n    redis = Redis(host='redis', port=6379)\n    \n    @app.route('/')\n    def hello():\n        count = redis.incr('hits')\n        return 'Hello World! 该页面已被访问 {} 次。\\n'.format(count)\n    \n    if __name__ == \"__main__\":\n        app.run(host=\"0.0.0.0\", debug=True)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h3",{attrs:{id:"dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[s._v("#")]),s._v(" Dockerfile")]),s._v(" "),a("p",[s._v("编写 "),a("code",[s._v("Dockerfile")]),s._v(" 文件，内容为")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('    FROM python:3.6-alpine\n    ADD . /code\n    WORKDIR /code\n    RUN pip install redis flask\n    CMD ["python", "app.py"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"docker-compose-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-yml"}},[s._v("#")]),s._v(" docker-compose.yml")]),s._v(" "),a("p",[s._v("编写 "),a("code",[s._v("docker-compose.yml")]),s._v(" 文件，这个是 Compose 使用的主模板文件。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('    version: \'3\'\n    services:\n    \n      web:\n        build: .\n        ports:\n         - "5000:5000"\n         \n      redis:\n        image: "redis:alpine"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"运行-compose-项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行-compose-项目"}},[s._v("#")]),s._v(" 运行 compose 项目")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    $ docker-compose up\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("此时访问本地 "),a("code",[s._v("5000")]),s._v(" 端口，每次刷新页面，计数就会加 1。")])])}),[],!1,null,null,null);e.default=r.exports}}]);