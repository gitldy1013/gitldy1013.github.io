(window.webpackJsonp=window.webpackJsonp||[]).push([[127],{824:function(s,a,t){"use strict";t.r(a);var e=t(5),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"使用kubeadm-ha脚本一键安装k8s"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用kubeadm-ha脚本一键安装k8s"}},[s._v("#")]),s._v(" 使用kubeadm-ha脚本一键安装K8S")]),s._v(" "),t("h2",{attrs:{id:"前情提示"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前情提示"}},[s._v("#")]),s._v(" 前情提示")]),s._v(" "),t("p",[s._v("以前安装k8s集群的时候使用的是k8s官网的教程 使用的镜像源都是国外的 速度慢就不说了 还有一些根本就下载不动 导致安装失败 最后在群里小伙伴(蘑菇博客交流群/@你钉钉响了)的建议下使用一个开源的一键安装k8s的脚本就好了起来了\nGithub地址：https://github.com/TimeBye/kubeadm-ha")]),s._v(" "),t("h2",{attrs:{id:"环境准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[s._v("#")]),s._v(" 环境准备")]),s._v(" "),t("p",[s._v("官网的安装说明也很简单但是还有些细节还是没有提到 所以我自己照着官网的教程 补充了一些细节")]),s._v(" "),t("h3",{attrs:{id:"硬件系统要求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#硬件系统要求"}},[s._v("#")]),s._v(" 硬件系统要求")]),s._v(" "),t("ul",[t("li",[s._v("Master节点：2C4G +")]),s._v(" "),t("li",[s._v("Worker节点：2C4G +")])]),s._v(" "),t("p",[s._v("使用centos7.7安装请按上面配置准备好3台centos,1台作为Master节点,2台Worker节点")]),s._v(" "),t("p",[s._v("本方式为1主2worker的配置")]),s._v(" "),t("p",[s._v("这是我的各个节点的配置")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("主机名")]),s._v(" "),t("th",[s._v("ip")]),s._v(" "),t("th",[s._v("配置")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("k8s-master")]),s._v(" "),t("td",[s._v("192.168.177.130")]),s._v(" "),t("td",[s._v("2C4G")])]),s._v(" "),t("tr",[t("td",[s._v("k8s-node1")]),s._v(" "),t("td",[s._v("192.168.177.131")]),s._v(" "),t("td",[s._v("2C2G")])]),s._v(" "),t("tr",[t("td",[s._v("k8s-node2")]),s._v(" "),t("td",[s._v("192.168.177.132")]),s._v(" "),t("td",[s._v("2C2G")])])])]),s._v(" "),t("h3",{attrs:{id:"centos准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#centos准备"}},[s._v("#")]),s._v(" centos准备")]),s._v(" "),t("p",[t("code",[s._v("在安装之前需要准备一些基础的软件环境用于下载一键安装k8s的脚本和编辑配置")])]),s._v(" "),t("h4",{attrs:{id:"centos网络准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#centos网络准备"}},[s._v("#")]),s._v(" centos网络准备")]),s._v(" "),t("p",[s._v("安装时需要连接互联网下载各种软件 所以需要保证每个节点都可以访问外网")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" baidu.com\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("建议关闭centos的防火墙")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("systemctl stop firewalld  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl disable firewalld "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl status firewalld \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("同时需要保证各个节点间可以相互ping通")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" 其他节点ip\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"centos软件准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#centos软件准备"}},[s._v("#")]),s._v(" CentOS软件准备")]),s._v(" "),t("p",[s._v("用 "),t("strong",[s._v("ssh")]),s._v(" 连接到 "),t("strong",[s._v("Master")]),s._v(" 节点上安装 Git")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" -y\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"部署k8s前配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署k8s前配置"}},[s._v("#")]),s._v(" 部署k8s前配置")]),s._v(" "),t("h4",{attrs:{id:"下载部署脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#下载部署脚本"}},[s._v("#")]),s._v(" 下载部署脚本")]),s._v(" "),t("p",[s._v("在Master节点clone安装脚本 "),t("a",{attrs:{href:"https://github.com/TimeBye/kubeadm-ha",target:"_blank",rel:"noopener noreferrer"}},[s._v("脚本地址"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("git clone --depth 1 https://github.com/TimeBye/kubeadm-ha\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("进入到下载的部署脚本的目录")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cd kubeadm-ha\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"安装-ansible-运行环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装-ansible-运行环境"}},[s._v("#")]),s._v(" 安装 Ansible 运行环境")]),s._v(" "),t("p",[s._v("在master节点安装Ansible环境")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" ./install-ansible.sh\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"修改安装的配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改安装的配置文件"}},[s._v("#")]),s._v(" 修改安装的配置文件")]),s._v(" "),t("p",[s._v("由于我是一个master两个node的方式构建的centos所以我们需要修改example/hosts.s-master.ip.ini 文件")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" example/hosts.s-master.ip.ini \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("具体要修改的就是ip 和密码 其他的保持默认")]),s._v(" "),t("p",[s._v("我的hosts.s-master.ip.ini 文件预览")]),s._v(" "),t("div",{staticClass:"language-ini line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-ini"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 将所有节点信息在这里填写")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";    第一个字段                  为远程服务器内网IP")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";    第二个字段 ansible_port     为节点 sshd 监听端口")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";    第三个字段 ansible_user     为节点远程登录用户名")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";    第四个字段 ansible_ssh_pass 为节点远程登录用户密码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("all")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("192.168.177.130 ansible_port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('22 ansible_user="root" ansible_ssh_pass="moxi"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("192.168.177.131 ansible_port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('22 ansible_user="root" ansible_ssh_pass="moxi"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("192.168.177.132 ansible_port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('22 ansible_user="root" ansible_ssh_pass="moxi"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 单 master 节点不需要进行负载均衡，lb节点组留空。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("lb")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 注意etcd集群必须是1,3,5,7...奇数个节点")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("etcd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n192.168.177.130\n192.168.177.131\n192.168.177.132\n\n"),t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("kube-master")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n192.168.177.130\n\n"),t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("kube-worker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n192.168.177.130\n192.168.177.131\n192.168.177.132\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 预留组，后续添加master节点使用")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("new-master")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 预留组，后续添加worker节点使用")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("new-worker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 预留组，后续添加etcd节点使用")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("new-etcd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 预留组，后续删除worker角色使用")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("del-worker")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 预留组，后续删除master角色使用")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("del-master")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 预留组，后续删除etcd角色使用")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("del-etcd")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 预留组，后续删除节点使用")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("del-node")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";-------------------------------------- 以下为基础信息配置 ------------------------------------;")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token section"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token section-name selector"}},[s._v("all:vars")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")])]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 是否跳过节点物理资源校验，Master节点要求2c2g以上，Worker节点要求2c4g以上")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("skip_verify_node")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; kubernetes版本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("kube_version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("1.18.14")]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 负载均衡器")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";   有 nginx、openresty、haproxy、envoy  和 slb 可选，默认使用 nginx")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";   为什么单 master 集群 apiserver 也使用了负载均衡请参与此讨论： https://github.com/TimeBye/kubeadm-ha/issues/8")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("lb_mode")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("nginx")]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 使用负载均衡后集群 apiserver ip，设置 lb_kube_apiserver_ip 变量，则启用负载均衡器 + keepalived")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('; lb_kube_apiserver_ip="192.168.56.15"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 使用负载均衡后集群 apiserver port")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("lb_kube_apiserver_port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("8443")]),s._v('"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 网段选择：pod 和 service 的网段不能与服务器网段重叠，")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 若有重叠请配置 `kube_pod_subnet` 和 `kube_service_subnet` 变量设置 pod 和 service 的网段，示例参考：")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";    如果服务器网段为：10.0.0.1/8")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";       pod 网段可设置为：192.168.0.0/18")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";       service 网段可设置为 192.168.64.0/18")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";    如果服务器网段为：172.16.0.1/12")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";       pod 网段可设置为：10.244.0.0/18")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";       service 网段可设置为 10.244.64.0/18")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";    如果服务器网段为：192.168.0.1/16")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";       pod 网段可设置为：10.244.0.0/18")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v(";       service 网段可设置为 10.244.64.0/18")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 集群pod ip段，默认掩码位 18 即 16384 个ip")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("kube_pod_subnet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("10.244.0.0/18")]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 集群service ip段")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("kube_service_subnet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("10.244.64.0/18")]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 分配给节点的 pod 子网掩码位，默认为 24 即 256 个ip，故使用这些默认值可以纳管 16384/256=64 个节点。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("kube_network_node_prefix")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("24")]),s._v('"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; node节点最大 pod 数。数量与分配给节点的 pod 子网有关，ip 数应大于 pod 数。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; https://cloud.google.com/kubernetes-engine/docs/how-to/flexible-pod-cidr")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("kube_max_pods")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("110")]),s._v('"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 集群网络插件，目前支持flannel,calico")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("network_plugin")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("calico")]),s._v('"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; 若服务器磁盘分为系统盘与数据盘，请修改以下路径至数据盘自定义的目录。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; Kubelet 根目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("kubelet_root_dir")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("/var/lib/kubelet")]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; docker容器存储目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("docker_storage_dir")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("/var/lib/docker")]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("; Etcd 数据根目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key attr-name"}},[s._v("etcd_data_dir")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token value attr-value"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token inner-value"}},[s._v("/var/lib/etcd")]),s._v('"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br")])]),t("h4",{attrs:{id:"升级内核"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级内核"}},[s._v("#")]),s._v(" 升级内核")]),s._v(" "),t("p",[s._v("修改完配置文件后建议升级内核")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ansible-playbook -i example/hosts.s-master.ip.ini 00-kernel.yml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("内核升级完毕后重启所有节点 在master node1 node2上执行")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("reboot")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"开始部署k8s"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开始部署k8s"}},[s._v("#")]),s._v(" 开始部署k8s")]),s._v(" "),t("p",[s._v("等待所有的节点重启完成后进入脚本目录")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cd kubeadm-ha\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"执行一键部署命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行一键部署命令"}},[s._v("#")]),s._v(" 执行一键部署命令")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("ansible-playbook -i example/hosts.s-master.ip.ini "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v("-init-cluster.yml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"查看节点运行情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看节点运行情况"}},[s._v("#")]),s._v(" 查看节点运行情况")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("kubectl get nodes\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("等待所有节点ready 即为创建成功")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("NAME             STATUS   ROLES                AGE     VERSION\n192.168.28.128   Ready    etcd,worker          2m57s   v1.18.14\n192.168.28.80    Ready    etcd,master,worker   3m29s   v1.18.14\n192.168.28.89    Ready    etcd,worker          2m57s   v1.18.14\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"集群重置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集群重置"}},[s._v("#")]),s._v(" 集群重置")]),s._v(" "),t("p",[s._v("如果部署失败了，想要重置整个集群【包括数据】，执行下面脚本")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("ansible-playbook -i example/hosts.s-master.ip.ini "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),s._v("-reset-cluster.yml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"部署kuboard"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#部署kuboard"}},[s._v("#")]),s._v(" 部署kuboard")]),s._v(" "),t("h3",{attrs:{id:"安装docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装docker"}},[s._v("#")]),s._v(" 安装Docker")]),s._v(" "),t("p",[s._v("因为我们需要拉取镜像，所以需要在服务器提前安装好Docker，首先配置一下Docker的阿里yum源")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/etc/yum.repos.d/docker.repo"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n[docker-ce-edge]\nname=Docker CE Edge - \\"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$basearch")]),s._v("\nbaseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/7/\\"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$basearch")]),s._v("/edge\nenabled=1\ngpgcheck=1\ngpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg\nEOF")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("然后yum方式安装docker")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum安装")]),s._v("\nyum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看docker版本")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" --version  \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开机自启")]),s._v("\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动docker")]),s._v("\nsystemctl start "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("配置docker的镜像源")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/docker/daemon.json "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('EOF\n{\n  "registry-mirrors": ["https://b9pmyelo.mirror.aliyuncs.com"]\n}\nEOF')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("然后重启docker")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("systemctl restart "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h2",{attrs:{id:"安装kuboard【可选】"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装kuboard【可选】"}},[s._v("#")]),s._v(" 安装Kuboard【可选】")]),s._v(" "),t("h3",{attrs:{id:"简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),t("p",[t("strong",[s._v("Kuboard")]),s._v(" 是一款免费的 "),t("strong",[s._v("Kubernetes")]),s._v(" 图形化管理工具，力图帮助用户快速在 "),t("strong",[s._v("Kubernetes")]),s._v(" 上落地微服务。")]),s._v(" "),t("p",[s._v("Kuboard文档：https://kuboard.cn/")]),s._v(" "),t("h3",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("p",[t("code",[s._v("在master节点执行")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("kubectl apply -f https://kuboard.cn/install-script/kuboard.yaml\nkubectl apply -f https://addons.kuboard.cn/metrics-server/0.3.7/metrics-server.yaml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("查看 Kuboard 运行状态")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("kubectl get pods -l k8s.kuboard.cn/name=kuboard -n kube-system\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("输出结果如下所示。注意：如果是 "),t("code",[s._v("ContainerCreating")]),s._v(" 那么需要等待一会")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("NAME                       READY   STATUS    RESTARTS   AGE\nkuboard-74c645f5df-cmrbc   1/1     Running   0          80s\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"访问kuboard"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#访问kuboard"}},[s._v("#")]),s._v(" 访问Kuboard")]),s._v(" "),t("p",[s._v("Kuboard Service 使用了 NodePort 的方式暴露服务，NodePort 为 32567；您可以按如下方式访问 Kuboard。")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 格式")]),s._v("\nhttp://任意一个Worker节点的IP地址:32567/\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 例如，我的访问地址如下所示")]),s._v("\nhttp://192.168.177.130:32567/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("页面如下所示：")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/image-20210107211525789.png",alt:"image-20210107211525789"}})]),s._v(" "),t("p",[s._v("第一次访问需要输入token 我们获取一下 "),t("strong",[s._v("token")]),s._v("， "),t("code",[s._v("在master节点执行")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl -n kube-system get secret "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$(")]),s._v("kubectl -n kube-system get secret "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" kuboard-user "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $1}'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -o go-template"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{.data.token}}'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" base64 -d"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("获取到的 "),t("strong",[s._v("token")]),s._v("，然后粘贴到框中，我的 "),t("strong",[s._v("token")]),s._v(" 格式如下：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("eyJhbGciOiJSUzI1NiIsImtpZCI6ImY1eUZlc0RwUlZha0E3LWZhWXUzUGljNDM3SE0zU0Q4dzd5R3JTdXM2WEUifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJrdWJvYXJkLXVzZXItdG9rZW4tMmJsamsiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoia3Vib2FyZC11c2VyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiYzhlZDRmNDktNzM0Zi00MjU1LTljODUtMWI5MGI4MzU4ZWMzIiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmUtc3lzdGVtOmt1Ym9hcmQtdXNlciJ9.MujbwGnkL_qa3H14oKDT1zZ5Fzt16pWoaY52nT7fV5B2nNIRsB3Esd18S8ztHUJZLRGxAhBwu-utToi2YBb8pH9RfIeSXMezFZ6QhBbp0n5xYWeYETQYKJmes2FRcW-6jrbpvXlfUuPXqsbRX8qrnmSVEbcAms22CSSVhUbTz1kz8C7b1C4lpSGGuvdpNxgslNFZTFrcImpelpGSaIGEMUk1qdjKMROw8bV83pga4Y41Y6rJYE3hdnCkUA8w2SZOYuF2kT1DuZuKq3A53iLsvJ6Ps-gpli2HcoiB0NkeI_fJORXmYfcj5N2Csw6uGUDiBOr1T4Dto-i8SaApqmdcXg\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("最后即可进入 "),t("strong",[s._v("kuboard")]),s._v(" 的 "),t("strong",[s._v("dashboard")]),s._v(" 界面")]),s._v(" "),t("p",[t("img",{attrs:{src:"/images/image-20210107211713726.png",alt:"image-20210107211713726"}})]),s._v(" "),t("h3",{attrs:{id:"卸载kuboard"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#卸载kuboard"}},[s._v("#")]),s._v(" 卸载Kuboard")]),s._v(" "),t("p",[s._v("当我们 "),t("strong",[s._v("kuboard")]),s._v(" 不想使用的时候，我们就可以直接卸载")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl delete -f https://kuboard.cn/install-script/kuboard.yaml\nkubectl delete -f https://addons.kuboard.cn/metrics-server/0.3.7/metrics-server.yaml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"rancher部署【可选】"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rancher部署【可选】"}},[s._v("#")]),s._v(" Rancher部署【可选】")]),s._v(" "),t("blockquote",[t("p",[s._v("kuboard和rancher建议部署其中一个")])]),s._v(" "),t("h3",{attrs:{id:"helm安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helm安装"}},[s._v("#")]),s._v(" helm安装")]),s._v(" "),t("p",[s._v("使用helm部署rancher会方便很多，所以需要安装helm")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -O http://rancher-mirror.cnrancher.com/helm/v3.2.4/helm-v3.2.4-linux-amd64.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf helm-v3.2.4-linux-amd64.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" linux-amd64/helm /usr/local/bin\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h4",{attrs:{id:"验证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[s._v("#")]),s._v(" 验证")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("helm version\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("输入以下内容说明helm安装成功")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("version.BuildInfo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("Version:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v3.2.4"')]),s._v(", GitCommit:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0ad800ef43d3b826f31a5ad8dfbb4fe05d143688"')]),s._v(", GitTreeState:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"clean"')]),s._v(", GoVersion:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"go1.13.12"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"添加rancher-chart仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加rancher-chart仓库"}},[s._v("#")]),s._v(" 添加rancher chart仓库")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("helm repo "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" rancher-stable http://rancher-mirror.oss-cn-beijing.aliyuncs.com/server-charts/stable\nhelm repo update\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"安装rancher"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装rancher"}},[s._v("#")]),s._v(" 安装rancher")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("helm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" rancher rancher-stable/rancher "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n --create-namespace\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n --namespace cattle-system "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n --set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("hostname")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("rancher.local.com\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h5",{attrs:{id:"等待-rancher-运行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#等待-rancher-运行"}},[s._v("#")]),s._v(" 等待 Rancher 运行：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubectl -n cattle-system rollout status deploy/rancher\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("输出信息：")]),s._v(" "),t("div",{staticClass:"language-shell script line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("Waiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rancher"')]),s._v(" rollout to finish: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" of "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" updated replicas are available"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\ndeployment "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rancher"')]),s._v(" successfully rolled out\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);