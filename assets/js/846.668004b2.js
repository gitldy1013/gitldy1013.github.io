(window.webpackJsonp=window.webpackJsonp||[]).push([[846],{1542:function(s,a,e){"use strict";e.r(a);var t=e(5),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"istio-kubernetes-v1-15-安装-istio-v1-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#istio-kubernetes-v1-15-安装-istio-v1-4"}},[s._v("#")]),s._v(" Istio-Kubernetes v1.15 安装 Istio v1.4")]),s._v(" "),e("h2",{attrs:{id:"概述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),e("p",[s._v("本博文采用的是 Kubernetes v1.15.4 版集群环境，Helm 版本为 v2.14.3，安装的 Istio 版本为 v1.4，按照当前课件发布时间（2019 年 11 月 15 日），官方文档说明中指出只在 K8S 的 v1.13、v1.14、v1.15 做过测试，"),e("strong",[s._v("请暂时不要将 K8S 升级至 v1.16 版")])]),s._v(" "),e("p",[s._v("安装过程参考 "),e("a",{attrs:{href:"https://istio.io/docs/setup/getting-started/",target:"_blank",rel:"noopener noreferrer"}},[e("strong",[s._v("Istio 官网")]),e("OutboundLink")],1),s._v(" ，Kubernetes 直接安装会安装到最新版，当前最新 K8S 版本为 v1.16.x，我们需要安装特定版本的 K8S 集群")]),s._v(" "),e("h2",{attrs:{id:"部署流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署流程"}},[s._v("#")]),s._v(" 部署流程")]),s._v(" "),e("h3",{attrs:{id:"添加-istio-到-helm-仓库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#添加-istio-到-helm-仓库"}},[s._v("#")]),s._v(" 添加 Istio 到 Helm 仓库")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("helm repo add istio.io https://storage.googleapis.com/istio-release/releases/1.4.0/charts/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"输出如下"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#输出如下"}},[s._v("#")]),s._v(" 输出如下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('"istio.io" has been added to your repositories\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"下载-istio"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#下载-istio"}},[s._v("#")]),s._v(" 下载 Istio")]),s._v(" "),e("blockquote",[e("p",[e("strong",[s._v("注意：")]),s._v(" 已将该文件上传至群分享中")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("wget https://github.com/istio/istio/releases/download/1.4.0/istio-1.4.0-linux.tar.gz\n\ntar -zxvf istio-1.4.0-linux.tar.gz\nmv istio-1.4.0 istio\ncd istio\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"部署-istio"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署-istio"}},[s._v("#")]),s._v(" 部署 Istio")]),s._v(" "),e("ul",[e("li",[s._v("创建命名空间")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("kubectl create namespace istio-system\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"输出如下-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#输出如下-2"}},[s._v("#")]),s._v(" 输出如下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("namespace/istio-system created\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("安装 CRDs (Custom Resource Definitions)")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("helm template install/kubernetes/helm/istio-init --name istio-init --namespace istio-system | kubectl apply -f -\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"输出如下-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#输出如下-3"}},[s._v("#")]),s._v(" 输出如下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("serviceaccount/istio-init-service-account created\nclusterrole.rbac.authorization.k8s.io/istio-init-istio-system created\nclusterrolebinding.rbac.authorization.k8s.io/istio-init-admin-role-binding-istio-system created\njob.batch/istio-init-crd-10-1.4.0 created\njob.batch/istio-init-crd-11-1.4.0 created\njob.batch/istio-init-crd-14-1.4.0 created\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("ul",[e("li",[s._v("等待 CRDs 创建完成")])]),s._v(" "),e("p",[s._v("kubectl -n istio-system wait --for=condition=complete job --all")]),s._v(" "),e("h1",{attrs:{id:"输出如下-4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#输出如下-4"}},[s._v("#")]),s._v(" 输出如下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("job.batch/istio-init-crd-10-1.4.0 condition met\njob.batch/istio-init-crd-11-1.4.0 condition met\njob.batch/istio-init-crd-14-1.4.0 condition met\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[s._v("部署 Istio 到集群")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("helm template install/kubernetes/helm/istio --name istio --namespace istio-system | kubectl apply -f -\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"验证部署是否成功"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#验证部署是否成功"}},[s._v("#")]),s._v(" 验证部署是否成功")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("kubectl get svc -n istio-system\n\nkubectl get pods -n istio-system\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h1",{attrs:{id:"输出如下-5"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#输出如下-5"}},[s._v("#")]),s._v(" 输出如下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("NAME                                      READY   STATUS      RESTARTS   AGE\n## 证书管理\nistio-citadel-8575bd45c6-5z54b  1/1  Running  0  11m\n## 配置检查\nistio-galley-7f8b95bff6-kb8xz 1/1  Running  0  11m\n## 入口网关\nistio-ingressgateway-dfbdff6cc-f2tvm 1/1  Running  0  11m\nistio-init-crd-10-1.4.0-7ls2s  0/1  Completed  0  18m\nistio-init-crd-11-1.4.0-rrb7q 0/1  Completed  0  18m\nistio-init-crd-14-1.4.0-kmmkm 0/1  Completed  0  18m\n## Envoy 服务发现，外部化配置\nistio-pilot-7f7b96db54-vdrs9 2/2  Running  3  11m\n## Mixer 策略检查\nistio-policy-5899c5f9b4-ch9ht 2/2  Running  6  11m\n## 边车注入\nistio-sidecar-injector-6c9d6cd87c-wrb7t 1/1  Running  0  11m\n## Mixer 指标收集\nistio-telemetry-6cb4749497-4p5tw  2/2  Running  6  11m\n## 监控报警\nprometheus-8685f659f-zzznv 1/1  Running  0  11m\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br")])]),e("h2",{attrs:{id:"部署-istio-控制面板"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署-istio-控制面板"}},[s._v("#")]),s._v(" 部署 Istio 控制面板")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("这里采用小米开源的 Naftis 作为我们的控制面板。[Naftis](https://github.com/xiaomi/naftis/blob/master/README-CN.md) 是一个基于 Web 的 Istio Dashboard，通过任务模板的方式来帮助用户更方便地执行 Istio 任务。 用户可以在 Naftis 中定义自己的任务模板，并填充变量来构造单个或多个构造任务实例，从而完成各种服务治理功能\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"部署-naftis"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署-naftis"}},[s._v("#")]),s._v(" 部署 Naftis")]),s._v(" "),e("ul",[e("li",[s._v("下载最新 Release 文件和部署清单")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("wget -O - https://raw.githubusercontent.com/XiaoMi/naftis/master/tool/getlatest.sh | bash\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("创建 Naftis 命名空间")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("kubectl create namespace naftis\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"输出如下-6"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#输出如下-6"}},[s._v("#")]),s._v(" 输出如下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("namespace/naftis created\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("部署 Naftis MySQL 服务")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("kubectl apply -n naftis -f mysql.yaml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"输出如下-7"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#输出如下-7"}},[s._v("#")]),s._v(" 输出如下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("persistentvolume/naftis-pv created\nsecret/naftis-mysql created\nconfigmap/naftis-mysql-initialization created\nconfigmap/naftis-mysql-test created\npersistentvolumeclaim/naftis-mysql created\nservice/naftis-mysql created\npod/naftis-mysql-test created\ndeployment.extensions/naftis-mysql created\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("ul",[e("li",[s._v("确认 MySQL 已部署")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("kubectl get pods -n naftis\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"输出如下-8"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#输出如下-8"}},[s._v("#")]),s._v(" 输出如下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("NAME                            READY   STATUS    RESTARTS   AGE\nnaftis-mysql-5f95ffbdbc-85ggw  1/1  Running  0  92s\nnaftis-mysql-test 1/1  Running  0  92s\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("ul",[e("li",[s._v("部署 Naftis API 和 UI 服务")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("kubectl apply -n naftis -f naftis.yaml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"输出如下-9"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#输出如下-9"}},[s._v("#")]),s._v(" 输出如下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply\nnamespace/naftis configured\nconfigmap/naftis-config created\nclusterrolebinding.rbac.authorization.k8s.io/naftis-rbac created\nservice/naftis-api created\nservice/naftis-ui created\ndeployment.extensions/naftis-ui created\ndeployment.extensions/naftis-api created\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("ul",[e("li",[s._v("确认 Naftis 所有的服务已经正确定义并正常运行中")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("kubectl get svc -n naftis\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"输出如下-10"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#输出如下-10"}},[s._v("#")]),s._v(" 输出如下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("NAME           TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S) AGE\nnaftis-api ClusterIP  10.96.58.36  <none>  50000/TCP 45s\nnaftis-mysql ClusterIP  10.99.66.184  <none>  3306/TCP 3m\nnaftis-ui LoadBalancer  10.110.105.103  <pending>  80:30772/TCP 44s\n\nkubectl get pod -n naftis\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h1",{attrs:{id:"输出如下-11"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#输出如下-11"}},[s._v("#")]),s._v(" 输出如下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("NAME                            READY   STATUS    RESTARTS   AGE\nnaftis-api-7d6f47fbcc-qsfpg 1/1  Running  0  22m\nnaftis-mysql-5f95ffbdbc-85ggw  1/1  Running  0  24m\nnaftis-mysql-test 1/1  Running  0  22m\nnaftis-ui-9d66dbc74-l8lsx 1/1  Running  0  22m\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"访问-naftis"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#访问-naftis"}},[s._v("#")]),s._v(" 访问 Naftis")]),s._v(" "),e("ul",[e("li",[s._v("使用端口转发的方式暴露端口")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("kubectl -n naftis port-forward $(kubectl -n naftis get pod -l app=naftis-ui -o jsonpath='{.items[0].metadata.name}')  32569:80  --address 0.0.0.0  &\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("在任意 K8S 节点上访问 32569 端口（"),e("strong",[s._v("账号：admin 密码：admin")]),s._v("）")])]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/8e0951f2d0df81f.png",alt:""}})]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/d03357a6eb3267d.png",alt:""}})]),s._v(" "),e("h2",{attrs:{id:"卸载-istio"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#卸载-istio"}},[s._v("#")]),s._v(" 卸载 Istio")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cd istio\n\nhelm template install/kubernetes/helm/istio --name istio --namespace istio-system | kubectl delete -f -\n\nhelm delete --purge istio\nhelm delete --purge istio-init\nhelm delete --purge istio-cni\n\nkubectl delete -f install/kubernetes/helm/istio-init/files\nkubectl delete namespace istio-system\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("h2",{attrs:{id:"卸载-naftis"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#卸载-naftis"}},[s._v("#")]),s._v(" 卸载 Naftis")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cd naftis\n\nkubectl delete -n naftis -f naftis.yaml\nkubectl delete -n naftis -f mysql.yaml\nkubectl delete namespace naftis\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h2",{attrs:{id:"附-集群环境安装参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#附-集群环境安装参考"}},[s._v("#")]),s._v(" 附：集群环境安装参考")]),s._v(" "),e("h3",{attrs:{id:"安装特定版本的-kubernetes"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装特定版本的-kubernetes"}},[s._v("#")]),s._v(" 安装特定版本的 Kubernetes")]),s._v(" "),e("h1",{attrs:{id:"更新软件源"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更新软件源"}},[s._v("#")]),s._v(" 更新软件源")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo apt-get update\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"安装所需依赖"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装所需依赖"}},[s._v("#")]),s._v(" 安装所需依赖")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"安装-gpg-证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装-gpg-证书"}},[s._v("#")]),s._v(" 安装 GPG 证书")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add -\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"写入软件源-注意-我们用系统代号为-bionic-但目前阿里云不支持-所以沿用-16-04-的-xenial"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#写入软件源-注意-我们用系统代号为-bionic-但目前阿里云不支持-所以沿用-16-04-的-xenial"}},[s._v("#")]),s._v(" 写入软件源；注意：我们用系统代号为 bionic，但目前阿里云不支持，所以沿用 16.04 的 xenial")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cat << EOF >/etc/apt/sources.list.d/kubernetes.list\ndeb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main\nEOF\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h1",{attrs:{id:"安装特定版本的-kubernetes-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装特定版本的-kubernetes-2"}},[s._v("#")]),s._v(" 安装特定版本的 Kubernetes")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("apt-get update && apt-get install -y kubelet=1.15.4-00 kubeadm=1.15.4-00 kubectl=1.15.4-00\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"安装-helm"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装-helm"}},[s._v("#")]),s._v(" 安装 Helm")]),s._v(" "),e("ul",[e("li",[s._v("安装客户端 Helm")])]),s._v(" "),e("h1",{attrs:{id:"下载"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#下载"}},[s._v("#")]),s._v(" 下载")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("wget https://get.helm.sh/helm-v2.14.3-linux-amd64.tar.gz\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"解压"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解压"}},[s._v("#")]),s._v(" 解压")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("tar -zxvf helm-v2.14.3-linux-amd64.tar.gz\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"复制客户端执行文件到-bin-目录下"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#复制客户端执行文件到-bin-目录下"}},[s._v("#")]),s._v(" 复制客户端执行文件到 bin 目录下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("cp linux-amd64/helm /usr/local/bin/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("安装服务端 Tiller")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("helm init --upgrade --tiller-image registry.cn-hangzhou.aliyuncs.com/google_containers/tiller:v2.14.3  --stable-repo-url http://mirror.azure.cn/kubernetes/charts/\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"输出如下-12"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#输出如下-12"}},[s._v("#")]),s._v(" 输出如下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Creating  /root/.helm \nCreating  /root/.helm/repository \nCreating  /root/.helm/repository/cache \nCreating  /root/.helm/repository/local \nCreating  /root/.helm/plugins \nCreating  /root/.helm/starters \nCreating  /root/.helm/cache/archive \nCreating  /root/.helm/repository/repositories.yaml \nAdding stable repo with URL: http://mirror.azure.cn/kubernetes/charts/ \nAdding  local repo with URL: http://127.0.0.1:8879/charts \n$HELM_HOME has been configured at /root/.helm.\nTiller  (the Helm server-side component) has been installed into your Kubernetes  Cluster.\nPlease note: by default,  Tiller is deployed with an insecure 'allow unauthenticated users' policy.\nTo prevent this, run helm init with the --tiller-tls-verify flag.\nFor more information on securing your installation see: https://docs.helm.sh/using_helm/#securing-your-helm-installation\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("ul",[e("li",[s._v("创建一个名为 tiller-adminuser.yaml 的配置文件，为 Tiller 创建服务帐号和绑定角色")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("apiVersion: v1\nkind:  ServiceAccount\nmetadata:\n name: tiller\n namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind:  ClusterRoleBinding\nmetadata:\n name: tiller-cluster-rule\nroleRef:\n apiGroup: rbac.authorization.k8s.io\n kind:  ClusterRole\n name: cluster-admin\nsubjects:\n- kind:  ServiceAccount\n name: tiller\n namespace: kube-system\n\nkubectl apply -f tiller-adminuser.yaml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br")])]),e("ul",[e("li",[s._v("为 Tiller 设置帐号")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('kubectl patch deploy --namespace kube-system tiller-deploy -p \'{"spec":{"template":{"spec":{"serviceAccount":"tiller"}}}}\'\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"输出如下-13"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#输出如下-13"}},[s._v("#")]),s._v(" 输出如下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("deployment.extensions/tiller-deploy patched\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("查看是否授权成功")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("kubectl get deploy --namespace kube-system tiller-deploy --output yaml|grep  serviceAccount\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"输出如下-14"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#输出如下-14"}},[s._v("#")]),s._v(" 输出如下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("serviceAccount: tiller\nserviceAccountName: tiller\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("ul",[e("li",[s._v("验证安装是否成功")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("kubectl -n kube-system get pods|grep tiller\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h1",{attrs:{id:"输出如下-15"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#输出如下-15"}},[s._v("#")]),s._v(" 输出如下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("tiller-deploy-7c7b67c9fd-w66c5 1/1  Running  3  13h\n\nhelm version\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h1",{attrs:{id:"输出如下-16"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#输出如下-16"}},[s._v("#")]),s._v(" 输出如下")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('Client:  &version.Version{SemVer:"v2.14.3",  GitCommit:"0e7f3b6637f7af8fcfddb3d2941fcc7cbebb0085",  GitTreeState:"clean"}\nServer:  &version.Version{SemVer:"v2.14.3",  GitCommit:"0e7f3b6637f7af8fcfddb3d2941fcc7cbebb0085",  GitTreeState:"clean"}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"完成"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#完成"}},[s._v("#")]),s._v(" 完成")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("    //正则\n    ps: [\\d]+\\.\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);