(window.webpackJsonp=window.webpackJsonp||[]).push([[1055],{1751:function(a,t,e){"use strict";e.r(t);var s=e(5),n=Object(s.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"kaptcha"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kaptcha"}},[a._v("#")]),a._v(" Kaptcha")]),a._v(" "),e("h2",{attrs:{id:"验证码的作用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#验证码的作用"}},[a._v("#")]),a._v(" 验证码的作用")]),a._v(" "),e("p",[a._v("防止恶意破解密码、刷票、论坛灌水、刷页。")]),a._v(" "),e("p",[a._v("有效防止某个黑客对某一个特定注册用户用特定程序暴力破解方式进行不断的登录尝试，实际上使用验证码是现在很多网站通行的方式（比如招商银行的网上个人银行，百度社区），我们利用比较简易的方式实现了这个功能。虽然登录麻烦一点，但是对网友的密码安全来说这个功能还是很有必要，也很重要。但我们还是 提醒大家要保护好自己的密码 ，尽量使用混杂了数字、字母、符号在内的 6 位以上密码，不要使用诸如 1234 之类的简单密码或者与用户名相同、类似的密码 ，免得你的账号被人盗用给自己带来不必要的麻烦。")]),a._v(" "),e("p",[a._v("验证码通常使用一些线条和一些不规则的字符组成，主要作用是为了防止一些黑客把密码数据化盗取。")]),a._v(" "),e("h2",{attrs:{id:"kaptcha-简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kaptcha-简介"}},[a._v("#")]),a._v(" Kaptcha 简介")]),a._v(" "),e("p",[a._v("Kaptcha 是一个可高度配置的实用验证码生成工具，可自由配置的选项如：")]),a._v(" "),e("ul",[e("li",[a._v("验证码的字体")]),a._v(" "),e("li",[a._v("验证码字体的大小")]),a._v(" "),e("li",[a._v("验证码字体的字体颜色")]),a._v(" "),e("li",[a._v("验证码内容的范围(数字，字母，中文汉字！)")]),a._v(" "),e("li",[a._v("验证码图片的大小，边框，边框粗细，边框颜色")]),a._v(" "),e("li",[a._v("验证码的干扰线")]),a._v(" "),e("li",[a._v("验证码的样式(鱼眼样式、3D、普通模糊、...)")])]),a._v(" "),e("h2",{attrs:{id:"kaptcha-详细配置表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kaptcha-详细配置表"}},[a._v("#")]),a._v(" Kaptcha 详细配置表")]),a._v(" "),e("table",[e("thead",[e("tr",[e("th",[a._v("Constant")]),a._v(" "),e("th",[a._v("描述")]),a._v(" "),e("th",[a._v("默认值")])])]),a._v(" "),e("tbody",[e("tr",[e("td",[a._v("kaptcha.border")]),a._v(" "),e("td",[a._v("图片边框，合法值：yes , no")]),a._v(" "),e("td",[a._v("yes")])]),a._v(" "),e("tr",[e("td",[a._v("kaptcha.border.color")]),a._v(" "),e("td",[a._v("边框颜色，合法值： r,g,b (and optional alpha) 或者 white,black,blue.")]),a._v(" "),e("td",[a._v("black")])]),a._v(" "),e("tr",[e("td",[a._v("kaptcha.image.width")]),a._v(" "),e("td",[a._v("图片宽")]),a._v(" "),e("td",[a._v("200")])]),a._v(" "),e("tr",[e("td",[a._v("kaptcha.image.height")]),a._v(" "),e("td",[a._v("图片高")]),a._v(" "),e("td",[a._v("50")])]),a._v(" "),e("tr",[e("td",[a._v("kaptcha.producer.impl")]),a._v(" "),e("td",[a._v("图片实现类")]),a._v(" "),e("td",[a._v("com.google.code.kaptcha.impl.DefaultKaptcha")])]),a._v(" "),e("tr",[e("td",[a._v("kaptcha.textproducer.impl")]),a._v(" "),e("td",[a._v("文本实现类")]),a._v(" "),e("td",[a._v("com.google.code.kaptcha.text.impl.DefaultTextCreator")])]),a._v(" "),e("tr",[e("td",[a._v("kaptcha.textproducer.char.string")]),a._v(" "),e("td",[a._v("文本集合，验证码值从此集合中获取")]),a._v(" "),e("td",[a._v("abcde2345678gfynmnpwx")])]),a._v(" "),e("tr",[e("td",[a._v("kaptcha.textproducer.char.length")]),a._v(" "),e("td",[a._v("验证码长度")]),a._v(" "),e("td",[a._v("5")])]),a._v(" "),e("tr",[e("td",[a._v("kaptcha.textproducer.font.names")]),a._v(" "),e("td",[a._v("字体")]),a._v(" "),e("td",[a._v("Arial, Courier")])]),a._v(" "),e("tr",[e("td",[a._v("kaptcha.textproducer.font.size")]),a._v(" "),e("td",[a._v("字体大小")]),a._v(" "),e("td",[a._v("40px.")])]),a._v(" "),e("tr",[e("td",[a._v("kaptcha.textproducer.font.color")]),a._v(" "),e("td",[a._v("字体颜色，合法值： r,g,b  或者 white,black,blue.")]),a._v(" "),e("td",[a._v("black")])]),a._v(" "),e("tr",[e("td",[a._v("kaptcha.textproducer.char.space")]),a._v(" "),e("td",[a._v("文字间隔")]),a._v(" "),e("td",[a._v("2")])]),a._v(" "),e("tr",[e("td",[a._v("kaptcha.noise.impl")]),a._v(" "),e("td",[a._v("干扰实现类")]),a._v(" "),e("td",[a._v("com.google.code.kaptcha.impl.DefaultNoise")])]),a._v(" "),e("tr",[e("td",[a._v("kaptcha.noise.color")]),a._v(" "),e("td",[a._v("干扰 颜色，合法值： r,g,b 或者 white,black,blue.")]),a._v(" "),e("td",[a._v("black")])]),a._v(" "),e("tr",[e("td",[a._v("kaptcha.obscurificator.impl")]),a._v(" "),e("td",[a._v("图片样式：水纹 com.google.code.kaptcha.impl.WaterRipple  鱼眼 com.google.code.kaptcha.impl.FishEyeGimpy  阴影 com.google.code.kaptcha.impl.ShadowGimpy")]),a._v(" "),e("td",[a._v("com.google.code.kaptcha.impl.WaterRipple")])]),a._v(" "),e("tr",[e("td",[a._v("kaptcha.background.impl")]),a._v(" "),e("td",[a._v("背景实现类")]),a._v(" "),e("td",[a._v("com.google.code.kaptcha.impl.DefaultBackground")])]),a._v(" "),e("tr",[e("td",[a._v("kaptcha.background.clear.from")]),a._v(" "),e("td",[a._v("背景颜色渐变，开始颜色")]),a._v(" "),e("td",[a._v("light grey")])]),a._v(" "),e("tr",[e("td",[a._v("kaptcha.background.clear.to")]),a._v(" "),e("td",[a._v("背景颜色渐变， 结束颜色")]),a._v(" "),e("td",[a._v("white")])]),a._v(" "),e("tr",[e("td",[a._v("kaptcha.word.impl")]),a._v(" "),e("td",[a._v("文字渲染器")]),a._v(" "),e("td",[a._v("com.google.code.kaptcha.text.impl.DefaultWordRenderer")])]),a._v(" "),e("tr",[e("td",[a._v("kaptcha.session.key")]),a._v(" "),e("td",[a._v("session key")]),a._v(" "),e("td",[a._v("KAPTCHA_SESSION_KEY")])]),a._v(" "),e("tr",[e("td",[a._v("kaptcha.session.date")]),a._v(" "),e("td",[a._v("session date")]),a._v(" "),e("td",[a._v("KAPTCHA_SESSION_DATE")])])])]),a._v(" "),e("h2",{attrs:{id:"spring-mvc-整合-kaptcha"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#spring-mvc-整合-kaptcha"}},[a._v("#")]),a._v(" Spring MVC 整合 Kaptcha")]),a._v(" "),e("h3",{attrs:{id:"pom"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pom"}},[a._v("#")]),a._v(" POM")]),a._v(" "),e("p",[e("code",[a._v("pom.xml")]),a._v(" 配置文件如下：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("    <dependency>\n        <groupId>com.google.code.kaptcha</groupId>\n        <artifactId>kaptcha</artifactId>\n        <version>2.3</version>\n    </dependency>\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br")])]),e("p",[a._v("主要增加了 "),e("code",[a._v("com.google.code.kaptcha:kaptcha")]),a._v(" 依赖")]),a._v(" "),e("h3",{attrs:{id:"创建-spring-配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建-spring-配置"}},[a._v("#")]),a._v(" 创建 Spring 配置")]),a._v(" "),e("p",[a._v("创建一个名为 "),e("code",[a._v("spring-context-kaptcha.xml")]),a._v(" Spring 配置文件，配置如下：")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('    <?xml version="1.0" encoding="UTF-8"?>\n    <beans xmlns="http://www.springframework.org/schema/beans"\n           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n           xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">\n    \n        <bean id="captchaProducer" class="com.google.code.kaptcha.impl.DefaultKaptcha">\n            <property name="config">\n                <bean class="com.google.code.kaptcha.util.Config">\n                    <constructor-arg>\n                        <props>\n                            <prop key="kaptcha.border">yes</prop>\n                            <prop key="kaptcha.border.color">105,179,90</prop>\n                            <prop key="kaptcha.textproducer.font.color">blue</prop>\n                            <prop key="kaptcha.image.width">125</prop>\n                            <prop key="kaptcha.image.height">45</prop>\n                            <prop key="kaptcha.textproducer.font.size">45</prop>\n                            <prop key="kaptcha.session.key">code</prop>\n                            <prop key="kaptcha.textproducer.char.length">4</prop>\n                            <prop key="kaptcha.textproducer.font.names">宋体,楷体,微软雅黑</prop>\n                        </props>\n                    </constructor-arg>\n                </bean>\n            </property>\n        </bean>\n    </beans>\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br"),e("span",{staticClass:"line-number"},[a._v("16")]),e("br"),e("span",{staticClass:"line-number"},[a._v("17")]),e("br"),e("span",{staticClass:"line-number"},[a._v("18")]),e("br"),e("span",{staticClass:"line-number"},[a._v("19")]),e("br"),e("span",{staticClass:"line-number"},[a._v("20")]),e("br"),e("span",{staticClass:"line-number"},[a._v("21")]),e("br"),e("span",{staticClass:"line-number"},[a._v("22")]),e("br"),e("span",{staticClass:"line-number"},[a._v("23")]),e("br"),e("span",{staticClass:"line-number"},[a._v("24")]),e("br"),e("span",{staticClass:"line-number"},[a._v("25")]),e("br")])]),e("h3",{attrs:{id:"控制器关键代码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#控制器关键代码"}},[a._v("#")]),a._v(" 控制器关键代码")]),a._v(" "),e("p",[e("code",[a._v("Controller")]),a._v(" 层的关键代码如下，主要作用为将生成的验证码放入 "),e("code",[a._v("Session")]),a._v(" 并输出到页面")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('    package com.cmcc.my.shop.web.ui.controller;\n    \n    import com.google.code.kaptcha.Constants;\n    import com.google.code.kaptcha.Producer;\n    import org.springframework.beans.factory.annotation.Autowired;\n    import org.springframework.stereotype.Controller;\n    import org.springframework.web.bind.annotation.RequestMapping;\n    import org.springframework.web.bind.annotation.RequestMethod;\n    import org.springframework.web.servlet.ModelAndView;\n    \n    import javax.imageio.ImageIO;\n    import javax.servlet.ServletOutputStream;\n    import javax.servlet.http.HttpServletRequest;\n    import javax.servlet.http.HttpServletResponse;\n    import java.awt.image.BufferedImage;\n    import java.io.IOException;\n    \n    @Controller\n    public class KaptchaController {\n    \n        @Autowired\n        private Producer captchaProducer;\n    \n        @RequestMapping(value = "verification", method = RequestMethod.GET)\n        public ModelAndView verification(HttpServletRequest request, HttpServletResponse response) throws IOException {\n            response.setDateHeader("Expires", 0);\n            // Set standard HTTP/1.1 no-cache headers.\n            response.setHeader("Cache-Control", "no-store, no-cache, must-revalidate");\n            // Set IE extended HTTP/1.1 no-cache headers (use addHeader).\n            response.addHeader("Cache-Control", "post-check=0, pre-check=0");\n            // Set standard HTTP/1.0 no-cache header.\n            response.setHeader("Pragma", "no-cache");\n            // return a jpeg\n            response.setContentType("image/jpeg");\n            // create the text for the image\n            String capText = captchaProducer.createText();\n            // store the text in the session\n            request.getSession().setAttribute(Constants.KAPTCHA_SESSION_KEY, capText);\n            // create the image with the text\n            BufferedImage bi = captchaProducer.createImage(capText);\n            ServletOutputStream out = response.getOutputStream();\n            // write the data out\n            ImageIO.write(bi, "jpg", out);\n            try {\n                out.flush();\n            } finally {\n                out.close();\n            }\n            return null;\n        }\n    }\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br"),e("span",{staticClass:"line-number"},[a._v("16")]),e("br"),e("span",{staticClass:"line-number"},[a._v("17")]),e("br"),e("span",{staticClass:"line-number"},[a._v("18")]),e("br"),e("span",{staticClass:"line-number"},[a._v("19")]),e("br"),e("span",{staticClass:"line-number"},[a._v("20")]),e("br"),e("span",{staticClass:"line-number"},[a._v("21")]),e("br"),e("span",{staticClass:"line-number"},[a._v("22")]),e("br"),e("span",{staticClass:"line-number"},[a._v("23")]),e("br"),e("span",{staticClass:"line-number"},[a._v("24")]),e("br"),e("span",{staticClass:"line-number"},[a._v("25")]),e("br"),e("span",{staticClass:"line-number"},[a._v("26")]),e("br"),e("span",{staticClass:"line-number"},[a._v("27")]),e("br"),e("span",{staticClass:"line-number"},[a._v("28")]),e("br"),e("span",{staticClass:"line-number"},[a._v("29")]),e("br"),e("span",{staticClass:"line-number"},[a._v("30")]),e("br"),e("span",{staticClass:"line-number"},[a._v("31")]),e("br"),e("span",{staticClass:"line-number"},[a._v("32")]),e("br"),e("span",{staticClass:"line-number"},[a._v("33")]),e("br"),e("span",{staticClass:"line-number"},[a._v("34")]),e("br"),e("span",{staticClass:"line-number"},[a._v("35")]),e("br"),e("span",{staticClass:"line-number"},[a._v("36")]),e("br"),e("span",{staticClass:"line-number"},[a._v("37")]),e("br"),e("span",{staticClass:"line-number"},[a._v("38")]),e("br"),e("span",{staticClass:"line-number"},[a._v("39")]),e("br"),e("span",{staticClass:"line-number"},[a._v("40")]),e("br"),e("span",{staticClass:"line-number"},[a._v("41")]),e("br"),e("span",{staticClass:"line-number"},[a._v("42")]),e("br"),e("span",{staticClass:"line-number"},[a._v("43")]),e("br"),e("span",{staticClass:"line-number"},[a._v("44")]),e("br"),e("span",{staticClass:"line-number"},[a._v("45")]),e("br"),e("span",{staticClass:"line-number"},[a._v("46")]),e("br"),e("span",{staticClass:"line-number"},[a._v("47")]),e("br"),e("span",{staticClass:"line-number"},[a._v("48")]),e("br"),e("span",{staticClass:"line-number"},[a._v("49")]),e("br"),e("span",{staticClass:"line-number"},[a._v("50")]),e("br"),e("span",{staticClass:"line-number"},[a._v("51")]),e("br")])]),e("h3",{attrs:{id:"jsp-关键代码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jsp-关键代码"}},[a._v("#")]),a._v(" JSP 关键代码")]),a._v(" "),e("p",[a._v("JSP 使用 "),e("code",[a._v("<img />")]),a._v(" 标签去请求验证码图片")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('    <img id="verification" src="/verification" style="cursor: pointer;" title="看不清？换一张" />\n')])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("为图片绑定一个点击事件用于无刷新更换验证码")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("    $(function () {\n        // 刷新验证码\n        $(\"#verification\").bind(\"click\", function () {\n            $(this).hide().attr('src', '/verification?random=' + Math.random()).fadeIn();\n        });\n    });\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br")])])])}),[],!1,null,null,null);t.default=n.exports}}]);