(window.webpackJsonp=window.webpackJsonp||[]).push([[513],{1209:function(e,s,n){"use strict";n.r(s);var t=n(5),a=Object(t.a)({},(function(){var e=this,s=e.$createElement,n=e._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"docker-配置-dns"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-配置-dns"}},[e._v("#")]),e._v(" Docker 配置 DNS")]),e._v(" "),n("p",[e._v("如何自定义配置容器的主机名和 DNS 呢？秘诀就是 Docker 利用虚拟文件来挂载容器的 3 个相关配置文件。")]),e._v(" "),n("p",[e._v("在容器中使用 "),n("code",[e._v("mount")]),e._v(" 命令可以看到挂载信息：")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("    $ mount\n    /dev/disk/by-uuid/1fec...ebdf on /etc/hostname type ext4 ...\n    /dev/disk/by-uuid/1fec...ebdf on /etc/hosts type ext4 ...\n    tmpfs on /etc/resolv.conf type tmpfs ...\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("p",[e._v("这种机制可以让宿主主机 DNS 信息发生更新后，所有 Docker 容器的 DNS 配置通过 "),n("code",[e._v("/etc/resolv.conf")]),e._v(" 文件立刻得到更新。")]),e._v(" "),n("p",[e._v("配置全部容器的 DNS ，也可以在 "),n("code",[e._v("/etc/docker/daemon.json")]),e._v(" 文件中增加以下内容来设置。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('    {\n      "dns" : [\n        "114.114.114.114",\n        "8.8.8.8"\n      ]\n    }\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br")])]),n("p",[e._v("这样每次启动的容器 DNS 自动配置为 "),n("code",[e._v("114.114.114.114")]),e._v(" 和 "),n("code",[e._v("8.8.8.8")]),e._v("。使用以下命令来证明其已经生效。")]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("    $ docker run -it --rm ubuntu:17.10  cat etc/resolv.conf\n    \n    nameserver 114.114.114.114\n    nameserver 8.8.8.8\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br")])]),n("p",[e._v("如果用户想要手动指定容器的配置，可以在使用 "),n("code",[e._v("docker run")]),e._v(" 命令启动容器时加入如下参数：")]),e._v(" "),n("p",[n("code",[e._v("-h HOSTNAME")]),e._v(" 或者 "),n("code",[e._v("--hostname=HOSTNAME")]),e._v(" 设定容器的主机名，它会被写到容器内的 "),n("code",[e._v("/etc/hostname")]),e._v(" 和 "),n("code",[e._v("/etc/hosts")]),e._v("。但它在容器外部看不到，既不会在 "),n("code",[e._v("docker container ls")]),e._v(" 中显示，也不会在其他的容器的 "),n("code",[e._v("/etc/hosts")]),e._v(" 看到。")]),e._v(" "),n("p",[n("code",[e._v("--dns=IP_ADDRESS")]),e._v(" 添加 DNS 服务器到容器的 "),n("code",[e._v("/etc/resolv.conf")]),e._v(" 中，让容器用这个服务器来解析所有不在 "),n("code",[e._v("/etc/hosts")]),e._v(" 中的主机名。")]),e._v(" "),n("p",[n("code",[e._v("--dns-search=DOMAIN")]),e._v(" 设定容器的搜索域，当设定搜索域为 "),n("code",[e._v(".example.com")]),e._v(" 时，在搜索一个名为 host 的主机时，DNS 不仅搜索 host，还会搜索 "),n("code",[e._v("host.example.com")]),e._v("。")]),e._v(" "),n("blockquote",[n("p",[e._v("注意：如果在容器启动时没有指定最后两个参数，Docker 会默认用主机上的 "),n("code",[e._v("/etc/resolv.conf")]),e._v(" 来配置容器。")])])])}),[],!1,null,null,null);s.default=a.exports}}]);