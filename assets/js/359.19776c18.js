(window.webpackJsonp=window.webpackJsonp||[]).push([[359],{1055:function(s,n,a){"use strict";a.r(n);var e=a(5),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"nginx-虚拟主机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-虚拟主机"}},[s._v("#")]),s._v(" Nginx 虚拟主机")]),s._v(" "),a("h2",{attrs:{id:"概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),a("p",[s._v("我们使用 Docker 来安装和运行 Nginx，"),a("code",[s._v("docker-compose.yml")]),s._v(" 配置如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    version: '3.1'\n    services:\n      nginx:\n        restart: always\n        image: nginx\n        container_name: nginx\n        ports:\n          - 81:80\n        volumes:\n          - ./conf/nginx.conf:/etc/nginx/nginx.conf\n          - ./wwwroot:/usr/share/nginx/wwwroot\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h2",{attrs:{id:"什么是虚拟主机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是虚拟主机"}},[s._v("#")]),s._v(" 什么是虚拟主机？")]),s._v(" "),a("p",[s._v("虚拟主机是一种特殊的软硬件技术，它可以将网络上的每一台计算机分成多个虚拟主机，每个虚拟主机可以独立对外提供 www 服务，这样就可以实现一台主机对外提供多个 web 服务，每个虚拟主机之间是独立的，互不影响的。")]),s._v(" "),a("p",[s._v("通过 Nginx 可以实现虚拟主机的配置，Nginx 支持三种类型的虚拟主机配置")]),s._v(" "),a("ul",[a("li",[s._v("基于 IP 的虚拟主机")]),s._v(" "),a("li",[s._v("基于域名的虚拟主机")]),s._v(" "),a("li",[s._v("基于端口的虚拟主机")])]),s._v(" "),a("h2",{attrs:{id:"nginx-配置文件的结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置文件的结构"}},[s._v("#")]),s._v(" Nginx 配置文件的结构")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    # ...\n    events {\n    \t# ...\n    }\n    \n    http {\n    \t# ...\n    \tserver{\n    \t\t# ...\n    \t}\n    \t\n    \t# ...\n    \tserver{\n    \t\t# ...\n    \t}\n    }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[a("strong",[s._v("注：")]),s._v(" 每个 server 就是一个虚拟主机")]),s._v(" "),a("h2",{attrs:{id:"基于端口的虚拟主机配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基于端口的虚拟主机配置"}},[s._v("#")]),s._v(" 基于端口的虚拟主机配置")]),s._v(" "),a("h3",{attrs:{id:"需求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#需求"}},[s._v("#")]),s._v(" 需求")]),s._v(" "),a("ul",[a("li",[s._v("Nginx 对外提供 80 和 8080 两个端口监听服务")]),s._v(" "),a("li",[s._v("请求 80 端口则请求 html80 目录下的 html")]),s._v(" "),a("li",[s._v("请求 8080 端口则请求 html8080 目录下的 html")])]),s._v(" "),a("h3",{attrs:{id:"创建目录及文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建目录及文件"}},[s._v("#")]),s._v(" 创建目录及文件")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("/usr/local/docker/nginx/wwwroot")]),s._v(" 目录下创建 "),a("code",[s._v("html80")]),s._v(" 和 "),a("code",[s._v("html8080")]),s._v(" 两个目录，并分辨创建两个 index.html 文件")]),s._v(" "),a("h3",{attrs:{id:"配置虚拟主机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置虚拟主机"}},[s._v("#")]),s._v(" 配置虚拟主机")]),s._v(" "),a("p",[s._v("修改 "),a("code",[s._v("/usr/local/docker/nginx/conf")]),s._v(" 目录下的 nginx.conf 配置文件：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    # 启动进程,通常设置成和 CPU 的数量相等\n    worker_processes  1;\n    \n    events {\n        # epoll 是多路复用 IO(I/O Multiplexing) 中的一种方式\n        # 但是仅用于 linux2.6 以上内核,可以大大提高 nginx 的性能\n        use epoll;\n        # 单个后台 worker process 进程的最大并发链接数\n        worker_connections  1024;\n    }\n    \n    http {\n        # 设定 mime 类型,类型由 mime.type 文件定义\n        include       mime.types;\n        default_type  application/octet-stream;\n    \n        # sendfile 指令指定 nginx 是否调用 sendfile 函数（zero copy 方式）来输出文件，对于普通应用，\n        # 必须设为 on，如果用来进行下载等应用磁盘 IO 重负载应用，可设置为 off，以平衡磁盘与网络 I/O 处理速度，降低系统的 uptime.\n        sendfile        on;\n        \n        # 连接超时时间\n        keepalive_timeout  65;\n        # 设定请求缓冲\n        client_header_buffer_size 2k;\n    \n        # 配置虚拟主机 192.168.75.145\n        server {\n    \t# 监听的ip和端口，配置 192.168.75.145:80\n            listen       80;\n    \t# 虚拟主机名称这里配置ip地址\n            server_name  192.168.75.145;\n    \t# 所有的请求都以 / 开始，所有的请求都可以匹配此 location\n            location / {\n    \t    # 使用 root 指令指定虚拟主机目录即网页存放目录\n    \t    # 比如访问 http://ip/index.html 将找到 /usr/local/docker/nginx/wwwroot/html80/index.html\n    \t    # 比如访问 http://ip/item/index.html 将找到 /usr/local/docker/nginx/wwwroot/html80/item/index.html\n    \n                root   /usr/share/nginx/wwwroot/html80;\n    \t    # 指定欢迎页面，按从左到右顺序查找\n                index  index.html index.htm;\n            }\n    \n        }\n        # 配置虚拟主机 192.168.75.245\n        server {\n            listen       8080;\n            server_name  192.168.75.145;\n    \n            location / {\n                root   /usr/share/nginx/wwwroot/html8080;\n                index  index.html index.htm;\n            }\n        }\n    }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br")])]),a("h2",{attrs:{id:"基于域名的虚拟主机配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基于域名的虚拟主机配置"}},[s._v("#")]),s._v(" 基于域名的虚拟主机配置")]),s._v(" "),a("h3",{attrs:{id:"需求-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#需求-2"}},[s._v("#")]),s._v(" 需求")]),s._v(" "),a("ul",[a("li",[s._v("两个域名指向同一台 Nginx 服务器，用户访问不同的域名显示不同的网页内容")]),s._v(" "),a("li",[s._v("两个域名是 admin.service.itoken.cmcc.com 和 admin.web.itoken.cmcc.com")]),s._v(" "),a("li",[s._v("Nginx 服务器使用虚拟机 192.168.75.145")])]),s._v(" "),a("h3",{attrs:{id:"配置-windows-hosts-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置-windows-hosts-文件"}},[s._v("#")]),s._v(" 配置 Windows Hosts 文件")]),s._v(" "),a("ul",[a("li",[s._v("通过 host 文件指定 admin.service.itoken.cmcc.com 和 admin.web.itoken.cmcc.com 对应 192.168.75.145 虚拟机：")]),s._v(" "),a("li",[s._v("修改 window 的 hosts 文件：（C:\\Windows\\System32\\drivers\\etc）")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/img/1520965332.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"创建目录及文件-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建目录及文件-2"}},[s._v("#")]),s._v(" 创建目录及文件")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("/usr/local/docker/nginx/wwwroot")]),s._v(" 目录下创建 "),a("code",[s._v("htmlservice")]),s._v(" 和 "),a("code",[s._v("htmlweb")]),s._v(" 两个目录，并分辨创建两个 index.html 文件")]),s._v(" "),a("h3",{attrs:{id:"配置虚拟主机-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置虚拟主机-2"}},[s._v("#")]),s._v(" 配置虚拟主机")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    user  nginx;\n    worker_processes  1;\n    \n    events {\n        worker_connections  1024;\n    }\n    \n    http {\n        include       mime.types;\n        default_type  application/octet-stream;\n    \n        sendfile        on;\n    \n        keepalive_timeout  65;\n        server {\n            listen       80;\n            server_name  admin.service.itoken.cmcc.com;\n            location / {\n                root   /usr/share/nginx/wwwroot/htmlservice;\n                index  index.html index.htm;\n            }\n    \n        }\n    \n        server {\n            listen       80;\n            server_name  admin.web.itoken.cmcc.com;\n    \n            location / {\n                root   /usr/share/nginx/wwwroot/htmlweb;\n                index  index.html index.htm;\n            }\n        }\n    }\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);