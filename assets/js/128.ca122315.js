(window.webpackJsonp=window.webpackJsonp||[]).push([[128],{825:function(e,s,a){"use strict";a.r(s);var t=a(5),r=Object(t.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"kubernetes可视化界面kubesphere"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes可视化界面kubesphere"}},[e._v("#")]),e._v(" Kubernetes可视化界面kubesphere")]),e._v(" "),a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[e._v("#")]),e._v(" 前言")]),e._v(" "),a("p",[e._v("Kubernetes也提供了默认的dashboard页面，但是功能不是很强大，这里就不使用了")]),e._v(" "),a("p",[e._v("而是采用Kubesphere大桶全部的devops链路，通过kubesphere集成了很多套件")]),e._v(" "),a("ul",[a("li",[e._v("https://kubesphere.io/zh/ ：集群要求高")]),e._v(" "),a("li",[e._v("https://kuboard.cn/：开源kuboard也不错，集群要求不高【轻量级】")])]),e._v(" "),a("h2",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[e._v("#")]),e._v(" 简介")]),e._v(" "),a("p",[e._v("KubeSphere是一款面向云原生设计的开源项目，在目前主流容器调度平台Kubernetes之上构建的分布式多租户容器管理平台，提供简单易用的操作界面以及向导式操作方式，在降低用户使用容器调度平台学习成本的同时，极大降低开发、测试、运维的日常工作的复杂度。")]),e._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[e._v("#")]),e._v(" 安装")]),e._v(" "),a("h3",{attrs:{id:"前提条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前提条件"}},[e._v("#")]),e._v(" 前提条件")]),e._v(" "),a("p",[e._v("https://kubesphere.com.cn/docs/quick-start/minimal-kubesphere-on-k8s/")]),e._v(" "),a("ul",[a("li",[e._v("Kubernetes 版本必须为 “1.15.x，1.16.x，1.17.x 或 1.18.x”；")]),e._v(" "),a("li",[e._v("确保您的计算机满足最低硬件要求：CPU > 1 核，内存 > 2 G；")]),e._v(" "),a("li",[e._v("在安装之前，需要配置 Kubernetes 集群中的默认存储类；")]),e._v(" "),a("li",[e._v("当使用 "),a("code",[e._v("--cluster-signing-cert-file")]),e._v(" 和 "),a("code",[e._v("--cluster-signing-key-file")]),e._v(" 参数启动时，在 kube-apiserver 中会激活 CSR 签名功能。 请参阅 "),a("a",{attrs:{href:"https://github.com/kubesphere/kubesphere/issues/1925#issuecomment-591698309",target:"_blank",rel:"noopener noreferrer"}},[e._v("RKE 安装问题"),a("OutboundLink")],1),e._v("；")]),e._v(" "),a("li",[e._v("有关在 Kubernetes 上安装 KubeSphere 的前提条件的详细信息，请参阅"),a("a",{attrs:{href:"https://kubesphere.com.cn/docs/installing-on-kubernetes/introduction/prerequisites/",target:"_blank",rel:"noopener noreferrer"}},[e._v("前提条件"),a("OutboundLink")],1),e._v("。")])]),e._v(" "),a("h3",{attrs:{id:"安装helm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装helm"}},[e._v("#")]),e._v(" 安装helm")]),e._v(" "),a("p",[e._v("下面我们需要在 "),a("strong",[e._v("master")]),e._v(" 节点安装 "),a("strong",[e._v("helm")])]),e._v(" "),a("p",[e._v("Helm是Kubernetes的包管理器。包管理器类似于我们在 "),a("strong",[e._v("Ubuntu")]),e._v(" 中使用的 "),a("strong",[e._v("apt")]),e._v("。"),a("strong",[e._v("Centos")]),e._v(" 中使用的 "),a("strong",[e._v("yum")]),e._v(" 或者"),a("strong",[e._v("Python")]),e._v(" 中的 "),a("strong",[e._v("pip")]),e._v(" 一样，能快速查找、下载和安装软件包。Helm由客户端组件helm和服务端组件Tiller组成，能够将一组K8S资源打包统一管理，是查找、共享和使用为Kubernetes构建的软件的最佳方式。")]),e._v(" "),a("p",[e._v("安装3.0的 helm 首先我们需要去 "),a("a",{attrs:{href:"https://helm.sh/docs/intro/quickstart/",target:"_blank",rel:"noopener noreferrer"}},[e._v("官网下载"),a("OutboundLink")],1)]),e._v(" "),a("ul",[a("li",[e._v("第一步，"),a("a",{attrs:{href:"https://github.com/helm/helm/releases",target:"_blank",rel:"noopener noreferrer"}},[e._v("下载helm"),a("OutboundLink")],1),e._v("安装压缩文件，上传到linux系统中")]),e._v(" "),a("li",[e._v("第二步，解压helm压缩文件，把解压后的helm目录复制到 usr/bin 目录中")]),e._v(" "),a("li",[e._v("使用命令：helm")])]),e._v(" "),a("h2",{attrs:{id:"部署kubesphere"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署kubesphere"}},[e._v("#")]),e._v(" 部署KubeSphere")]),e._v(" "),a("h3",{attrs:{id:"安装前"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装前"}},[e._v("#")]),e._v(" 安装前")]),e._v(" "),a("p",[e._v("如果您的服务器无法访问 GitHub，则可以分别复制 "),a("a",{attrs:{href:"https://github.com/kubesphere/ks-installer/releases/download/v3.0.0/kubesphere-installer.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("kubesphere-installer.yaml"),a("OutboundLink")],1),e._v(" 和 "),a("a",{attrs:{href:"https://github.com/kubesphere/ks-installer/releases/download/v3.0.0/cluster-configuration.yaml",target:"_blank",rel:"noopener noreferrer"}},[e._v("cluster-configuration.yaml"),a("OutboundLink")],1),e._v(" 中的内容并将其粘贴到本地文件中。然后，您可以对本地文件使用 "),a("code",[e._v("kubectl apply -f")]),e._v(" 来安装 KubeSphere。")]),e._v(" "),a("p",[e._v("同时查看k8s集群的默认存储类")]),e._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl get storageclass\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"/images/image-20201123094120860.png",alt:"image-20201123094120860"}})]),e._v(" "),a("p",[e._v("如果没有默认存储类，那么就需要安装默认的存储类，参考博客："),a("a",{attrs:{href:"http://moguit.cn/#/info?blogOid=575",target:"_blank",rel:"noopener noreferrer"}},[e._v("Kubernetes配置默认存储类"),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("因为我安装的是 "),a("strong",[e._v("nfs")]),e._v("，所以在安装了 "),a("strong",[e._v("nfs")]),e._v(" 服务器启动")]),e._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("systemctl start nfs\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h3",{attrs:{id:"开始安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开始安装"}},[e._v("#")]),e._v(" 开始安装")]),e._v(" "),a("p",[e._v("如果无法正常访问github，可以提前把文件下载到本地")]),e._v(" "),a("div",{staticClass:"language-BASH line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("kubectl apply -f https://github.com/kubesphere/ks-installer/releases/download/v3.0.0/kubesphere-installer.yaml\n\nkubectl apply -f https://github.com/kubesphere/ks-installer/releases/download/v3.0.0/cluster-configuration.yaml\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("如果下载到了本地，可以这样安装")]),e._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 安装")]),e._v("\nkubectl apply -f kubesphere-installer.yaml\nkubectl apply -f cluster-configuration.yaml\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 卸载")]),e._v("\nkubectl delete -f kubesphere-installer.yaml\nkubectl delete -f cluster-configuration.yaml\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br")])]),a("h3",{attrs:{id:"检查安装日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检查安装日志"}},[e._v("#")]),e._v(" 检查安装日志")]),e._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl logs -n kubesphere-system "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$(")]),e._v("kubectl get pod -n kubesphere-system -l "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("ks-install -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'{.items[0].metadata.name}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v(")")])]),e._v(" -f\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("然后在查看pod运行状况")]),e._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl get pod -n kubesphere-system\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("能够发现，我们还有两个容器正在创建")]),e._v(" "),a("p",[a("img",{attrs:{src:"/images/image-20210110104812804.png",alt:"image-20210110104812804"}})]),e._v(" "),a("p",[e._v("使用 "),a("code",[e._v("kubectl get pod --all-namespaces")]),e._v(" 查看所有 Pod 是否在 KubeSphere 的相关命名空间中正常运行。")]),e._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl get pods --all-namespaces\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("能够发现所有的节点已经成功运行")]),e._v(" "),a("p",[a("img",{attrs:{src:"/images/image-20210113102423851.png",alt:"image-20210113102423851"}})]),e._v(" "),a("p",[e._v("如果是，请通过以下命令检查控制台的端口：")]),e._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl get svc/ks-console -n kubesphere-system\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("能够看到我们的服务确保在安全组中打开了端口 30880，并通过 NodePort（IP：30880）")]),e._v(" "),a("p",[a("img",{attrs:{src:"/images/image-20201123152147871.png",alt:"image-20201123152147871"}})]),e._v(" "),a("p",[e._v("使用默认帐户和密码（admin/P@88w0rd）访问 Web 控制台。")]),e._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 图形化页面  admin  P@88w0rd")]),e._v("\nhttp://192.168.177.130:30880/\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("登录控制台后，您可以在组件中检查不同组件的状态。如果要使用相关服务，可能需要等待某些组件启动并运行。")]),e._v(" "),a("p",[a("img",{attrs:{src:"/images/kubesphere-components-zh.png",alt:"components"}})]),e._v(" "),a("h2",{attrs:{id:"错误排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误排查"}},[e._v("#")]),e._v(" 错误排查")]),e._v(" "),a("h3",{attrs:{id:"错误1"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误1"}},[e._v("#")]),e._v(" 错误1")]),e._v(" "),a("p",[e._v("kubesphere无法登录，提示account is not active")]),e._v(" "),a("p",[a("img",{attrs:{src:"/images/image-20210110110018004.png",alt:"image-20210110110018004"}})]),e._v(" "),a("p",[e._v("kubesphere 安装完成后会创建默认账户admin/P@88w0rd，待ks-controller-manager启动就绪，user controller 会将 user CRD中定义的password加密，user会被转换为active状态，至此账户才可以正常登录。")]),e._v(" "),a("p",[e._v("当安装完成后遇到默认账户无法登录，看到account is not active相关错误提示时，需要检查ks-controller-manager的运行状态和日志。常见问题及解决方式如下:")]),e._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("kubectl -n kubesphere-system get ValidatingWebhookConfiguration users.iam.kubesphere.io -o yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">>")]),e._v(" users.iam.kubesphere.io.yaml\n\nkubectl -n kubesphere-system get secret ks-controller-manager-webhook-cert -o yaml "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">>")]),e._v(" ks-controller-manager-webhook-cert.yaml\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# edit ca as pr")]),e._v("\nkubectl -n kubesphere-system apply -f ks-controller-manager-webhook-cert.yaml\nkubectl -n kubesphere-system apply -f users.iam.kubesphere.io.yaml\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# restart")]),e._v("\nkubectl -n kubesphere-system rollout restart deploy ks-controller-manager\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br")])]),a("p",[e._v("来源：https://kubesphere.com.cn/forum/d/2217-account-is-not-active")])])}),[],!1,null,null,null);s.default=r.exports}}]);