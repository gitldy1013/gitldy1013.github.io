(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{718:function(s,e,a){"use strict";a.r(e);var n=a(5),t=Object(n.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("æœ¬æ–‡æ•´ç†åœ¨ Ubuntu 16.04.x LTS æ“ä½œç³»ç»Ÿä¸Šå®¹å™¨ç›¸å…³éƒ¨ç½²æ‰‹å†Œ")]),s._v(" "),a("p",[s._v("å®¹å™¨å¹³å°")]),s._v(" "),a("ul",[a("li",[s._v("Rancher")]),s._v(" "),a("li",[s._v("Kubernetes")]),s._v(" "),a("li",[s._v("Helm")]),s._v(" "),a("li",[s._v("Docker")])]),s._v(" "),a("p",[s._v("å®¹å™¨æœåŠ¡")]),s._v(" "),a("ul",[a("li",[s._v("prometheus")]),s._v(" "),a("li",[s._v("grafana")]),s._v(" "),a("li",[s._v("postgresql")])]),s._v(" "),a("h1",{attrs:{id:"_1-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-docker"}},[s._v("#")]),s._v(" 1.Docker")]),s._v(" "),a("h2",{attrs:{id:"_1-1-apt-source"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-apt-source"}},[s._v("#")]),s._v(" 1.1.apt source")]),s._v(" "),a("p",[s._v("æ›´æ¢aptæºå¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥åŠ å¿«è½¯ä»¶ä¸‹è½½é€Ÿåº¦ã€‚")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cp /etc/apt/sources.list /etc/apt/sources.list.bak\n\n# é˜¿é‡Œæº\ntee > /etc/apt/sources.list << EOF\ndeb http://mirrors.aliyun.com/ubuntu/ xenial main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-proposed main restricted universe multiverse\ndeb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse\n#deb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted universe multiverse\n#deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted universe multiverse\n#deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted universe multiverse\n#deb-src http://mirrors.aliyun.com/ubuntu/ xenial-proposed main restricted universe multiverse\n#deb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse\nEOF\n\n# æ¸…åæº\ntee > /etc/apt/sources.list << EOF\n#deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse\n#deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse\n#deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse\n#deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse\n#deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse\nEOF\n\n# ä¸­ç§‘å¤§æº\ntee > /etc/apt/sources.list << EOF\ndeb https://mirrors.ustc.edu.cn/ubuntu/ bionic main restricted universe multiverse\n#deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic main restricted universe multiverse\ndeb https://mirrors.ustc.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse\n#deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse\ndeb https://mirrors.ustc.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse\n#deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse\ndeb https://mirrors.ustc.edu.cn/ubuntu/ bionic-security main restricted universe multiverse\n#deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-security main restricted universe multiverse\ndeb https://mirrors.ustc.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse\n#deb-src https://mirrors.ustc.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse\nEOF\n\n# ç½‘æ˜“æº\ntee > /etc/apt/sources.list << EOF\ndeb http://mirrors.163.com/ubuntu/ bionic main restricted universe multiverse\ndeb http://mirrors.163.com/ubuntu/ bionic-security main restricted universe multiverse\ndeb http://mirrors.163.com/ubuntu/ bionic-updates main restricted universe multiverse\ndeb http://mirrors.163.com/ubuntu/ bionic-proposed main restricted universe multiverse\ndeb http://mirrors.163.com/ubuntu/ bionic-backports main restricted universe multiverse\n#deb-src http://mirrors.163.com/ubuntu/ bionic main restricted universe multiverse\n#deb-src http://mirrors.163.com/ubuntu/ bionic-security main restricted universe multiverse\n#deb-src http://mirrors.163.com/ubuntu/ bionic-updates main restricted universe multiverse\n#deb-src http://mirrors.163.com/ubuntu/ bionic-proposed main restricted universe multiverse\n#deb-src http://mirrors.163.com/ubuntu/ bionic-backports main restricted universe multiverse\nEOF\n\napt update\n# apt upgrade\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br")])]),a("p",[s._v("å¤‡æ³¨ï¼š")]),s._v(" "),a("p",[s._v("â€œteeâ€å¯ä»¥æ›¿æ¢æˆâ€œcatâ€ï¼Œæœ‰äº›æ“ä½œç³»ç»Ÿå¯ä»¥ç”¨â€œteeâ€ä½†æ˜¯æ²¡æœ‰â€œcatâ€ã€‚")]),s._v(" "),a("p",[s._v("â€œ>â€è¡¨ç¤ºè¦†å†™æ–‡ä»¶ï¼Œâ€œ>>â€è¡¨ç¤ºåœ¨æ–‡ä»¶å°¾éƒ¨æ·»åŠ ã€‚â€œteeâ€å¯ä»¥çœç•¥â€œ>â€æ¥è¦†å†™ï¼Œâ€œcatâ€ä¸èƒ½çœç•¥ã€‚")]),s._v(" "),a("p",[s._v("â€œdebâ€æ˜¯æŒ‡debåŒ…ç›®å½•ï¼›â€œdeb-srcâ€æ˜¯æºç ç›®å½•ï¼Œä¸€èˆ¬æ³¨é‡Šæ‰ã€‚")]),s._v(" "),a("h2",{attrs:{id:"_1-2-install-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-install-docker"}},[s._v("#")]),s._v(" 1.2.install docker")]),s._v(" "),a("p",[s._v("å®˜ç½‘")]),s._v(" "),a("p",[s._v("https://docs.docker.com/engine/install/ubuntu/")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('sudo apt-get install \\\n    apt-transport-https \\\n    ca-certificates \\\n    curl \\\n    gnupg-agent \\\n    software-properties-common\n\n\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\n\n\nsudo add-apt-repository \\\n   "deb [arch=amd64] https://download.docker.com/linux/ubuntu \\\n   $(lsb_release -cs) \\\n   stable"\n\n\nsudo apt-get update\n\nsudo apt-get install docker-ce docker-ce-cli containerd.io\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("æŒ‡å®šç‰ˆæœ¬")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("apt-cache madison docker-ce\nsudo apt-get install docker-ce=<VERSION_STRING> docker-ce-cli=<VERSION_STRING> containerd.io\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"_1-3-docker-source"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-docker-source"}},[s._v("#")]),s._v(" 1.3.docker source")]),s._v(" "),a("p",[s._v("é…ç½®é•œåƒåŠ é€Ÿå™¨")]),s._v(" "),a("p",[s._v("https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('sudo mkdir -p /etc/docker\nsudo tee /etc/docker/daemon.json <<-\'EOF\'\n{\n  "registry-mirrors": ["https://aykfevb9.mirror.aliyuncs.com"],\n  "insecure-registries":["https://10.22.224.66"]\n}\nEOF\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"_1-4-postgresql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-postgresql"}},[s._v("#")]),s._v(" 1.4.postgresql")]),s._v(" "),a("p",[s._v("docker hub")]),s._v(" "),a("p",[s._v("https://hub.docker.com/_/postgres")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker run -d \\\n  --name postgres \\\n  -p 5432:5432 -it -e POSTGRES_PASSWORD=password \\\n  postgres\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("å¤‡æ³¨ï¼š")]),s._v(" "),a("p",[s._v("â€œ--rmâ€è¡¨ç¤º Automatically remove the container when it exitsã€‚è¡¨ç¤ºä¸´æ—¶è¿è¡Œå®¹å™¨ï¼Œå’Œâ€œ-dâ€åå°è¿è¡Œâ€œå†²çªâ€ã€‚-â€œ-rmâ€ç­‰ä»·äºå½“å®¹å™¨åœ¨å‰å°è¿è¡Œï¼Œé€€å‡ºåæ‰§è¡Œäº† docker rm -v")]),s._v(" "),a("p",[s._v("â€œ-eâ€è¡¨ç¤ºç¯å¢ƒå˜é‡")]),s._v(" "),a("p",[s._v("â€œ-iâ€è¡¨ç¤ºä»¥â€œäº¤äº’æ¨¡å¼â€è¿è¡Œå®¹å™¨ï¼Œè®©å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¿æŒæ‰“å¼€")]),s._v(" "),a("p",[s._v("â€œ-tâ€è¡¨ç¤ºå®¹å™¨å¯åŠ¨åä¼šè¿›å…¥å…¶å‘½ä»¤è¡Œï¼Œè®©Dockeråˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ï¼ˆpseudo-ttyï¼‰å¹¶ç»‘å®šåˆ°å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¸Š")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker exec -it postgres bash\npsql -U postgres\n\npostgres=# create table test (id int primary key not null, value text not null);\nCREATE TABLE\npostgres=# insert into test values (1, 'value1');\nINSERT 0 1\npostgres=# select * from test;\n id | value\n----+--------\n  1 | value1\n(1 row)\n\n\\q\nexit\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h3",{attrs:{id:"_1-4-1-pgagent"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-1-pgagent"}},[s._v("#")]),s._v(" 1.4.1.pgagent")]),s._v(" "),a("p",[s._v("åˆ¶ä½œé•œåƒ")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mkdir /dockerfile\ntee > Dockerfile << EOF\nFROM postgres\nRUN apt-get update\nRUN apt-get install -y pgagent\nEOF\ndocker build -t pg-pgagent .\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("ç»‘å®šæ’ä»¶")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker run --name mypgpgagent -e POSTGRES_PASSWORD=123456 -p 5432:5432 -d pg-pgagent\n\ndocker exec -it mypgpgagent /bin/bash\npsql -U postgres\nCREATE EXTENSION pgagent;\n\\q\n/usr/bin/pgagent hostaddr=127.0.0.1 dbname=postgres user=postgres password=123456 -s ./pgagent.log\nexit\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("åœ¨pgadminä¸­é€‰æ‹©è¿œç¨‹è¿æ¥è¦æ‰§è¡Œå®šæ—¶ä»»åŠ¡çš„host, port, dbname, user, password,...")]),s._v(" "),a("p",[s._v("æµ‹è¯•æ—¶pgagent.logä¸­æ²¡æœ‰å†™å…¥")]),s._v(" "),a("h3",{attrs:{id:"_1-4-2-pgadmin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-2-pgadmin"}},[s._v("#")]),s._v(" 1.4.2.pgadmin")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('docker run -p 5050:80 \\\n  -e "PGADMIN_DEFAULT_EMAIL=user@domain.com" \\\n  -e "PGADMIN_DEFAULT_PASSWORD=SuperSecret" \\\n  -d dpage/pgadmin4\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"_1-5-prometheus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-prometheus"}},[s._v("#")]),s._v(" 1.5.prometheus")]),s._v(" "),a("p",[s._v("*å¯ä»¥åœ¨rancherä¸­å¿«é€Ÿé…ç½®")]),s._v(" "),a("p",[s._v("â€œprometheus.ymlâ€ä¸­å®šä¹‰äº†è¦ç›‘æ§çš„å¯¹è±¡ï¼Œä»¥â€œjob_nameâ€è¿›è¡Œåˆ†ç±»ã€‚")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("vim /path/prometheus.yml\n\ndocker run  -d \\\n  --name prometheus \\\n  -p 9090:9090 \\\n  -v /path/prometheus.yml:/etc/prometheus/prometheus.yml  \\\n  prom/prometheus\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("å¤‡æ³¨ï¼š")]),s._v(" "),a("p",[s._v("â€œ-pâ€è¡¨ç¤ºç«¯å£æ˜ å°„ï¼Œâ€œ:â€å·¦è¾¹çš„ç«¯å£ç†è§£ä¸ºç›®æ ‡ç«¯å£ï¼Œåœ¨è¿™é‡Œæ˜¯ä¸»æœºçš„ç«¯å£ï¼›å³è¾¹çš„ç«¯å£æ˜¯å®¹å™¨å†… prometheus ç¨‹åºæš´éœ²çš„ç«¯å£ã€‚ä¸€èˆ¬ä¿®æ”¹å·¦è¾¹çš„ç«¯å£ï¼Œç”¨ä»¥æš´éœ²æœåŠ¡ã€‚")]),s._v(" "),a("p",[s._v("â€œ-vâ€è¡¨ç¤ºæŒ‚è½½ï¼Œâ€œ:â€å·¦è¾¹æ˜¯æœ¬æœºè·¯å¾„ï¼›å³è¾¹æ˜¯å®¹å™¨å†…è·¯å¾„ã€‚")]),s._v(" "),a("p",[s._v("prometheus.yml ç¤ºä¾‹")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("scrape_configs:\n  - job_name: prometheus\n    static_configs:\n      - targets: ['10.22.224.71:9090']\n\n  - job_name: postgres_exporter\n    static_configs:\n      - targets: ['10.22.224.71:9187']\n\n  - job_name: node_exporter\n    static_configs:\n      - targets: ['10.22.224.71:9100']\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("kubernetes_sd_config")]),s._v(" "),a("p",[s._v("https://prometheus.io/docs/prometheus/latest/configuration/configuration/#kubernetes_sd_config")]),s._v(" "),a("p",[s._v("ä½¿ç”¨å®¹å™¨è¿è¡Œ prometheus ä¸èƒ½åŠ¨æ€åˆ·æ–° prometheus.yml")]),s._v(" "),a("p",[s._v("--web.enable-lifecycle")]),s._v(" "),a("p",[s._v("https://prometheus.io/docs/prometheus/latest/management_api/")]),s._v(" "),a("p",[s._v("https://www.cnblogs.com/wurijie/p/11795711.html")]),s._v(" "),a("p",[s._v("kill -HUP pid")]),s._v(" "),a("p",[s._v("curl -X POST http://10.22.224.71:3001/-/reload")]),s._v(" "),a("h3",{attrs:{id:"_1-5-1-postgres-exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-1-postgres-exporter"}},[s._v("#")]),s._v(" 1.5.1.postgres_exporter")]),s._v(" "),a("p",[s._v("å®˜ç½‘")]),s._v(" "),a("p",[s._v("https://github.com/wrouesnel/postgres_exporter")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('docker run -d \\\n  --name postgres_exporter \\\n  -p 9187:9187 \\\n  -e DATA_SOURCE_NAME="postgresql://postgres:password@192.168.0.100:5432/postgres?sslmode=disable" \\\n  wrouesnel/postgres_exporter\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"_1-5-2-node-exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-2-node-exporter"}},[s._v("#")]),s._v(" 1.5.2.node_exporter")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('docker run -d \\\n  --name node_exporter \\\n  --net="host" \\  \n  -p 9100:9100 \\\n  -v "/proc:/host/proc:ro" \\\n  -v "/sys:/host/sys:ro" \\\n  -v "/:/rootfs:ro" \\\n  prom/node-exporter\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h2",{attrs:{id:"_1-6-grafana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-grafana"}},[s._v("#")]),s._v(" 1.6.grafana")]),s._v(" "),a("p",[s._v("*å¯ä»¥åœ¨rancherä¸­å¿«é€Ÿé…ç½®")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker run -d \\\n  --name=grafana \\\n  -p 3000:3000 \\\n  grafana/grafana\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("é»˜è®¤ç”¨æˆ·åå¯†ç  admin/admin")]),s._v(" "),a("h3",{attrs:{id:"_1-6-1-alert-dingding"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-1-alert-dingding"}},[s._v("#")]),s._v(" 1.6.1.alert - dingding")]),s._v(" "),a("p",[s._v("é’‰é’‰å¼€å‘æ–‡æ¡£")]),s._v(" "),a("p",[s._v("https://ding-doc.dingtalk.com/doc#/serverapi2/qf2nxq")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("ä»…åœ¨pcç«¯dingdingå®¢æˆ·ç«¯ä¸Šèƒ½åˆ›å»ºwebhook\nåœ¨å·¦ä¸Šè§’å¤„é€‰æ‹©â€œæœºå™¨äººç®¡ç†â€--\x3eâ€œè‡ªå®šä¹‰â€ï¼Œâ€œå®‰å…¨è®¾ç½®â€é€‰æ‹©â€œè‡ªå®šä¹‰å…³é”®è¯â€ï¼Œå³åŒ…å«è¯¥å…³é”®è¯æ‰èƒ½å‘é€æŠ¥è­¦ï¼Œè®°ä½æœ€ç»ˆç”Ÿæˆçš„webhook\n"),a("img",{attrs:{src:"/images/1587988512682-beed08e0-a1f2-4809-bfab-98b5253610af.png",alt:"image"}}),s._v(" "),a("img",{attrs:{src:"/images/1587988610421-81bd3819-5a3d-4f14-8f80-f1c8e5b90329.png",alt:"image"}}),s._v(" "),a("img",{attrs:{src:"/images/1587988702278-175f3247-b5bd-4a40-834e-bfdfe4fba5d3.png",alt:"image"}}),s._v(" "),a("img",{attrs:{src:"/images/1587988437050-b19bcf36-2577-45eb-96d2-d88fd65507fa.png",alt:"image"}})])]),s._v(" "),a("li",[a("p",[s._v("grafanaé…ç½®æŠ¥è­¦")])]),s._v(" "),a("li",[a("ol",[a("li",[s._v("é…ç½®å…¨å±€çš„dingdingæŠ¥è­¦ï¼Œè¾“å…¥webhook")]),s._v(" "),a("li",[s._v("åœ¨å…·ä½“çš„å›¾è¡¨ä¸­é…ç½®æŠ¥è­¦é€‰æ‹©å·²é…ç½®çš„dingdingæŠ¥è­¦\n"),a("img",{attrs:{src:"/images/1587989954726-3f5b6a7f-15cf-434a-b526-66522eaca98b.png",alt:"image"}}),a("img",{attrs:{src:"/images/1587990143702-1cefd6df-0f83-4e68-846e-cf8e4ebdb123.png",alt:"image"}}),a("img",{attrs:{src:"/images/1587990196040-4e320a97-10e1-4362-8dcf-efbf2ef6c3ff.png",alt:"image"}}),a("img",{attrs:{src:"/images/1587991013837-715ba47b-c043-4236-906b-6d1e406a162f.png",alt:"image"}})])])])]),s._v(" "),a("h3",{attrs:{id:"_1-6-2-dashboard-template"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-6-2-dashboard-template"}},[s._v("#")]),s._v(" 1.6.2.dashboard template")]),s._v(" "),a("p",[s._v("https://grafana.com/grafana/dashboards?orderBy=name&direction=asc")]),s._v(" "),a("p",[s._v("https://grafana.com/grafana/dashboards/11376")]),s._v(" "),a("p",[a("img",{attrs:{src:"/images/1587985751427-8e176c22-6bf1-410e-af31-4d36f2462c44.png",alt:"image"}})]),s._v(" "),a("p",[s._v("åŸºäºdocker æ­å»ºPrometheus+Grafana")]),s._v(" "),a("p",[s._v("https://www.cnblogs.com/xiao987334176/p/9930517.html")]),s._v(" "),a("p",[s._v("Grafana + Prometheus ç›‘æ§PostgreSQL")]),s._v(" "),a("p",[s._v("https://www.cnblogs.com/ilifeilong/p/10543876.html")]),s._v(" "),a("h1",{attrs:{id:"_2-rancher"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-rancher"}},[s._v("#")]),s._v(" 2.rancher")]),s._v(" "),a("p",[s._v("å®˜ç½‘")]),s._v(" "),a("p",[s._v("https://rancher.com/docs/rancher/v2.x/en/installation/other-installation-methods/single-node-docker/")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker run -d --restart=unless-stopped -p 80:80 -p 443:443 rancher/rancher:stable\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("å¦‚æœä¸‹è½½æ…¢ï¼Œå¯ä»¥æ¢æº")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker run -d --restart=unless-stopped -p 80:80 -p 443:443 registry.cn-hangzhou.aliyuncs.com/rancher/rancher:v2.4.2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("åœ¨rancherä¸­å¯ä»¥å¿«é€Ÿåˆ›å»ºk8sé›†ç¾¤ï¼Œrancherä¼šç”Ÿæˆä¸€æ®µå‘½ä»¤ï¼ŒæŠŠå‘½ä»¤å¤åˆ¶åˆ°ç›®æ ‡èŠ‚ç‚¹å°±å¯ä»¥å¿«é€Ÿåˆ›å»ºé›†ç¾¤ã€‚")]),s._v(" "),a("h1",{attrs:{id:"_3-kubernetes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-kubernetes"}},[s._v("#")]),s._v(" 3.Kubernetes")]),s._v(" "),a("p",[s._v("æœ¬åœ°è¿è¡Œ k8s https://github.com/kubernetes/community/blob/master/contributors/devel/running-locally.md")]),s._v(" "),a("h2",{attrs:{id:"_3-1-prepare-env"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-prepare-env"}},[s._v("#")]),s._v(" 3.1.prepare env")]),s._v(" "),a("p",[s._v("port")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("vim /etc/ssh/sshd_config\nservice ssh restart\nsudo reboot\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("hostname")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("hostnamectl set-hostname master01\nsudo reboot\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("hosts")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cat > /etc/hosts << EOF\n10.22.243.114 master01\n10.22.243.124 node01\n10.22.243.125 node02\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("scp åˆ†å‘")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("scp -P 5022 /etc/hosts root@node01:/etc/hosts\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç¡®è®¤å·²ç»å…³é—­ firewall, swap, selinux, iptables")]),s._v(" "),a("h2",{attrs:{id:"_3-2-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-docker"}},[s._v("#")]),s._v(" 3.2.docker")]),s._v(" "),a("p",[s._v("è§1.2")]),s._v(" "),a("h2",{attrs:{id:"_3-3-tools"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-tools"}},[s._v("#")]),s._v(" 3.3.tools")]),s._v(" "),a("p",[s._v("https://v1-16.docs.kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("apt-get update && apt-get install -y apt-transport-https curl\n\nsudo curl -s https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | sudo apt-key add -\n\ncat > /etc/apt/sources.list.d/kubernetes.list <<EOF\ndeb https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main\nEOF\n\napt-get update && apt-get install -y kubelet kubeadm kubectl\n\napt-mark hold kubelet kubeadm kubectl\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h2",{attrs:{id:"_3-4-init-cluster"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-init-cluster"}},[s._v("#")]),s._v(" 3.4.init cluster")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("kubeadm init --apiserver-advertise-address 10.22.224.113 \\\n  --pod-network-cidr=10.244.0.0/16 \\\n  --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("blockquote",[a("p",[s._v("Your Kubernetes control-plane has initialized successfully!")]),s._v(" "),a("p",[s._v("To start using your cluster, you need to run the following as a regular user:")]),s._v(" "),a("p",[s._v("mkdir -p $HOME/.kube")]),s._v(" "),a("p",[s._v("sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config")]),s._v(" "),a("p",[s._v("sudo chown $(id -u)ğŸ˜’(id -g) $HOME/.kube/config")]),s._v(" "),a("p",[s._v("You should now deploy a pod network to the cluster.")]),s._v(" "),a("p",[s._v('Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:')]),s._v(" "),a("p",[s._v("https://kubernetes.io/docs/concepts/cluster-administration/addons/")]),s._v(" "),a("p",[s._v("Then you can join any number of worker nodes by running the following on each as root:")]),s._v(" "),a("p",[s._v("kubeadm join 10.22.224.113:6443 --token peyc01.8mgmnj6k6zntq84s \\")]),s._v(" "),a("p",[s._v("--discovery-token-ca-cert-hash sha256:ff2b928d246d5fdd8c27c152ab013df5fd665bb13f01184d8fb498f3d50fb554")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("mkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"_3-5-flannel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-flannel"}},[s._v("#")]),s._v(" 3.5.flannel")]),s._v(" "),a("p",[s._v("https://v1-16.docs.kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/")]),s._v(" "),a("p",[s._v("https://raw.githubusercontent.com/coreos/flannel/2140ac876ef134e0ed5af15c65e414cf26827915/Documentation/kube-flannel.yml")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("flannelé•œåƒä¸‹è½½æ…¢å¯ä»¥åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸‹è½½ç„¶ååˆ†å‘ï¼Œè§4.2")]),s._v(" "),a("h2",{attrs:{id:"_3-6-join-cluster"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-join-cluster"}},[s._v("#")]),s._v(" 3.6.join cluster")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" kubeadm join 10.22.224.113:6443 --token peyc01.8mgmnj6k6zntq84s \\\n   --discovery-token-ca-cert-hash sha256:ff2b928d246d5fdd8c27c152ab013df5fd665bb13f01184d8fb498f3d50fb554\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"_3-7-dashboard"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-7-dashboard"}},[s._v("#")]),s._v(" 3.7.dashboard")]),s._v(" "),a("p",[s._v("æ— è¯ä¹¦dashboardç«ç‹å¯ä»¥è®¿é—®")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta5/aio/deploy/recommended.yaml\nkubectl patch svc -n kubernetes-dashboard kubernetes-dashboard -p \'{"spec":{"type":"NodePort"}}\'\nkubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk \'{print $1}\')\nkubectl get svc -n kubernetes-dashboard\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("æœ‰è¯ä¹¦dashboard")]),s._v(" "),a("p",[s._v("https://github.com/kubernetes/dashboard/releases")]),s._v(" "),a("p",[s._v("https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-rc1/aio/deploy/recommended.yaml")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('mkdir keys\ncd keys\n\n# åˆ›å»ºç©ºç™½è¯ä¹¦\nopenssl genrsa -out ca.key 2048\nopenssl req -new -x509 -key ca.key -out ca.crt -days 3650 -subj "/C=CN/ST=HB/L=WH/O=DM/OU=YPT/CN=CA"\n\n# åˆ›å»º dashboard è¯ä¹¦\n(umask 077; openssl genrsa -out dashboard.key 2048)\nopenssl req -new -key dashboard.key  -out dashboard.csr -subj "/O=zhixin/CN=dashboard"\nopenssl  x509 -req -in dashboard.csr -CA ca.crt -CAkey ca.key  -CAcreateserial -out dashboard.crt -days 3650\n\n\nkubectl create namespace kubernetes-dashboard\n\nkubectl create secret generic kubernetes-dashboard-certs -n kubernetes-dashboard --from-file=dashboard.crt=./dashboard.crt  --from-file=dashboard.key=./dashboard.key\nkubectl get secret -n kubernetes-dashboard |grep dashboard\n\nkubectl create serviceaccount kubernetes-dashboard -n kubernetes-dashboard\nkubectl get sa -n kubernetes-dashboard |grep kubernetes-dashboard\n\nkubectl create clusterrolebinding kubernetes-dashboard --clusterrole=cluster-admin --serviceaccount=kubernetes-dashboard:kubernetes-dashboard\n\nkubectl get secret -n kubernetes-dashboard |grep dashboard\nkubectl describe secret kubernetes-dashboard-token-tptw4 -n kubernetes-dashboard\n\nkubectl apply -f recommended.yaml\nkubectl get svc -n kubernetes-dashboard\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("p",[s._v("åˆ é™¤dashboard")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("kubectl delete ns kubernetes-dashboard\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_3-8-helm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-8-helm"}},[s._v("#")]),s._v(" 3.8.helm")]),s._v(" "),a("p",[s._v("https://helm.sh/docs/intro/install/")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo snap install helm --classic\nhelm repo add stable https://kubernetes-charts.storage.googleapis.com/\n# helm pull stable/stolon\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"_3-9-stolon-helm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-9-stolon-helm"}},[s._v("#")]),s._v(" 3.9.stolon - helm")]),s._v(" "),a("p",[s._v("https://hub.helm.sh/charts/stable/stolon")]),s._v(" "),a("p",[s._v("åœ¨rancherä¸­æå‰é…ç½®å¥½â€œstorageClassNameâ€å’Œâ€œPVâ€")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('helm pull stable/stolon\n\nvim value.yaml\n#########################\nimage:\n  repository: sorintlab/stolon\n  tag: v0.16.0-pg10\n  \nâ€‹````````````````````````\n  \npersistence:\n  enabled: true\n  storageClassName: "local-storage-class"\n  accessModes:\n  - ReadWriteOnce\n  size: 50Gi \n  \nâ€‹````````````````````````  \n  \nsuperuserUsername: "stolon"\nsuperuserPassword: "admin163"\nreplicationUsername: "repluser"\nreplicationPassword: "admin163"  \n#############################\n\nhelm install -n stolon my-stolon ./stolon\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("p",[s._v("å¤‡æ³¨ï¼š")]),s._v(" "),a("p",[s._v("stolonçš„â€œ--dry-runâ€å¯ä»¥â€œsimulate an installâ€ç”Ÿæˆymlæ–‡ä»¶")]),s._v(" "),a("p",[s._v("helm install xxx-release-name ./stolon --dry-run")]),s._v(" "),a("p",[s._v("appendix")]),s._v(" "),a("p",[s._v("æ‰‹åŠ¨ç”Ÿæˆâ€œStorageClassâ€å’Œâ€œPersistentVolumeâ€")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("---\nkind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n  name: local-storage\nprovisioner: kubernetes.io/no-provisioner\nvolumeBindingMode: WaitForFirstConsumer\n---\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: stolonpv1\nspec:\n  capacity:\n    storage: 10Gi\n  accessModes:\n    - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: sc\n  local:\n    path: /stolon\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n      - matchExpressions:\n        - key: kubernetes.io/hostname\n          operator: In\n          values:\n          - node01\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("p",[s._v("*é€šè¿‡helmå®‰è£…ä¸éœ€è¦æ‰‹åŠ¨åŒæ­¥ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ")]),s._v(" "),a("p",[s._v("å¾…å®šï¼Œéœ€è¦æµ‹è¯•ä¸€ä¸‹")]),s._v(" "),a("p",[s._v("*å¦‚æœæŒ‰ç…§stolonçš„ç¤ºä¾‹ï¼Œä»…ä½¿ç”¨ymlæ–‡ä»¶éƒ¨ç½²ï¼Œéœ€è¦åˆå§‹åŒ–stolonï¼Œå¦åˆ™æ•°æ®åº“ä¸ä¼šåŒæ­¥")]),s._v(" "),a("p",[s._v("https://github.com/sorintlab/stolon/tree/master/examples/kubernetes")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("kubectl exec -it release-name-stolon-keeper-0 -- /bin/bash\nstolonctl  --cluster-name=release-name-stolon --store-backend=kubernetes --kube-resource-kind=configmap init\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("â€œ--cluster-nameâ€è¦å»configmapé‡Œçœ‹ä¸€ä¸‹ï¼Œè¦å¯¹åº”ä¸Š")]),s._v(" "),a("p",[s._v("stolon init ä¹‹åï¼Œpgçš„é»˜è®¤userï¼Œdbnameå’Œå¯†ç éƒ½é‡ç½®äº†ï¼Œé‡ç½®ä¸ºhelm installæ—¶çš„é…ç½®ï¼Œ")]),s._v(" "),a("p",[s._v("æ•°æ®çš„æ•°æ®ï¼Ÿ")]),s._v(" "),a("p",[s._v("æ‰‹åŠ¨æ”¹æ‰pgçš„å¯†ç ä¹‹åï¼Œstolonä¸èƒ½è¯†åˆ«äº†ï¼æ€ä¹ˆåŠï¼Ÿ")]),s._v(" "),a("h2",{attrs:{id:"_3-10-manage-k8s"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-10-manage-k8s"}},[s._v("#")]),s._v(" 3.10 manage k8s")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("windows")])]),s._v(" "),a("li",[a("p",[s._v("ubuntu")])])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo curl -s https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | sudo apt-key add -\n\ncat > /etc/apt/sources.list.d/kubernetes.list <<EOF\ndeb https://mirrors.aliyun.com/kubernetes/apt kubernetes-xenial main\nEOF\n\napt-get update && apt-get install -y kubectl\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h1",{attrs:{id:"_4-command"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-command"}},[s._v("#")]),s._v(" 4.command")]),s._v(" "),a("h2",{attrs:{id:"_4-1-linux"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-linux"}},[s._v("#")]),s._v(" 4.1.linux")]),s._v(" "),a("p",[s._v("æŸ¥çœ‹ç«¯å£ä½¿ç”¨")]),s._v(" "),a("p",[s._v("netstat -ntpa")]),s._v(" "),a("p",[s._v("netstat -ntpl")]),s._v(" "),a("p",[s._v("é«˜æ€§èƒ½æ¨¡å¼")]),s._v(" "),a("p",[s._v("apt-get install cpufrequtils")]),s._v(" "),a("p",[s._v("cpufreq-info")]),s._v(" "),a("p",[s._v("cpufreq-set -g performance")]),s._v(" "),a("p",[s._v("apt-get install sysfsutils")]),s._v(" "),a("p",[s._v("echo  -e 'devices/system/cpu/cpu0/cpufreq/scaling_governor = performance' /etc/sysfs.conf")]),s._v(" "),a("p",[s._v("ä¿®æ”¹ç«¯å£")]),s._v(" "),a("p",[s._v("vim /etc/ssh/sshd_config")]),s._v(" "),a("p",[s._v("service ssh restart")]),s._v(" "),a("h2",{attrs:{id:"_4-2-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-docker"}},[s._v("#")]),s._v(" 4.2.docker")]),s._v(" "),a("p",[s._v("docker è¿ç»´ç¬”è®°")]),s._v(" "),a("p",[s._v("https://www.cnblogs.com/kevingrace/p/5715326.html")]),s._v(" "),a("p",[s._v("è¿›å…¥å®¹å™¨")]),s._v(" "),a("p",[s._v("docker exec -it [ID] /bin/bash")]),s._v(" "),a("p",[s._v("æŸ¥çœ‹å®¹å™¨å®Œæ•´ command")]),s._v(" "),a("p",[s._v("docker ps -a --no-trunc")]),s._v(" "),a("p",[s._v("åœæ­¢åˆ é™¤æ‰€æœ‰å®¹å™¨")]),s._v(" "),a("p",[s._v("docker stop $(docker ps -aq)")]),s._v(" "),a("p",[s._v("docker rm $(docker ps -aq)")]),s._v(" "),a("p",[s._v("æ‰¹é‡åˆ é™¤é•œåƒ")]),s._v(" "),a("p",[s._v("docker image rm $(docker image ls -a -q)")]),s._v(" "),a("p",[s._v("docker rmi $(docker image ls -a -q)")]),s._v(" "),a("p",[s._v("å¯¼å‡ºå¯¼å…¥é•œåƒ")]),s._v(" "),a("p",[s._v("docker save -o flannel.tar quay.io/coreos/flannel:v0.11.0-amd64")]),s._v(" "),a("p",[s._v("docker load < flannel.tar")]),s._v(" "),a("p",[s._v("ä¿®æ”¹å®¹å™¨ä¸ºä¸€ç›´å¯åŠ¨")]),s._v(" "),a("p",[s._v("docker container update --restart=always å®¹å™¨åå­—")]),s._v(" "),a("h2",{attrs:{id:"_4-3-kubernetes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-kubernetes"}},[s._v("#")]),s._v(" 4.3.kubernetes")]),s._v(" "),a("p",[s._v("kubectl scale --current-replicas=2 --replicas=3 statefulset/ironman-stolon-keeper -n njupt-stolon")]),s._v(" "),a("p",[s._v("kubectl scale --current-replicas=2 --replicas=3 -n njupt-stolon deployment ironman-stolon-proxy")]),s._v(" "),a("p",[s._v('kubectl patch svc -n njupt-stolon ironman-stolon-proxy -p \'{"spec":{"type":"NodePort"}}\'')]),s._v(" "),a("p",[s._v("or https://www.jianshu.com/p/75af95641c91")]),s._v(" "),a("p",[s._v("kubectl expose deployment [xxxxxxxx] --type=NodePort")]),s._v(" "),a("p",[a("img",{attrs:{src:"/images/1591921126800-ab6f34cf-78ec-40ce-a88f-9d6d2040b395.png",alt:"image.png"}})]),s._v(" "),a("p",[s._v("pvçŠ¶æ€è½¬æ¢")]),s._v(" "),a("p",[s._v("kubectl edit pv pgv3")]),s._v(" "),a("p",[s._v("åˆ å»spec.clainRef")]),s._v(" "),a("p",[s._v("released--\x3eavailable")]),s._v(" "),a("h1",{attrs:{id:"stolon"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#stolon"}},[s._v("#")]),s._v(" stolon")])])}),[],!1,null,null,null);e.default=t.exports}}]);