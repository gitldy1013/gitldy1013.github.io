(window.webpackJsonp=window.webpackJsonp||[]).push([[180],{876:function(a,s,e){"use strict";e.r(s);var t=e(5),r=Object(t.a)({},(function(){var a=this,s=a.$createElement,e=a._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"eureka停更后的替换"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#eureka停更后的替换"}},[a._v("#")]),a._v(" Eureka停更后的替换")]),a._v(" "),e("h2",{attrs:{id:"zookeeper替换eureka"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper替换eureka"}},[a._v("#")]),a._v(" Zookeeper替换Eureka")]),a._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20200408084706452.png",alt:"image-20200408084706452"}})]),a._v(" "),e("h3",{attrs:{id:"zookeeper是什么"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper是什么"}},[a._v("#")]),a._v(" Zookeeper是什么")]),a._v(" "),e("p",[a._v("Zookeeper是一个分布式协调工具，可以实现注册中心功能")]),a._v(" "),e("p",[a._v("关闭Linux服务器防火墙后，启动Zookeeper服务器，Zookeeper服务器取代Eureka服务器，zk作为服务注册中心。")]),a._v(" "),e("h3",{attrs:{id:"搭建zookeeper注册中心"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#搭建zookeeper注册中心"}},[a._v("#")]),a._v(" 搭建Zookeeper注册中心")]),a._v(" "),e("h4",{attrs:{id:"引入依赖"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#引入依赖"}},[a._v("#")]),a._v(" 引入依赖")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("        \x3c!--zookeeper客户端--\x3e\n        <dependency>\n            <groupId>org.springframework.cloud</groupId>\n            <artifactId>spring-cloud-starter-zookeeper-discovery</artifactId>\n            \x3c!--先排除自带的zookeeper3.5.3--\x3e\n            <exclusions>\n                <exclusion>\n                    <groupId>org.apache.zookeeper</groupId>\n                    <artifactId>zookeeper</artifactId>\n                </exclusion>\n            </exclusions>\n        </dependency>\n        <dependency>\n            <groupId>org.apache.zookeeper</groupId>\n            <artifactId>zookeeper</artifactId>\n            <version>3.4.9</version>\n        </dependency>\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br"),e("span",{staticClass:"line-number"},[a._v("16")]),e("br"),e("span",{staticClass:"line-number"},[a._v("17")]),e("br")])]),e("h4",{attrs:{id:"修改配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件"}},[a._v("#")]),a._v(" 修改配置文件")]),a._v(" "),e("p",[a._v("连接上Zookeeper客户端")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("spring:\n  application:\n    name: cloud-provider-payment\n  cloud:\n    zookeeper:\n      connect-string: 180.76.99.142:2181\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br")])]),e("h4",{attrs:{id:"修改主启动类"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改主启动类"}},[a._v("#")]),a._v(" 修改主启动类")]),a._v(" "),e("p",[a._v("使用"),e("code",[a._v("@EnableDiscoveryClient")]),a._v(" 注解")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("@SpringBootApplication\n@EnableDiscoveryClient\npublic class PaymentMain8004 {\n    public static void main(String[] args) {\n        SpringApplication.run(PaymentMain8004.class);\n    }\n}\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br")])]),e("h4",{attrs:{id:"启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[a._v("#")]),a._v(" 启动")]),a._v(" "),e("p",[a._v("启动成功后，把服务注册进Zookeeper客户端")]),a._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20200408090101441.png",alt:"image-20200408090101441"}})]),a._v(" "),e("h4",{attrs:{id:"思考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#思考"}},[a._v("#")]),a._v(" 思考")]),a._v(" "),e("p",[a._v("服务已经成功注册到Zookeeper客户端，那么注册上去的节点被称为临时节点，还是持久节点？")]),a._v(" "),e("p",[a._v("首先Eureka有自我保护机制，也就是某个服务下线后，不会立刻清除该服务，而是将服务保留一段时间")]),a._v(" "),e("p",[a._v("Zookeeper也一样在服务下线后，会等待一段时间后，也会把该节点删除，这就说明Zookeeper上的节点是临时节点。")]),a._v(" "),e("h2",{attrs:{id:"consul替换eureka"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#consul替换eureka"}},[a._v("#")]),a._v(" Consul替换Eureka")]),a._v(" "),e("h3",{attrs:{id:"简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[a._v("#")]),a._v(" 简介")]),a._v(" "),e("p",[a._v("官网："),e("code",[a._v("https://www.consul.io/")])]),a._v(" "),e("p",[a._v("Consul是一套开源的分布式服务发现和配置管理系统，由HashiCorp公司用Go语言开发")]),a._v(" "),e("p",[a._v("提供了微服务系统中的服务治理、配置中心、控制总线等功能，这些功能中的每一个都可以根据需要单独使用，也可以一起使用构建全方位的服务网路，总之Consul提供了一种完整的服务网络解决方案。")]),a._v(" "),e("p",[a._v("它具有很多优点，包括：基于raft协议，比较简洁；支持健康检查，同时支持HTTP和DNS协议，支持跨数据中心的WAN集群，提供图形化界面，跨平台，支持Linux，MAC，Windows")]),a._v(" "),e("h3",{attrs:{id:"功能"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#功能"}},[a._v("#")]),a._v(" 功能")]),a._v(" "),e("ul",[e("li",[a._v("服务发现：提供HTTP和DNS两种发现方式")]),a._v(" "),e("li",[a._v("健康监测：支持多种方法，HTTP，TCP，Docker，Shell脚本定制化")]),a._v(" "),e("li",[a._v("KV存储：Key，Value的存储方式")]),a._v(" "),e("li",[a._v("多数据中心：Consul支持多数据中心")]),a._v(" "),e("li",[a._v("可视化Web界面")])]),a._v(" "),e("h3",{attrs:{id:"安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[a._v("#")]),a._v(" 安装")]),a._v(" "),e("p",[a._v("官网："),e("code",[a._v("https://www.consul.io/downloads.html")])]),a._v(" "),e("ul",[e("li",[e("p",[a._v("查看版本："),e("code",[a._v("consul --version")])])]),a._v(" "),e("li",[e("p",[a._v("运行："),e("code",[a._v("consul agent -dev")])])])]),a._v(" "),e("p",[a._v("运行成功后，然后访问 "),e("code",[a._v("http://localhost:8500")]),a._v("，进入consul的可视化界面")]),a._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20200408095337426.png",alt:"image-20200408095337426"}})]),a._v(" "),e("h3",{attrs:{id:"服务提供者注册consul"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#服务提供者注册consul"}},[a._v("#")]),a._v(" 服务提供者注册Consul")]),a._v(" "),e("p",[a._v("引入依赖")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("\x3c!--consul--\x3e\n<dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-consul-discovery</artifactId>\n</dependency>\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br")])]),e("p",[a._v("修改yml")]),a._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("#consul服务端口号\nserver:\n  port: 8006\nspring:\n  application:\n    name: consul-provider-payment\n#consul注册中心地址\n  cloud:\n    consul:\n      host: localhost\n      port: 8500\n      discovery:\n        service-name: ${spring.application.name}\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br")])]),e("p",[a._v("然后启动项目，即可发现服务提供者已经注册到Consul中了")]),a._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20200408100158576.png",alt:"image-20200408100158576"}})]),a._v(" "),e("h2",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),e("table",[e("thead",[e("tr",[e("th",[a._v("组件名")]),a._v(" "),e("th",[a._v("语言")]),a._v(" "),e("th",[a._v("健康检查")]),a._v(" "),e("th",[a._v("对外暴露接口")]),a._v(" "),e("th",[a._v("CAP")]),a._v(" "),e("th",[a._v("Spring Clou集成")])])]),a._v(" "),e("tbody",[e("tr",[e("td",[a._v("Eureka")]),a._v(" "),e("td",[a._v("Java")]),a._v(" "),e("td",[a._v("可配支持")]),a._v(" "),e("td",[a._v("HTTP")]),a._v(" "),e("td",[a._v("AP")]),a._v(" "),e("td",[a._v("已集成")])]),a._v(" "),e("tr",[e("td",[a._v("Consul")]),a._v(" "),e("td",[a._v("Go")]),a._v(" "),e("td",[a._v("支持")]),a._v(" "),e("td",[a._v("HTTP/DNS")]),a._v(" "),e("td",[a._v("CP")]),a._v(" "),e("td",[a._v("已集成")])]),a._v(" "),e("tr",[e("td",[a._v("Zookeeper")]),a._v(" "),e("td",[a._v("Java")]),a._v(" "),e("td",[a._v("支持")]),a._v(" "),e("td",[a._v("客户端")]),a._v(" "),e("td",[a._v("CP")]),a._v(" "),e("td",[a._v("已集成")])])])]),a._v(" "),e("h3",{attrs:{id:"cap理论"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cap理论"}},[a._v("#")]),a._v(" CAP理论")]),a._v(" "),e("p",[a._v("Availability：高可用")]),a._v(" "),e("p",[a._v("Consistency：强一致性")]),a._v(" "),e("p",[a._v("Partition Tolerance：分区容错性")]),a._v(" "),e("p",[a._v("CAP理论关注粒度是数据，而不是整体系统设计的策略")]),a._v(" "),e("p",[a._v("因此现在的微服务架构要么是 CP 要么是 AP，也就是P一定需要保证，最多只能较好的同时满足两个")]),a._v(" "),e("p",[a._v("CAP理论的核心：一个分布式系统不可能同时很好的满足：一致性，可用性和分区容错性这个三个需求")]),a._v(" "),e("p",[a._v("因此，根据CAP原理将NoSQL数据库分成了满足CA原则，满足CP原则，满足AP的三大类")]),a._v(" "),e("ul",[e("li",[a._v("CA：单点集群，满足一致性，可用性的系统，通常在可扩展性上不太满足")]),a._v(" "),e("li",[a._v("CP：满足一致性，分区容忍性，通常性能不是特别高")]),a._v(" "),e("li",[a._v("AP：满足可用性，分区容忍性，通常对一致性要求低一些")])]),a._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20200408101128947.png",alt:"image-20200408101128947"}})]),a._v(" "),e("p",[a._v("部分情况下，我们对数据一致性的要求没有这么高，比如蘑菇博客的点赞和浏览记录，都是每隔一段时间才写入数据库的。")]),a._v(" "),e("h3",{attrs:{id:"ap架构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ap架构"}},[a._v("#")]),a._v(" AP架构")]),a._v(" "),e("p",[a._v("Eureka是AP架构")]),a._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20200408101854416.png",alt:"image-20200408101854416"}})]),a._v(" "),e("p",[a._v("因为同步原因出现问题，而造成数据没有一致性")]),a._v(" "),e("p",[a._v("当出现网络分区后，为了保证高可用，系统B可以返回旧值，保证系统的可用性")]),a._v(" "),e("p",[a._v("结论：违背了一致性C的要求，只满足可用性和分区容错性，即AP")]),a._v(" "),e("h3",{attrs:{id:"cp架构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cp架构"}},[a._v("#")]),a._v(" CP架构")]),a._v(" "),e("p",[a._v("Zookeeper和Consul是CP架构")]),a._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20200408102120317.png",alt:"image-20200408102120317"}})]),a._v(" "),e("p",[a._v("当出现网络分区后，为了保证一致性，就必须拒绝请求，否者无法保证一致性")]),a._v(" "),e("p",[a._v("结论：违背了可用性A的要求，只满足一致性和分区容错性，即CP")])])}),[],!1,null,null,null);s.default=r.exports}}]);