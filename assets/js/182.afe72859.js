(window.webpackJsonp=window.webpackJsonp||[]).push([[182],{877:function(e,n,a){"use strict";a.r(n);var s=a(5),t=Object(s.a)({},(function(){var e=this,n=e.$createElement,a=e._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"openfeign实现服务调用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#openfeign实现服务调用"}},[e._v("#")]),e._v(" OpenFeign实现服务调用")]),e._v(" "),a("p",[e._v("关于Feign的停更，目前已经使用OpenFeign进行替换")]),e._v(" "),a("h2",{attrs:{id:"概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[e._v("#")]),e._v(" 概述")]),e._v(" "),a("p",[e._v("Feign是一个声明式WebService客户端。使用Feign能让编写WebService客户端更加简单。")]),e._v(" "),a("p",[e._v("它的使用方法是定义一个服务接口然后在上面添加注解。Feign也支持可插拔式的编码和解码器。Spring Cloud对feign进行了封装，使其支持了Spring MVC标准注解和HttpMessageConverters。Feign可以与Eureka和Ribbon组合使用以支持负载均衡。")]),e._v(" "),a("h2",{attrs:{id:"feign的作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#feign的作用"}},[e._v("#")]),e._v(" Feign的作用")]),e._v(" "),a("p",[e._v("Feign旨在使编写Java Http客户端变得更容易。")]),e._v(" "),a("p",[e._v("前面在使用Ribbon + RestTemplate时，利用RestTemplate对http请求的封装处理，形成了一套模板化的调用方法。但是在实际开发中，由于对服务依赖的调用可能不止一处，往往一个接口会被多处调用，所以通常都会针对每个微服务自行封装一些客户端来包装这些依赖，所以Feign在这个基础上做了进一步封装，由他来帮助我们定义和实现依赖服务的接口定义。在Feign的实现下，我们只需要创建一个接口，并使用注解的方式来配置它（以前是Dao接口上面标注Mapper注解，现在是微服务接口上标注一个Feign注解），即可完成服务提供方的接口绑定，简化了使用Spring Cloud Ribbon时，自动封装服务调用客户端的开发量。")]),e._v(" "),a("h2",{attrs:{id:"feign集成ribbon"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#feign集成ribbon"}},[e._v("#")]),e._v(" Feign集成Ribbon")]),e._v(" "),a("p",[e._v("利用Ribbon维护了Payment的服务列表信息，并且通过轮询实现了客户端的负载均衡。而与Ribbon不同的是，通过Feign只需要定义服务绑定接口且声明式的方法，优雅而简单的实现了服务调用。")]),e._v(" "),a("h2",{attrs:{id:"feign和openfeign的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#feign和openfeign的区别"}},[e._v("#")]),e._v(" Feign和OpenFeign的区别")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[e._v("Feign")]),e._v(" "),a("th",{staticStyle:{"text-align":"center"}},[e._v("OpenFeign")])])]),e._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[e._v("Feign是Spring Cloud组件中的一种轻量级RestFul的HTTP服务客户端，Feign内置了Ribbon，用来做客户端的负载均衡，去调用服务注册中心的服务，Feign的使用方式是：使用Feign的注解定义接口，调用这个接口，就可以调用服务注册中心的服务")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("OpenFeign是Spring Cloud 在Feign的基础上支持了SpringMVC的注解，如@RequestMapping等等，OpenFeign的@FeignClient可以解析SpringMVC的@RequestMapping注解下的接口，并通过动态代理的方法生产实现类，实现类中做均衡并调用其它服务")])]),e._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[e._v("spring-cloud-starter-feign")]),e._v(" "),a("td",{staticStyle:{"text-align":"center"}},[e._v("spring-cloud-starter-openfeign")])])])]),e._v(" "),a("h2",{attrs:{id:"openfeign使用步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#openfeign使用步骤"}},[e._v("#")]),e._v(" OpenFeign使用步骤")]),e._v(" "),a("h3",{attrs:{id:"引入依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#引入依赖"}},[e._v("#")]),e._v(" 引入依赖")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("\x3c!--openfeign--\x3e\n<dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-openfeign</artifactId>\n</dependency>\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br")])]),a("h3",{attrs:{id:"修改启动类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改启动类"}},[e._v("#")]),e._v(" 修改启动类")]),e._v(" "),a("p",[e._v("激活Feign组件")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("@SpringBootApplication\n@EnableFeignClients\npublic class OrderFeignMain80 {\n    public static void main(String[] args) {\n        SpringApplication.run(OrderFeignMain80.class, args);\n    }\n}\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br")])]),a("h3",{attrs:{id:"添加业务逻辑接口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加业务逻辑接口"}},[e._v("#")]),e._v(" 添加业务逻辑接口")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('@Component\n@FeignClient(value = "cloud-payment-service")\npublic interface PaymentFeignService {\n\n    @GetMapping(value = "/payment/get/{id}")\n    public CommonResult<Payment> getPaymentById(@PathVariable("id") Long id);\n\n    @GetMapping("/payment/feign/timeout")\n    public String paymentFeignTimeout();\n}\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br")])]),a("h3",{attrs:{id:"具体使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#具体使用"}},[e._v("#")]),e._v(" 具体使用")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('@RestController\n@Slf4j\npublic class OrderFeignController {\n    @Resource\n    private PaymentFeignService paymentFeignService;\n\n    @GetMapping(value = "/consumer/payment/get/{id}")\n    public CommonResult<Payment> getPaymentById(@PathVariable("id") Long id){\n        CommonResult<Payment> paymentById = paymentFeignService.getPaymentById(id);\n        return paymentById;\n    }\n\n    @GetMapping("/consumer/payment/feign/timeout")\n    public String paymentFeignTimeout(){\n        //open-feign-ribbon,客户端默认等待一秒钟\n        return paymentFeignService.paymentFeignTimeout();\n    }\n}\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br")])]),a("h2",{attrs:{id:"openfeign的超时控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#openfeign的超时控制"}},[e._v("#")]),e._v(" OpenFeign的超时控制")]),e._v(" "),a("p",[e._v("服务提供者需要超过3秒才能返回数据，但是服务调用者默认只等待1秒，这就会出现超时问题。")]),e._v(" "),a("p",[a("img",{attrs:{src:"/images/image-20200408191254551.png",alt:"image-20200408191254551"}})]),e._v(" "),a("p",[e._v("这是因为默认Feign客户端只等待一秒钟，但是服务端处理需要超过3秒钟，导致Feign客户端不想等待了，直接返回报错，这个时候，消费方的OpenFeign就需要增大超时时间")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 设置feign客户端超时时间(OpenFeign默认支持ribbon)\nribbon:\n  # 指的是建立连接所用的时间,适用于网络状态正常的情况下,两端连接所用的时间\n  ReadTimeout: 5000\n  # 指的是建立连接后从服务器读取到可用资源所用的时间\n  ConnectTimeout: 5000\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br")])]),a("h2",{attrs:{id:"openfeign日志打印功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#openfeign日志打印功能"}},[e._v("#")]),e._v(" OpenFeign日志打印功能")]),e._v(" "),a("h3",{attrs:{id:"概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[e._v("#")]),e._v(" 概念")]),e._v(" "),a("p",[e._v("Feign提供了日志打印功能，我们可以通过配置来调整日志级别，从而了解Feign中Http请求的细节，说白了就是对Feign接口的调用情况进行监控和输出。")]),e._v(" "),a("h3",{attrs:{id:"日志级别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志级别"}},[e._v("#")]),e._v(" 日志级别")]),e._v(" "),a("ul",[a("li",[e._v("NONE：默认的，不显示任何日志")]),e._v(" "),a("li",[e._v("BASIC：仅记录请求方法、URL、相应状态码以及执行时间")]),e._v(" "),a("li",[e._v("HEADERS：除了BASIC中定义的信息之外，还有请求和响应头的信息")]),e._v(" "),a("li",[e._v("FULL：除了HEADERS中定义的信息之外，还有请求和相应的正文及元数据")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("@Configuration\npublic class FeignConfig {\n    /**\n     * feignClient配置日志级别\n     *\n     * @return\n     */\n    @Bean\n    public Logger.Level feignLoggerLevel() {\n        // 请求和响应的头信息,请求和响应的正文及元数据\n        return Logger.Level.FULL;\n    }\n}\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br")])]),a("h3",{attrs:{id:"修改yml文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改yml文件"}},[e._v("#")]),e._v(" 修改YML文件")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("logging:\n  level:\n    # feign日志以什么级别监控哪个接口\n    com.atguigu.springcloud.service.PaymentFeignService: debug\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);