(window.webpackJsonp=window.webpackJsonp||[]).push([[124],{821:function(s,a,e){"use strict";e.r(a);var t=e(5),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"kubernetes容器交付介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes容器交付介绍"}},[s._v("#")]),s._v(" Kubernetes容器交付介绍")]),s._v(" "),e("p",[s._v("如何在k8s集群中部署Java项目")]),s._v(" "),e("h2",{attrs:{id:"容器交付流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#容器交付流程"}},[s._v("#")]),s._v(" 容器交付流程")]),s._v(" "),e("ul",[e("li",[s._v("开发代码阶段\n"),e("ul",[e("li",[s._v("编写代码")]),s._v(" "),e("li",[s._v("编写Dockerfile【打镜像做准备】")])])]),s._v(" "),e("li",[s._v("持续交付/集成\n"),e("ul",[e("li",[s._v("代码编译打包")]),s._v(" "),e("li",[s._v("制作镜像")]),s._v(" "),e("li",[s._v("上传镜像仓库")])])]),s._v(" "),e("li",[s._v("应用部署\n"),e("ul",[e("li",[s._v("环境准备")]),s._v(" "),e("li",[s._v("Pod")]),s._v(" "),e("li",[s._v("Service")]),s._v(" "),e("li",[s._v("Ingress")])])]),s._v(" "),e("li",[s._v("运维\n"),e("ul",[e("li",[s._v("监控")]),s._v(" "),e("li",[s._v("故障排查")]),s._v(" "),e("li",[s._v("应用升级")])])])]),s._v(" "),e("h2",{attrs:{id:"k8s部署java项目流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#k8s部署java项目流程"}},[s._v("#")]),s._v(" k8s部署Java项目流程")]),s._v(" "),e("ul",[e("li",[s._v("制作镜像【Dockerfile】")]),s._v(" "),e("li",[s._v("上传到镜像仓库【Dockerhub、阿里云、网易】")]),s._v(" "),e("li",[s._v("控制器部署镜像【Deployment】")]),s._v(" "),e("li",[s._v("对外暴露应用【Service、Ingress】")]),s._v(" "),e("li",[s._v("运维【监控、升级】")])]),s._v(" "),e("h2",{attrs:{id:"k8s部署java项目"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#k8s部署java项目"}},[s._v("#")]),s._v(" k8s部署Java项目")]),s._v(" "),e("h3",{attrs:{id:"准备java项目"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#准备java项目"}},[s._v("#")]),s._v(" 准备Java项目")]),s._v(" "),e("p",[s._v("第一步，准备java项目，把java进行打包【jar包或者war包】")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20201121213239222.png",alt:"image-20201121213239222"}})]),s._v(" "),e("h3",{attrs:{id:"依赖环境"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#依赖环境"}},[s._v("#")]),s._v(" 依赖环境")]),s._v(" "),e("p",[s._v("在打包java项目的时候，我们首先需要两个环境")]),s._v(" "),e("ul",[e("li",[s._v("java环境【JDK】")]),s._v(" "),e("li",[s._v("maven环境")])]),s._v(" "),e("p",[s._v("然后把java项目打包成jar包")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("mvn clean "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"/images/image-20201121213654216.png",alt:"image-20201121213654216"}})]),s._v(" "),e("h3",{attrs:{id:"编写dockerfile文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#编写dockerfile文件"}},[s._v("#")]),s._v(" 编写Dockerfile文件")]),s._v(" "),e("p",[s._v("Dockerfile 内容如下所示")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("FROM openjdk:8-jdk-alpine\nVOLUME /tmp\nADD ./target/demojenkins.jar demojenkins.jar\nENTRYPOINT "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),s._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/demojenkins.jar"')]),s._v(", "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"&"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"制作镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#制作镜像"}},[s._v("#")]),s._v(" 制作镜像")]),s._v(" "),e("p",[s._v("在我们创建好Dockerfile文件后，我们就可以制作镜像了")]),s._v(" "),e("p",[s._v("我们首先将我们的项目，放到我们的服务器上")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20201121214251023.png",alt:"image-20201121214251023"}})]),s._v(" "),e("p",[s._v("然后执行下面命令打包镜像")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build -t java-demo-01:latest "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("等待一段后，即可制作完成我们的镜像")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20201121214701015.png",alt:"image-20201121214701015"}})]),s._v(" "),e("p",[s._v("最后通过下面命令，即可查看我们的镜像了")]),s._v(" "),e("div",{staticClass:"language-BASH line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"启动镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动镜像"}},[s._v("#")]),s._v(" 启动镜像")]),s._v(" "),e("p",[s._v("在我们制作完成镜像后，我们就可以启动我们的镜像了")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8111")]),s._v(":8111 java-demo-01:latest -t\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("启动完成后，我们通过浏览器进行访问，即可看到我们的java程序")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("http://192.168.177.130:8111/user\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"推送镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#推送镜像"}},[s._v("#")]),s._v(" 推送镜像")]),s._v(" "),e("p",[s._v("下面我们需要将我们制作好的镜像，上传到镜像服务器中【阿里云、DockerHub】")]),s._v(" "),e("p",[s._v("首先我们需要到 阿里云 "),e("a",{attrs:{href:"https://cr.console.aliyun.com/cn-hangzhou/instances/repositories",target:"_blank",rel:"noopener noreferrer"}},[s._v("容器镜像服务"),e("OutboundLink")],1),s._v("，然后开始创建镜像仓库")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20201121223435851.png",alt:"image-20201121223435851"}})]),s._v(" "),e("p",[s._v("然后选择本地仓库")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20201121223516789.png",alt:"image-20201121223516789"}})]),s._v(" "),e("p",[s._v("我们点击我们刚刚创建的镜像仓库，就能看到以下的信息")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20201121224233092.png",alt:"image-20201121224233092"}})]),s._v(" "),e("h4",{attrs:{id:"登录镜像服务器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#登录镜像服务器"}},[s._v("#")]),s._v(" 登录镜像服务器")]),s._v(" "),e("p",[s._v("使用命令登录")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" login --username"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("XXXXXXX@163.com registry.cn-shenzhen.aliyuncs.com\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("然后输入刚刚我们开放时候的注册的密码")]),s._v(" "),e("h4",{attrs:{id:"镜像添加版本号"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#镜像添加版本号"}},[s._v("#")]),s._v(" 镜像添加版本号")]),s._v(" "),e("p",[s._v("下面为我们的镜像添加版本号")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 实例")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ImageId"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" registry.cn-shenzhen.aliyuncs.com/mogublog/java-project-01:"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像版本号"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 举例")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag 33f11349c27d registry.cn-shenzhen.aliyuncs.com/mogublog/java-project-01:1.0.0\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("操作完成后")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20201121224609890.png",alt:"image-20201121224609890"}})]),s._v(" "),e("h4",{attrs:{id:"推送镜像-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#推送镜像-2"}},[s._v("#")]),s._v(" 推送镜像")]),s._v(" "),e("p",[s._v("在我们添加版本号信息后，我们就可以推送我们的镜像到阿里云了")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push registry.cn-shenzhen.aliyuncs.com/mogublog/java-project-01:1.0.0\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"/images/image-20201121224714068.png",alt:"image-20201121224714068"}})]),s._v(" "),e("p",[s._v("操作完成后，我们在我们的阿里云镜像服务，就能看到推送上来的镜像了")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20201121224858651.png",alt:"image-20201121224858651"}})]),s._v(" "),e("h3",{attrs:{id:"控制器部署镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#控制器部署镜像"}},[s._v("#")]),s._v(" 控制器部署镜像")]),s._v(" "),e("p",[s._v("在我们推送镜像到服务器后，就可以通过控制器部署镜像了")]),s._v(" "),e("p",[s._v("首先我们需要根据刚刚的镜像，导出yaml")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导出yaml")]),s._v("\nkubectl create deployment  javademo1 --image"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("registry.cn-\nshenzhen.aliyuncs.com/mogublog/java-project-01:1.0.0 --dry-run -o yaml "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" javademo1.yaml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("导出后的 javademo1.yaml 如下所示")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  creationTimestamp: null\n  labels:\n    app: javademo1\n  name: javademo1\nspec:\n  replicas: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  selector:\n    matchLabels:\n      app: javademo1\n  strategy: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        app: javademo1\n    spec:\n      containers:\n      - image: registry.cn-shenzhen.aliyuncs.com/mogublog/java-project-01:1.0.0\n        name: java-project-01\n        resources: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nstatus: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br")])]),e("p",[s._v("然后通过下面命令，通过yaml创建我们的deployment")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建")]),s._v("\nkubectl apply -f javademo1.yaml\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 pods")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[e("img",{attrs:{src:"/images/image-20201121225413122.png",alt:"image-20201121225413122"}})]),s._v(" "),e("p",[s._v("或者我们可以进行扩容，多创建几个副本")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl scale deployment javademo1 --replicas"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"/images/image-20201121225600554.png",alt:"image-20201121225600554"}})]),s._v(" "),e("p",[s._v("然后我们还需要对外暴露端口【通过service 或者 Ingress】")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对外暴露端口")]),s._v("\nkubectl expose deployment javademo1 --port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8111")]),s._v("  --target-port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8111")]),s._v(" --type"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NodePort\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看对外端口号")]),s._v("\nkubectl get svc\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[e("img",{attrs:{src:"/images/image-20201121225818003.png",alt:"image-20201121225818003"}})]),s._v(" "),e("p",[s._v("然后通过下面的地址访问")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对内访问")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://10.106.103.242:8111/user\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对外访问")]),s._v("\nhttp://192.168.177.130:32190/user\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("h3",{attrs:{id:"运维"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#运维"}},[s._v("#")]),s._v(" 运维")]),s._v(" "),e("p",[s._v("....")])])}),[],!1,null,null,null);a.default=n.exports}}]);