(window.webpackJsonp=window.webpackJsonp||[]).push([[307],{1006:function(n,s,a){"use strict";a.r(s);var e=a(5),t=Object(e.a)({},(function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("h1",{attrs:{id:"阻塞队列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#阻塞队列"}},[n._v("#")]),n._v(" 阻塞队列")]),n._v(" "),a("h2",{attrs:{id:"概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[n._v("#")]),n._v(" 概念")]),n._v(" "),a("h3",{attrs:{id:"队列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#队列"}},[n._v("#")]),n._v(" 队列")]),n._v(" "),a("p",[n._v("队列就可以想成是一个数组，从一头进入，一头出去，排队买饭")]),n._v(" "),a("h3",{attrs:{id:"阻塞队列-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#阻塞队列-2"}},[n._v("#")]),n._v(" 阻塞队列")]),n._v(" "),a("p",[n._v("BlockingQueue   阻塞队列，排队拥堵，首先它是一个队列，而一个阻塞队列在数据结构中所起的作用大致如下图所示：")]),n._v(" "),a("p",[a("img",{attrs:{src:"/images/image-20200316152120272.png",alt:"image-20200316152120272"}})]),n._v(" "),a("p",[n._v("线程1往阻塞队列中添加元素，而线程2从阻塞队列中移除元素")]),n._v(" "),a("ul",[a("li",[a("p",[a("code",[n._v("当阻塞队列是空时，从队列中获取元素的操作将会被阻塞")])]),n._v(" "),a("ul",[a("li",[n._v("当蛋糕店的柜子空的时候，无法从柜子里面获取蛋糕")])])]),n._v(" "),a("li",[a("p",[a("code",[n._v("当阻塞队列是满时，从队列中添加元素的操作将会被阻塞")])]),n._v(" "),a("ul",[a("li",[n._v("当蛋糕店的柜子满的时候，无法继续向柜子里面添加蛋糕了")])])])]),n._v(" "),a("p",[n._v("也就是说 试图从空的阻塞队列中获取元素的线程将会被阻塞，直到其它线程往空的队列插入新的元素")]),n._v(" "),a("p",[n._v("同理，试图往已经满的阻塞队列中添加新元素的线程，直到其它线程往满的队列中移除一个或多个元素，或者完全清空队列后，使队列重新变得空闲起来，并后续新增")]),n._v(" "),a("h2",{attrs:{id:"为什么要用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么要用"}},[n._v("#")]),n._v(" 为什么要用？")]),n._v(" "),a("p",[n._v("去海底捞吃饭，大厅满了，需要进候厅等待，但是这些等待的客户能够对商家带来利润，因此我们非常欢迎他们阻塞")]),n._v(" "),a("p",[n._v("在多线程领域：所谓的阻塞，在某些清空下会挂起线程（即阻塞），一旦条件满足，被挂起的线程又会自动唤醒")]),n._v(" "),a("h3",{attrs:{id:"为什么需要blockingqueue"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要blockingqueue"}},[n._v("#")]),n._v(" 为什么需要BlockingQueue")]),n._v(" "),a("p",[n._v("好处是我们不需要关心什么时候需要阻塞线程，什么时候需要唤醒线程，因为这一切BlockingQueue都帮你一手包办了")]),n._v(" "),a("p",[n._v("在concurrent包发布以前，在多线程环境下，我们每个程序员都必须自己取控制这些细节，尤其还要兼顾效率和线程安全，而这会给我们的程序带来不小的复杂度。")]),n._v(" "),a("h2",{attrs:{id:"架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#架构"}},[n._v("#")]),n._v(" 架构")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("// 你用过List集合类\n\n// ArrayList集合类熟悉么？\n\n// 还用过 CopyOnWriteList  和 BlockingQueue\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br")])]),a("p",[n._v("BlockingQueue阻塞队列是属于一个接口，底下有七个实现类")]),n._v(" "),a("ul",[a("li",[n._v("ArrayBlockQueue：由数组结构组成的有界阻塞队列")]),n._v(" "),a("li",[n._v("LinkedBlockingQueue：由链表结构组成的有界（但是默认大小 Integer.MAX_VALUE）的阻塞队列\n"),a("ul",[a("li",[n._v("有界，但是界限非常大，相当于无界，可以当成无界")])])]),n._v(" "),a("li",[n._v("PriorityBlockQueue：支持优先级排序的无界阻塞队列")]),n._v(" "),a("li",[n._v("DelayQueue：使用优先级队列实现的延迟无界阻塞队列")]),n._v(" "),a("li",[n._v("SynchronousQueue：不存储元素的阻塞队列，也即单个元素的队列\n"),a("ul",[a("li",[n._v("生产一个，消费一个，不存储元素，不消费不生产")])])]),n._v(" "),a("li",[n._v("LinkedTransferQueue：由链表结构组成的无界阻塞队列")]),n._v(" "),a("li",[n._v("LinkedBlockingDeque：由链表结构组成的双向阻塞队列")])]),n._v(" "),a("p",[n._v("这里需要掌握的是：ArrayBlockQueue、LinkedBlockingQueue、SynchronousQueue")]),n._v(" "),a("h2",{attrs:{id:"blockingqueue核心方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#blockingqueue核心方法"}},[n._v("#")]),n._v(" BlockingQueue核心方法")]),n._v(" "),a("p",[a("img",{attrs:{src:"/images/image-20200316154442756.png",alt:"image-20200316154442756"}})]),n._v(" "),a("table",[a("thead",[a("tr",[a("th",[n._v("抛出异常")]),n._v(" "),a("th",[n._v("当阻塞队列满时：在往队列中add插入元素会抛出 IIIegalStateException：Queue full                      当阻塞队列空时：再往队列中remove移除元素，会抛出NoSuchException")])])]),n._v(" "),a("tbody",[a("tr",[a("td",[n._v("特殊性")]),n._v(" "),a("td",[n._v("插入方法，成功true，失败false       移除方法：成功返回出队列元素，队列没有就返回空")])]),n._v(" "),a("tr",[a("td",[n._v("一直阻塞")]),n._v(" "),a("td",[n._v("当阻塞队列满时，生产者继续往队列里put元素，队列会一直阻塞生产线程直到put数据or响应中断退出， 当阻塞队列空时，消费者线程试图从队列里take元素，队列会一直阻塞消费者线程直到队列可用。")])]),n._v(" "),a("tr",[a("td",[n._v("超时退出")]),n._v(" "),a("td",[n._v("当阻塞队列满时，队里会阻塞生产者线程一定时间，超过限时后生产者线程会退出")])])])]),n._v(" "),a("h3",{attrs:{id:"抛出异常组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#抛出异常组"}},[n._v("#")]),n._v(" 抛出异常组")]),n._v(" "),a("p",[n._v("但执行add方法，向已经满的ArrayBlockingQueue中添加元素时候，会抛出异常")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('// 阻塞队列，需要填入默认值\nBlockingQueue<String> blockingQueue = new ArrayBlockingQueue<>(3);\n\nSystem.out.println(blockingQueue.add("a"));\nSystem.out.println(blockingQueue.add("b"));\nSystem.out.println(blockingQueue.add("c"));\n\nSystem.out.println(blockingQueue.add("XXX"));\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br")])]),a("p",[n._v("运行后：")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('true\ntrue\ntrue\nException in thread "main" java.lang.IllegalStateException: Queue full\n\tat java.util.AbstractQueue.add(AbstractQueue.java:98)\n\tat java.util.concurrent.ArrayBlockingQueue.add(ArrayBlockingQueue.java:312)\n\tat com.moxi.interview.study.queue.BlockingQueueDemo.main(BlockingQueueDemo.java:25)\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br")])]),a("p",[n._v("同时如果我们多取出元素的时候，也会抛出异常，我们假设只存储了3个值，但是取的时候，取了四次")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('// 阻塞队列，需要填入默认值\nBlockingQueue<String> blockingQueue = new ArrayBlockingQueue<>(3);\nSystem.out.println(blockingQueue.add("a"));\nSystem.out.println(blockingQueue.add("b"));\nSystem.out.println(blockingQueue.add("c"));\n\nSystem.out.println(blockingQueue.remove());\nSystem.out.println(blockingQueue.remove());\nSystem.out.println(blockingQueue.remove());\nSystem.out.println(blockingQueue.remove());\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br")])]),a("p",[n._v("那么出现异常")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('true\ntrue\ntrue\na\nb\nc\nException in thread "main" java.util.NoSuchElementException\n\tat java.util.AbstractQueue.remove(AbstractQueue.java:117)\n\tat com.moxi.interview.study.queue.BlockingQueueDemo.main(BlockingQueueDemo.java:30)\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br")])]),a("h3",{attrs:{id:"布尔类型组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#布尔类型组"}},[n._v("#")]),n._v(" 布尔类型组")]),n._v(" "),a("p",[n._v("我们使用 offer的方法，添加元素时候，如果阻塞队列满了后，会返回false，否者返回true")]),n._v(" "),a("p",[n._v("同时在取的时候，如果队列已空，那么会返回null")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('BlockingQueue blockingQueue = new ArrayBlockingQueue(3);\n\nSystem.out.println(blockingQueue.offer("a"));\nSystem.out.println(blockingQueue.offer("b"));\nSystem.out.println(blockingQueue.offer("c"));\nSystem.out.println(blockingQueue.offer("d"));\n\nSystem.out.println(blockingQueue.poll());\nSystem.out.println(blockingQueue.poll());\nSystem.out.println(blockingQueue.poll());\nSystem.out.println(blockingQueue.poll());\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br")])]),a("p",[n._v("运行结果")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("true\ntrue\ntrue\nfalse\na\nb\nc\nnull\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br")])]),a("h3",{attrs:{id:"阻塞队列组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#阻塞队列组"}},[n._v("#")]),n._v(" 阻塞队列组")]),n._v(" "),a("p",[n._v("我们使用 put的方法，添加元素时候，如果阻塞队列满了后，添加消息的线程，会一直阻塞，直到队列元素减少，会被清空，才会唤醒")]),n._v(" "),a("p",[n._v("一般在消息中间件，比如RabbitMQ中会使用到，因为需要保证消息百分百不丢失，因此只有让它阻塞")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('BlockingQueue<String> blockingQueue = new ArrayBlockingQueue<>(3);\nblockingQueue.put("a");\nblockingQueue.put("b");\nblockingQueue.put("c");\nSystem.out.println("================");\n\nblockingQueue.take();\nblockingQueue.take();\nblockingQueue.take();\nblockingQueue.take();\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br")])]),a("p",[n._v("同时使用take取消息的时候，如果内容不存在的时候，也会被阻塞")]),n._v(" "),a("h3",{attrs:{id:"不见不散组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#不见不散组"}},[n._v("#")]),n._v(" 不见不散组")]),n._v(" "),a("p",[n._v("offer( )  ， poll 加时间")]),n._v(" "),a("p",[n._v("使用offer插入的时候，需要指定时间，如果2秒还没有插入，那么就放弃插入")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('BlockingQueue<String> blockingQueue = new ArrayBlockingQueue<>(3);\nSystem.out.println(blockingQueue.offer("a", 2L, TimeUnit.SECONDS));\nSystem.out.println(blockingQueue.offer("b", 2L, TimeUnit.SECONDS));\nSystem.out.println(blockingQueue.offer("c", 2L, TimeUnit.SECONDS));\nSystem.out.println(blockingQueue.offer("d", 2L, TimeUnit.SECONDS));\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br")])]),a("p",[n._v("同时取的时候也进行判断")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("System.out.println(blockingQueue.poll(2L, TimeUnit.SECONDS));\nSystem.out.println(blockingQueue.poll(2L, TimeUnit.SECONDS));\nSystem.out.println(blockingQueue.poll(2L, TimeUnit.SECONDS));\nSystem.out.println(blockingQueue.poll(2L, TimeUnit.SECONDS));\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br")])]),a("p",[n._v("如果2秒内取不出来，那么就返回null")]),n._v(" "),a("h2",{attrs:{id:"synchronousqueue"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#synchronousqueue"}},[n._v("#")]),n._v(" SynchronousQueue")]),n._v(" "),a("p",[n._v("SynchronousQueue没有容量，与其他BlockingQueue不同，SynchronousQueue是一个不存储的BlockingQueue，每一个put操作必须等待一个take操作，否者不能继续添加元素")]),n._v(" "),a("p",[n._v("下面我们测试SynchronousQueue添加元素的过程")]),n._v(" "),a("p",[n._v("首先我们创建了两个线程，一个线程用于生产，一个线程用于消费")]),n._v(" "),a("p",[n._v("生产的线程分别put了 A、B、C这三个字段")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('BlockingQueue<String> blockingQueue = new SynchronousQueue<>();\n\nnew Thread(() -> {\n    try {       \n        System.out.println(Thread.currentThread().getName() + "\\t put A ");\n        blockingQueue.put("A");\n       \n        System.out.println(Thread.currentThread().getName() + "\\t put B ");\n        blockingQueue.put("B");        \n        \n        System.out.println(Thread.currentThread().getName() + "\\t put C ");\n        blockingQueue.put("C");        \n        \n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n}, "t1").start();\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br")])]),a("p",[n._v("消费线程使用take，消费阻塞队列中的内容，并且每次消费前，都等待5秒")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('        new Thread(() -> {\n            try {\n\n                try {\n                    TimeUnit.SECONDS.sleep(5);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                blockingQueue.take();\n                System.out.println(Thread.currentThread().getName() + "\\t take A ");\n\n                try {\n                    TimeUnit.SECONDS.sleep(5);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                blockingQueue.take();\n                System.out.println(Thread.currentThread().getName() + "\\t take B ");\n\n                try {\n                    TimeUnit.SECONDS.sleep(5);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                blockingQueue.take();\n                System.out.println(Thread.currentThread().getName() + "\\t take C ");\n\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }, "t2").start();\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br")])]),a("p",[n._v("最后结果输出为：")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("t1\t put A \nt2\t take A \n\n5秒后...\n\nt1\t put B \nt2\t take B \n\n5秒后...\n\nt1\t put C \nt2\t take C \n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br")])]),a("p",[n._v("我们从最后的运行结果可以看出，每次t1线程向队列中添加阻塞队列添加元素后，t1输入线程就会等待 t2消费线程，t2消费后，t2处于挂起状态，等待t1在存入，从而周而复始，形成 一存一取的状态")]),n._v(" "),a("h2",{attrs:{id:"阻塞队列的用处"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#阻塞队列的用处"}},[n._v("#")]),n._v(" 阻塞队列的用处")]),n._v(" "),a("h3",{attrs:{id:"生产者消费者模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生产者消费者模式"}},[n._v("#")]),n._v(" 生产者消费者模式")]),n._v(" "),a("p",[n._v("一个初始值为0的变量，两个线程对其交替操作，一个加1，一个减1，来5轮")]),n._v(" "),a("p",[n._v("关于多线程的操作，我们需要记住下面几句")]),n._v(" "),a("ul",[a("li",[n._v("线程 操作 资源类")]),n._v(" "),a("li",[n._v("判断 干活 通知")]),n._v(" "),a("li",[n._v("防止虚假唤醒机制")])]),n._v(" "),a("p",[n._v("我们下面实现一个简单的生产者消费者模式，首先有资源类ShareData")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('/**\n * 资源类\n */\nclass ShareData {\n\n    private int number = 0;\n\n    private Lock lock = new ReentrantLock();\n\n    private Condition condition = lock.newCondition();\n\n    public void increment() throws Exception{\n        // 同步代码块，加锁\n        lock.lock();\n        try {\n            // 判断\n            while(number != 0) {\n                // 等待不能生产\n                condition.await();\n            }\n\n            // 干活\n            number++;\n\n            System.out.println(Thread.currentThread().getName() + "\\t " + number);\n\n            // 通知 唤醒\n            condition.signalAll();\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    public void decrement() throws Exception{\n        // 同步代码块，加锁\n        lock.lock();\n        try {\n            // 判断\n            while(number == 0) {\n                // 等待不能消费\n                condition.await();\n            }\n\n            // 干活\n            number--;\n\n            System.out.println(Thread.currentThread().getName() + "\\t " + number);\n\n            // 通知 唤醒\n            condition.signalAll();\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            lock.unlock();\n        }\n    }\n\n}\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br"),a("span",{staticClass:"line-number"},[n._v("45")]),a("br"),a("span",{staticClass:"line-number"},[n._v("46")]),a("br"),a("span",{staticClass:"line-number"},[n._v("47")]),a("br"),a("span",{staticClass:"line-number"},[n._v("48")]),a("br"),a("span",{staticClass:"line-number"},[n._v("49")]),a("br"),a("span",{staticClass:"line-number"},[n._v("50")]),a("br"),a("span",{staticClass:"line-number"},[n._v("51")]),a("br"),a("span",{staticClass:"line-number"},[n._v("52")]),a("br"),a("span",{staticClass:"line-number"},[n._v("53")]),a("br"),a("span",{staticClass:"line-number"},[n._v("54")]),a("br"),a("span",{staticClass:"line-number"},[n._v("55")]),a("br"),a("span",{staticClass:"line-number"},[n._v("56")]),a("br"),a("span",{staticClass:"line-number"},[n._v("57")]),a("br"),a("span",{staticClass:"line-number"},[n._v("58")]),a("br"),a("span",{staticClass:"line-number"},[n._v("59")]),a("br"),a("span",{staticClass:"line-number"},[n._v("60")]),a("br")])]),a("p",[n._v("里面有一个number变量，同时提供了increment 和 decrement的方法，分别让number 加1和减1")]),n._v(" "),a("p",[n._v("但是我们在进行判断的时候，为了防止出现虚假唤醒机制，不能使用if来进行判断，而应该使用while")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("// 判断\nwhile(number != 0) {\n    // 等待不能生产\n    condition.await();\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br")])]),a("p",[n._v("不能使用 if判断")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("// 判断\nif(number != 0) {\n    // 等待不能生产\n    condition.await();\n}\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br")])]),a("p",[n._v("完整代码")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('/**\n * 生产者消费者 传统版\n * 题目：一个初始值为0的变量，两个线程对其交替操作，一个加1，一个减1，来5轮\n * @author: 陌溪\n * @create: 2020-03-16-21:38\n */\n/**\n * 线程 操作 资源类\n * 判断 干活 通知\n * 防止虚假唤醒机制\n */\n\n/**\n * 资源类\n */\nclass ShareData {\n\n    private int number = 0;\n\n    private Lock lock = new ReentrantLock();\n\n    private Condition condition = lock.newCondition();\n\n    public void increment() throws Exception{\n        // 同步代码块，加锁\n        lock.lock();\n        try {\n            // 判断\n            while(number != 0) {\n                // 等待不能生产\n                condition.await();\n            }\n\n            // 干活\n            number++;\n\n            System.out.println(Thread.currentThread().getName() + "\\t " + number);\n\n            // 通知 唤醒\n            condition.signalAll();\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    public void decrement() throws Exception{\n        // 同步代码块，加锁\n        lock.lock();\n        try {\n            // 判断\n            while(number == 0) {\n                // 等待不能消费\n                condition.await();\n            }\n\n            // 干活\n            number--;\n\n            System.out.println(Thread.currentThread().getName() + "\\t " + number);\n\n            // 通知 唤醒\n            condition.signalAll();\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            lock.unlock();\n        }\n    }\n\n}\npublic class ProdConsumerTraditionDemo {\n\n    public static void main(String[] args) {\n\n        // 高内聚，低耦合    内聚指的是，一个空调，自身带有调节温度高低的方法\n\n        ShareData shareData = new ShareData();\n\n        // t1线程，生产\n        new Thread(() -> {\n            for (int i = 0; i < 5; i++) {\n                try {\n                    shareData.increment();\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }\n            }\n        }, "t1").start();\n\n        // t2线程，消费\n        new Thread(() -> {\n            for (int i = 0; i < 5; i++) {\n                try {\n                    shareData.decrement();\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }\n            }\n        }, "t2").start();\n    }\n}\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br"),a("span",{staticClass:"line-number"},[n._v("45")]),a("br"),a("span",{staticClass:"line-number"},[n._v("46")]),a("br"),a("span",{staticClass:"line-number"},[n._v("47")]),a("br"),a("span",{staticClass:"line-number"},[n._v("48")]),a("br"),a("span",{staticClass:"line-number"},[n._v("49")]),a("br"),a("span",{staticClass:"line-number"},[n._v("50")]),a("br"),a("span",{staticClass:"line-number"},[n._v("51")]),a("br"),a("span",{staticClass:"line-number"},[n._v("52")]),a("br"),a("span",{staticClass:"line-number"},[n._v("53")]),a("br"),a("span",{staticClass:"line-number"},[n._v("54")]),a("br"),a("span",{staticClass:"line-number"},[n._v("55")]),a("br"),a("span",{staticClass:"line-number"},[n._v("56")]),a("br"),a("span",{staticClass:"line-number"},[n._v("57")]),a("br"),a("span",{staticClass:"line-number"},[n._v("58")]),a("br"),a("span",{staticClass:"line-number"},[n._v("59")]),a("br"),a("span",{staticClass:"line-number"},[n._v("60")]),a("br"),a("span",{staticClass:"line-number"},[n._v("61")]),a("br"),a("span",{staticClass:"line-number"},[n._v("62")]),a("br"),a("span",{staticClass:"line-number"},[n._v("63")]),a("br"),a("span",{staticClass:"line-number"},[n._v("64")]),a("br"),a("span",{staticClass:"line-number"},[n._v("65")]),a("br"),a("span",{staticClass:"line-number"},[n._v("66")]),a("br"),a("span",{staticClass:"line-number"},[n._v("67")]),a("br"),a("span",{staticClass:"line-number"},[n._v("68")]),a("br"),a("span",{staticClass:"line-number"},[n._v("69")]),a("br"),a("span",{staticClass:"line-number"},[n._v("70")]),a("br"),a("span",{staticClass:"line-number"},[n._v("71")]),a("br"),a("span",{staticClass:"line-number"},[n._v("72")]),a("br"),a("span",{staticClass:"line-number"},[n._v("73")]),a("br"),a("span",{staticClass:"line-number"},[n._v("74")]),a("br"),a("span",{staticClass:"line-number"},[n._v("75")]),a("br"),a("span",{staticClass:"line-number"},[n._v("76")]),a("br"),a("span",{staticClass:"line-number"},[n._v("77")]),a("br"),a("span",{staticClass:"line-number"},[n._v("78")]),a("br"),a("span",{staticClass:"line-number"},[n._v("79")]),a("br"),a("span",{staticClass:"line-number"},[n._v("80")]),a("br"),a("span",{staticClass:"line-number"},[n._v("81")]),a("br"),a("span",{staticClass:"line-number"},[n._v("82")]),a("br"),a("span",{staticClass:"line-number"},[n._v("83")]),a("br"),a("span",{staticClass:"line-number"},[n._v("84")]),a("br"),a("span",{staticClass:"line-number"},[n._v("85")]),a("br"),a("span",{staticClass:"line-number"},[n._v("86")]),a("br"),a("span",{staticClass:"line-number"},[n._v("87")]),a("br"),a("span",{staticClass:"line-number"},[n._v("88")]),a("br"),a("span",{staticClass:"line-number"},[n._v("89")]),a("br"),a("span",{staticClass:"line-number"},[n._v("90")]),a("br"),a("span",{staticClass:"line-number"},[n._v("91")]),a("br"),a("span",{staticClass:"line-number"},[n._v("92")]),a("br"),a("span",{staticClass:"line-number"},[n._v("93")]),a("br"),a("span",{staticClass:"line-number"},[n._v("94")]),a("br"),a("span",{staticClass:"line-number"},[n._v("95")]),a("br"),a("span",{staticClass:"line-number"},[n._v("96")]),a("br"),a("span",{staticClass:"line-number"},[n._v("97")]),a("br"),a("span",{staticClass:"line-number"},[n._v("98")]),a("br"),a("span",{staticClass:"line-number"},[n._v("99")]),a("br"),a("span",{staticClass:"line-number"},[n._v("100")]),a("br"),a("span",{staticClass:"line-number"},[n._v("101")]),a("br"),a("span",{staticClass:"line-number"},[n._v("102")]),a("br"),a("span",{staticClass:"line-number"},[n._v("103")]),a("br")])]),a("p",[n._v("最后运行成功后，我们一个进行生产，一个进行消费")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("t1\t 1\nt2\t 0\nt1\t 1\nt2\t 0\nt1\t 1\nt2\t 0\nt1\t 1\nt2\t 0\nt1\t 1\nt2\t 0\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br")])]),a("h2",{attrs:{id:"生成者和消费者3-0"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成者和消费者3-0"}},[n._v("#")]),n._v(" 生成者和消费者3.0")]),n._v(" "),a("p",[n._v("在concurrent包发布以前，在多线程环境下，我们每个程序员都必须自己去控制这些细节，尤其还要兼顾效率和线程安全，则这会给我们的程序带来不小的时间复杂度")]),n._v(" "),a("p",[n._v("现在我们使用新版的阻塞队列版生产者和消费者，使用：volatile、CAS、atomicInteger、BlockQueue、线程交互、原子引用")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('/**\n * 生产者消费者  阻塞队列版\n * 使用：volatile、CAS、atomicInteger、BlockQueue、线程交互、原子引用\n *\n * @author: 陌溪\n * @create: 2020-03-17-11:13\n */\n\nclass MyResource {\n    // 默认开启，进行生产消费\n    // 这里用到了volatile是为了保持数据的可见性，也就是当TLAG修改时，要马上通知其它线程进行修改\n    private volatile boolean FLAG = true;\n\n    // 使用原子包装类，而不用number++\n    private AtomicInteger atomicInteger = new AtomicInteger();\n\n    // 这里不能为了满足条件，而实例化一个具体的SynchronousBlockingQueue\n    BlockingQueue<String> blockingQueue = null;\n\n    // 而应该采用依赖注入里面的，构造注入方法传入\n    public MyResource(BlockingQueue<String> blockingQueue) {\n        this.blockingQueue = blockingQueue;\n        // 查询出传入的class是什么\n        System.out.println(blockingQueue.getClass().getName());\n    }\n\n    /**\n     * 生产\n     * @throws Exception\n     */\n    public void myProd() throws Exception{\n        String data = null;\n        boolean retValue;\n        // 多线程环境的判断，一定要使用while进行，防止出现虚假唤醒\n        // 当FLAG为true的时候，开始生产\n        while(FLAG) {\n            data = atomicInteger.incrementAndGet() + "";\n\n            // 2秒存入1个data\n            retValue = blockingQueue.offer(data, 2L, TimeUnit.SECONDS);\n            if(retValue) {\n                System.out.println(Thread.currentThread().getName() + "\\t 插入队列:" + data  + "成功" );\n            } else {\n                System.out.println(Thread.currentThread().getName() + "\\t 插入队列:" + data  + "失败" );\n            }\n\n            try {\n                TimeUnit.SECONDS.sleep(1);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n\n        System.out.println(Thread.currentThread().getName() + "\\t 停止生产，表示FLAG=false，生产介绍");\n    }\n\n    /**\n     * 消费\n     * @throws Exception\n     */\n    public void myConsumer() throws Exception{\n        String retValue;\n        // 多线程环境的判断，一定要使用while进行，防止出现虚假唤醒\n        // 当FLAG为true的时候，开始生产\n        while(FLAG) {\n            // 2秒存入1个data\n            retValue = blockingQueue.poll(2L, TimeUnit.SECONDS);\n            if(retValue != null && retValue != "") {\n                System.out.println(Thread.currentThread().getName() + "\\t 消费队列:" + retValue  + "成功" );\n            } else {\n                FLAG = false;\n                System.out.println(Thread.currentThread().getName() + "\\t 消费失败，队列中已为空，退出" );\n\n                // 退出消费队列\n                return;\n            }\n        }\n    }\n\n    /**\n     * 停止生产的判断\n     */\n    public void stop() {\n        this.FLAG = false;\n    }\n\n}\npublic class ProdConsumerBlockingQueueDemo {\n\n    public static void main(String[] args) {\n        // 传入具体的实现类， ArrayBlockingQueue\n        MyResource myResource = new MyResource(new ArrayBlockingQueue<String>(10));\n\n        new Thread(() -> {\n            System.out.println(Thread.currentThread().getName() + "\\t 生产线程启动");\n            System.out.println("");\n            System.out.println("");\n            try {\n                myResource.myProd();\n                System.out.println("");\n                System.out.println("");\n            } catch (Exception e) {\n                e.printStackTrace();\n            }\n        }, "prod").start();\n\n\n        new Thread(() -> {\n            System.out.println(Thread.currentThread().getName() + "\\t 消费线程启动");\n\n            try {\n                myResource.myConsumer();\n            } catch (Exception e) {\n                e.printStackTrace();\n            }\n        }, "consumer").start();\n\n        // 5秒后，停止生产和消费\n        try {\n            TimeUnit.SECONDS.sleep(5);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n\n        System.out.println("");\n        System.out.println("");\n        System.out.println("5秒中后，生产和消费线程停止，线程结束");\n        myResource.stop();\n    }\n}\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br"),a("span",{staticClass:"line-number"},[n._v("45")]),a("br"),a("span",{staticClass:"line-number"},[n._v("46")]),a("br"),a("span",{staticClass:"line-number"},[n._v("47")]),a("br"),a("span",{staticClass:"line-number"},[n._v("48")]),a("br"),a("span",{staticClass:"line-number"},[n._v("49")]),a("br"),a("span",{staticClass:"line-number"},[n._v("50")]),a("br"),a("span",{staticClass:"line-number"},[n._v("51")]),a("br"),a("span",{staticClass:"line-number"},[n._v("52")]),a("br"),a("span",{staticClass:"line-number"},[n._v("53")]),a("br"),a("span",{staticClass:"line-number"},[n._v("54")]),a("br"),a("span",{staticClass:"line-number"},[n._v("55")]),a("br"),a("span",{staticClass:"line-number"},[n._v("56")]),a("br"),a("span",{staticClass:"line-number"},[n._v("57")]),a("br"),a("span",{staticClass:"line-number"},[n._v("58")]),a("br"),a("span",{staticClass:"line-number"},[n._v("59")]),a("br"),a("span",{staticClass:"line-number"},[n._v("60")]),a("br"),a("span",{staticClass:"line-number"},[n._v("61")]),a("br"),a("span",{staticClass:"line-number"},[n._v("62")]),a("br"),a("span",{staticClass:"line-number"},[n._v("63")]),a("br"),a("span",{staticClass:"line-number"},[n._v("64")]),a("br"),a("span",{staticClass:"line-number"},[n._v("65")]),a("br"),a("span",{staticClass:"line-number"},[n._v("66")]),a("br"),a("span",{staticClass:"line-number"},[n._v("67")]),a("br"),a("span",{staticClass:"line-number"},[n._v("68")]),a("br"),a("span",{staticClass:"line-number"},[n._v("69")]),a("br"),a("span",{staticClass:"line-number"},[n._v("70")]),a("br"),a("span",{staticClass:"line-number"},[n._v("71")]),a("br"),a("span",{staticClass:"line-number"},[n._v("72")]),a("br"),a("span",{staticClass:"line-number"},[n._v("73")]),a("br"),a("span",{staticClass:"line-number"},[n._v("74")]),a("br"),a("span",{staticClass:"line-number"},[n._v("75")]),a("br"),a("span",{staticClass:"line-number"},[n._v("76")]),a("br"),a("span",{staticClass:"line-number"},[n._v("77")]),a("br"),a("span",{staticClass:"line-number"},[n._v("78")]),a("br"),a("span",{staticClass:"line-number"},[n._v("79")]),a("br"),a("span",{staticClass:"line-number"},[n._v("80")]),a("br"),a("span",{staticClass:"line-number"},[n._v("81")]),a("br"),a("span",{staticClass:"line-number"},[n._v("82")]),a("br"),a("span",{staticClass:"line-number"},[n._v("83")]),a("br"),a("span",{staticClass:"line-number"},[n._v("84")]),a("br"),a("span",{staticClass:"line-number"},[n._v("85")]),a("br"),a("span",{staticClass:"line-number"},[n._v("86")]),a("br"),a("span",{staticClass:"line-number"},[n._v("87")]),a("br"),a("span",{staticClass:"line-number"},[n._v("88")]),a("br"),a("span",{staticClass:"line-number"},[n._v("89")]),a("br"),a("span",{staticClass:"line-number"},[n._v("90")]),a("br"),a("span",{staticClass:"line-number"},[n._v("91")]),a("br"),a("span",{staticClass:"line-number"},[n._v("92")]),a("br"),a("span",{staticClass:"line-number"},[n._v("93")]),a("br"),a("span",{staticClass:"line-number"},[n._v("94")]),a("br"),a("span",{staticClass:"line-number"},[n._v("95")]),a("br"),a("span",{staticClass:"line-number"},[n._v("96")]),a("br"),a("span",{staticClass:"line-number"},[n._v("97")]),a("br"),a("span",{staticClass:"line-number"},[n._v("98")]),a("br"),a("span",{staticClass:"line-number"},[n._v("99")]),a("br"),a("span",{staticClass:"line-number"},[n._v("100")]),a("br"),a("span",{staticClass:"line-number"},[n._v("101")]),a("br"),a("span",{staticClass:"line-number"},[n._v("102")]),a("br"),a("span",{staticClass:"line-number"},[n._v("103")]),a("br"),a("span",{staticClass:"line-number"},[n._v("104")]),a("br"),a("span",{staticClass:"line-number"},[n._v("105")]),a("br"),a("span",{staticClass:"line-number"},[n._v("106")]),a("br"),a("span",{staticClass:"line-number"},[n._v("107")]),a("br"),a("span",{staticClass:"line-number"},[n._v("108")]),a("br"),a("span",{staticClass:"line-number"},[n._v("109")]),a("br"),a("span",{staticClass:"line-number"},[n._v("110")]),a("br"),a("span",{staticClass:"line-number"},[n._v("111")]),a("br"),a("span",{staticClass:"line-number"},[n._v("112")]),a("br"),a("span",{staticClass:"line-number"},[n._v("113")]),a("br"),a("span",{staticClass:"line-number"},[n._v("114")]),a("br"),a("span",{staticClass:"line-number"},[n._v("115")]),a("br"),a("span",{staticClass:"line-number"},[n._v("116")]),a("br"),a("span",{staticClass:"line-number"},[n._v("117")]),a("br"),a("span",{staticClass:"line-number"},[n._v("118")]),a("br"),a("span",{staticClass:"line-number"},[n._v("119")]),a("br"),a("span",{staticClass:"line-number"},[n._v("120")]),a("br"),a("span",{staticClass:"line-number"},[n._v("121")]),a("br"),a("span",{staticClass:"line-number"},[n._v("122")]),a("br"),a("span",{staticClass:"line-number"},[n._v("123")]),a("br"),a("span",{staticClass:"line-number"},[n._v("124")]),a("br"),a("span",{staticClass:"line-number"},[n._v("125")]),a("br"),a("span",{staticClass:"line-number"},[n._v("126")]),a("br"),a("span",{staticClass:"line-number"},[n._v("127")]),a("br"),a("span",{staticClass:"line-number"},[n._v("128")]),a("br"),a("span",{staticClass:"line-number"},[n._v("129")]),a("br"),a("span",{staticClass:"line-number"},[n._v("130")]),a("br")])]),a("p",[n._v("最后运行结果")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("java.util.concurrent.ArrayBlockingQueue\nprod\t 生产线程启动\n\n\nconsumer\t 消费线程启动\nprod\t 插入队列:1成功\nconsumer\t 消费队列:1成功\nprod\t 插入队列:2成功\nconsumer\t 消费队列:2成功\nprod\t 插入队列:3成功\nconsumer\t 消费队列:3成功\nprod\t 插入队列:4成功\nconsumer\t 消费队列:4成功\nprod\t 插入队列:5成功\nconsumer\t 消费队列:5成功\n\n\n5秒中后，生产和消费线程停止，线程结束\nprod\t 停止生产，表示FLAG=false，生产介绍\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);