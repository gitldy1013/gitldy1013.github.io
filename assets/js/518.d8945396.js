(window.webpackJsonp=window.webpackJsonp||[]).push([[518],{1214:function(s,e,n){"use strict";n.r(e);var a=n(5),r=Object(a.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"使用-compose-文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-compose-文件"}},[s._v("#")]),s._v(" 使用 compose 文件")]),s._v(" "),n("p",[s._v("正如之前使用 "),n("code",[s._v("docker-compose.yml")]),s._v(" 来一次配置、启动多个容器，在 "),n("code",[s._v("Swarm")]),s._v(" 集群中也可以使用 "),n("code",[s._v("compose")]),s._v(" 文件 （"),n("code",[s._v("docker-compose.yml")]),s._v("） 来配置、启动多个服务。")]),s._v(" "),n("p",[s._v("上一节中，我们使用 "),n("code",[s._v("docker service create")]),s._v(" 一次只能部署一个服务，使用 "),n("code",[s._v("docker-compose.yml")]),s._v(" 我们可以一次启动多个关联的服务。")]),s._v(" "),n("p",[s._v("我们以在 "),n("code",[s._v("Swarm")]),s._v(" 集群中部署 "),n("code",[s._v("WordPress")]),s._v(" 为例进行说明。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('    version: "3"\n    \n    services:\n      wordpress:\n        image: wordpress\n        ports:\n          - 80:80\n        networks:\n          - overlay\n        environment:\n          WORDPRESS_DB_HOST: db:3306\n          WORDPRESS_DB_USER: wordpress\n          WORDPRESS_DB_PASSWORD: wordpress\n        deploy:\n          mode: replicated\n          replicas: 3\n    \n      db:\n        image: mysql\n        networks:\n           - overlay\n        volumes:\n          - db-data:/var/lib/mysql\n        environment:\n          MYSQL_ROOT_PASSWORD: somewordpress\n          MYSQL_DATABASE: wordpress\n          MYSQL_USER: wordpress\n          MYSQL_PASSWORD: wordpress\n        deploy:\n          placement:\n            constraints: [node.role == manager]\n    \n      visualizer:\n        image: dockersamples/visualizer:stable\n        ports:\n          - "8080:8080"\n        stop_grace_period: 1m30s\n        volumes:\n          - "/var/run/docker.sock:/var/run/docker.sock"\n        deploy:\n          placement:\n            constraints: [node.role == manager]\n    \n    volumes:\n      db-data:\n    networks:\n      overlay:\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br")])]),n("p",[s._v("在 "),n("code",[s._v("Swarm")]),s._v(" 集群管理节点新建该文件，其中的 "),n("code",[s._v("visualizer")]),s._v(" 服务提供一个可视化页面，我们可以从浏览器中很直观的查看集群中各个服务的运行节点。")]),s._v(" "),n("p",[s._v("在 "),n("code",[s._v("Swarm")]),s._v(" 集群中使用 "),n("code",[s._v("docker-compose.yml")]),s._v(" 我们用 "),n("code",[s._v("docker stack")]),s._v(" 命令，下面我们对该命令进行详细讲解。")]),s._v(" "),n("h2",{attrs:{id:"部署服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#部署服务"}},[s._v("#")]),s._v(" 部署服务")]),s._v(" "),n("p",[s._v("部署服务使用 "),n("code",[s._v("docker stack deploy")]),s._v("，其中 "),n("code",[s._v("-c")]),s._v(" 参数指定 compose 文件名。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("    $ docker stack deploy -c docker-compose.yml wordpress\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("现在我们打开浏览器输入 "),n("code",[s._v("任一节点IP:8080")]),s._v(" 即可看到各节点运行状态。如下图所示：")]),s._v(" "),n("p",[n("img",{attrs:{src:"/img/wordpress.png",alt:""}})]),s._v(" "),n("p",[s._v("在浏览器新的标签页输入 "),n("code",[s._v("任一节点IP")]),s._v(" 即可看到 "),n("code",[s._v("WordPress")]),s._v(" 安装界面，安装完成之后，输入 "),n("code",[s._v("任一节点IP")]),s._v(" 即可看到 "),n("code",[s._v("WordPress")]),s._v(" 页面。")]),s._v(" "),n("h2",{attrs:{id:"查看服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看服务"}},[s._v("#")]),s._v(" 查看服务")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("    $ docker stack ls\n    NAME                SERVICES\n    wordpress           3\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h2",{attrs:{id:"移除服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#移除服务"}},[s._v("#")]),s._v(" 移除服务")]),s._v(" "),n("p",[s._v("要移除服务，使用 "),n("code",[s._v("docker stack down")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("    $ docker stack down wordpress\n    Removing service wordpress_db\n    Removing service wordpress_visualizer\n    Removing service wordpress_wordpress\n    Removing network wordpress_overlay\n    Removing network wordpress_default\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[s._v("该命令不会移除服务所使用的 "),n("code",[s._v("数据卷")]),s._v("，如果你想移除数据卷请使用 "),n("code",[s._v("docker volume rm")])])])}),[],!1,null,null,null);e.default=r.exports}}]);