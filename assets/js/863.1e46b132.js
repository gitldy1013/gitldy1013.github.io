(window.webpackJsonp=window.webpackJsonp||[]).push([[863],{1558:function(e,n,s){"use strict";s.r(n);var t=s(5),a=Object(t.a)({},(function(){var e=this,n=e.$createElement,s=e._self._c||n;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"使用-kubeadm-配置-slave-节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-kubeadm-配置-slave-节点"}},[e._v("#")]),e._v(" 使用 kubeadm 配置 slave 节点")]),e._v(" "),s("h2",{attrs:{id:"概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[e._v("#")]),e._v(" 概述")]),e._v(" "),s("p",[e._v("将 slave 节点加入到集群中很简单，只需要在 slave 服务器上安装 kubeadm，kubectl，kubelet 三个工具，然后使用 "),s("code",[e._v("kubeadm join")]),e._v(" 命令加入即可。准备工作如下：")]),e._v(" "),s("ul",[s("li",[e._v("修改主机名")]),e._v(" "),s("li",[e._v("配置软件源")]),e._v(" "),s("li",[e._v("安装三个工具")])]),e._v(" "),s("h2",{attrs:{id:"将-slave-加入到集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#将-slave-加入到集群"}},[e._v("#")]),e._v(" 将 slave 加入到集群")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('    kubeadm join 192.168.141.130:6443 --token abcdef.0123456789abcdef --discovery-token-ca-cert-hash sha256:cab7c86212535adde6b8d1c7415e81847715cfc8629bb1d270b601744d662515\n    \n    # 安装成功将看到如下信息\n    [preflight] Running pre-flight checks\n            [WARNING IsDockerSystemdCheck]: detected "cgroupfs" as the Docker cgroup driver. The recommended driver is "systemd". Please follow the guide at https://kubernetes.io/docs/setup/cri/\n    [preflight] Reading configuration from the cluster...\n    [preflight] FYI: You can look at this config file with \'kubectl -n kube-system get cm kubeadm-config -oyaml\'\n    [kubelet-start] Downloading configuration for the kubelet from the "kubelet-config-1.14" ConfigMap in the kube-system namespace\n    [kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"\n    [kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"\n    [kubelet-start] Activating the kubelet service\n    [kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...\n    \n    This node has joined the cluster:\n    * Certificate signing request was sent to apiserver and a response was received.\n    * The Kubelet was informed of the new secure connection details.\n    \n    Run \'kubectl get nodes\' on the control-plane to see this node join the cluster.\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br")])]),s("p",[e._v("说明：")]),e._v(" "),s("ul",[s("li",[e._v("token\n"),s("ul",[s("li",[e._v("可以通过安装 master 时的日志查看 token 信息")]),e._v(" "),s("li",[e._v("可以通过 "),s("code",[e._v("kubeadm token list")]),e._v(" 命令打印出 token 信息")]),e._v(" "),s("li",[e._v("如果 token 过期，可以使用 "),s("code",[e._v("kubeadm token create")]),e._v(" 命令创建新的 token")])])]),e._v(" "),s("li",[e._v("discovery-token-ca-cert-hash\n"),s("ul",[s("li",[e._v("可以通过安装 master 时的日志查看 sha256 信息")]),e._v(" "),s("li",[e._v("可以通过 "),s("code",[e._v("openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'")]),e._v(" 命令查看 sha256 信息")])])])]),e._v(" "),s("h2",{attrs:{id:"验证是否成功"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#验证是否成功"}},[e._v("#")]),e._v(" 验证是否成功")]),e._v(" "),s("p",[e._v("回到 master 服务器")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("    kubectl get nodes\n    \n    # 可以看到 slave 成功加入 master\n    NAME                STATUS     ROLES    AGE   VERSION\n    kubernetes-master   NotReady   master   9h    v1.14.1\n    kubernetes-slave1   NotReady   <none>   22s   v1.14.1\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br")])]),s("blockquote",[s("p",[e._v("如果 slave 节点加入 master 时配置有问题可以在 slave 节点上使用 "),s("code",[e._v("kubeadm reset")]),e._v(" 重置配置再使用 "),s("code",[e._v("kubeadm join")]),e._v(" 命令重新加入即可。希望在 master 节点删除 node ，可以使用 "),s("code",[e._v("kubeadm delete nodes <NAME>")]),e._v(" 删除。")])]),e._v(" "),s("h2",{attrs:{id:"查看-pod-状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看-pod-状态"}},[e._v("#")]),e._v(" 查看 pod 状态")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("    kubectl get pod -n kube-system -o wide\n    \n    NAME                                        READY   STATUS    RESTARTS   AGE   IP                NODE                NOMINATED NODE   READINESS GATES\n    coredns-8686dcc4fd-gwrmb                    0/1     Pending   0          9h    <none>            <none>              <none>           <none>\n    coredns-8686dcc4fd-j6gfk                    0/1     Pending   0          9h    <none>            <none>              <none>           <none>\n    etcd-kubernetes-master                      1/1     Running   1          9h    192.168.141.130   kubernetes-master   <none>           <none>\n    kube-apiserver-kubernetes-master            1/1     Running   1          9h    192.168.141.130   kubernetes-master   <none>           <none>\n    kube-controller-manager-kubernetes-master   1/1     Running   1          9h    192.168.141.130   kubernetes-master   <none>           <none>\n    kube-proxy-496dr                            1/1     Running   0          17m   192.168.141.131   kubernetes-slave1   <none>           <none>\n    kube-proxy-rsnb6                            1/1     Running   1          9h    192.168.141.130   kubernetes-master   <none>           <none>\n    kube-scheduler-kubernetes-master            1/1     Running   1          9h    192.168.141.130   kubernetes-master   <none>           <none>\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br")])]),s("p",[e._v("由此可以看出 coredns 尚未运行，此时我们还需要安装网络插件。")])])}),[],!1,null,null,null);n.default=a.exports}}]);