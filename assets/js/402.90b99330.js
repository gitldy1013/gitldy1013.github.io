(window.webpackJsonp=window.webpackJsonp||[]).push([[402],{1098:function(e,s,a){"use strict";a.r(s);var n=a(5),t=Object(n.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"kubernetes-集群扩容"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-集群扩容"}},[e._v("#")]),e._v(" Kubernetes 集群扩容")]),e._v(" "),a("h2",{attrs:{id:"概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[e._v("#")]),e._v(" 概述")]),e._v(" "),a("p",[e._v("当咱们部署的服务越来越多，K8S 的集群负载也会随之增高，为了减轻负载压力，咱们需要对集群进行扩容，就是增加新的节点（Node）")]),e._v(" "),a("h2",{attrs:{id:"扩容准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#扩容准备"}},[e._v("#")]),e._v(" 扩容准备")]),e._v(" "),a("ul",[a("li",[e._v("在新 Node 节点上按如下命令操作即可将节点加入集群")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("kubeadm join --token <Token>  <K8S Master IP>:6443  --discovery-token-ca-cert-hash sha256:<SHA256>\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("ul",[a("li",[a("strong",[e._v("Token：")]),e._v(" 不记得可以在 Master 节点上通过命令查看")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("kubeadm token list\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 输出如下\nTOKEN                     TTL       EXPIRES                     USAGES                   DESCRIPTION   EXTRA GROUPS\nqnptod.oisio6029ccqpnd6 23h  2019-10-17T13:26:10+08:00 authentication,signing <none> system:bootstrappers:kubeadm:default-node-token\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("ul",[a("li",[a("strong",[e._v("注意：")]),e._v(" 每个 Token 的有效期为 24 小时，如果上面的命令没有显示 Token ，通过以下命令创建")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("kubeadm token create\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 输出如下\nqnptod.oisio6029ccqpnd6\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("ul",[a("li",[a("strong",[e._v("SHA256：")]),e._v(" 有了 Token 以后，我们可以用以下命令查看 Kubernetes 认证的 SHA256 加密字符串")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("openssl x509 -pubkey -in  /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# 输出如下\ne10e7a8df60e7dec733a7f7449b47202ae5e49b934f079c7310d9a4d11e81006\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("h2",{attrs:{id:"加入集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#加入集群"}},[e._v("#")]),e._v(" 加入集群")]),e._v(" "),a("p",[e._v("按照上面的案例，我们可以在新 Node 节点通过命令加入集群")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("kubeadm join 192.168.141.110:6443  --token qnptod.oisio6029ccqpnd6 --discovery-token-ca-cert-hash sha256:e10e7a8df60e7dec733a7f7449b47202ae5e49b934f079c7310d9a4d11e81006\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 输出如下\n[preflight]  Running pre-flight checks\n[preflight]  Reading configuration from the cluster...\n[preflight] FYI:  You can look at this config file with \'kubectl -n kube-system get cm kubeadm-config -oyaml\'\n[kubelet-start]  Downloading configuration for the kubelet from the "kubelet-config-1.15"  ConfigMap  in the kube-system namespace\n[kubelet-start]  Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"\n[kubelet-start]  Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"\n [kubelet-start]  Activating the kubelet service\n [kubelet-start]  Waiting  for the kubelet to perform the TLS Bootstrap...\n\n This node has joined the cluster:\n *  Certificate signing request was sent to apiserver and a response was received.\n *  The  Kubelet was informed of the new secure connection details.\n\n Run  \'kubectl get nodes\' on the control-plane to see this node join the cluster.\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br")])]),a("h2",{attrs:{id:"验证集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证集群"}},[e._v("#")]),e._v(" 验证集群")]),e._v(" "),a("p",[e._v("回到 Master 节点，通过命令查看新节点是否加入")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("kubectl get nodes\n\n# 输出如下\nNAME                STATUS   ROLES    AGE     VERSION\nkubernetes-master Ready master 3d13h v1.15.4\nkubernetes-node1 Ready  <none>  3d13h v1.15.4\nkubernetes-node2 Ready  <none>  3d13h v1.15.4\nkubernetes-node3 Ready  <none>  3d13h v1.15.4\n## 可以看到新增的 Node4 节点已经成功加入集群\n kubernetes-node4 Ready  <none>  4m2s v1.15.4\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);