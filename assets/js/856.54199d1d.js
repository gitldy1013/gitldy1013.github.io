(window.webpackJsonp=window.webpackJsonp||[]).push([[856],{1551:function(s,e,a){"use strict";a.r(e);var n=a(5),t=Object(n.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"kubernetes-安装前的准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-安装前的准备"}},[s._v("#")]),s._v(" Kubernetes 安装前的准备")]),s._v(" "),a("h2",{attrs:{id:"概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),a("p",[s._v("本次安装采用 Ubuntu Server X64 18.04 LTS 版本安装 kubernetes 集群环境，集群节点为 1 主 2 从模式，此次对虚拟机会有些基本要求，如下：")]),s._v(" "),a("ul",[a("li",[s._v("OS：Ubuntu Server X64 18.04 LTS（16.04 版本步骤相同，再之前则不同）")]),s._v(" "),a("li",[s._v("CPU：最低要求，1 CPU 2 核")]),s._v(" "),a("li",[s._v("内存：最低要求，2GB")]),s._v(" "),a("li",[s._v("磁盘：最低要求，20GB")])]),s._v(" "),a("p",[s._v("创建三台虚拟机，分别命名如下：")]),s._v(" "),a("ul",[a("li",[s._v("Ubuntu Server 18.04 X64 Kubernetes Master")]),s._v(" "),a("li",[s._v("Ubuntu Server 18.04 X64 Kubernetes Slave1")]),s._v(" "),a("li",[s._v("Ubuntu Server 18.04 X64 Kubernetes Slave2")])]),s._v(" "),a("p",[s._v("对虚拟机系统的配置：")]),s._v(" "),a("ul",[a("li",[s._v("关闭交换空间："),a("code",[s._v("sudo swapoff -a")])]),s._v(" "),a("li",[s._v("避免开机启动交换空间：注释 "),a("code",[s._v("/etc/fstab")]),s._v(" 中的 "),a("code",[s._v("swap")])]),s._v(" "),a("li",[s._v("关闭防火墙："),a("code",[s._v("ufw disable")])])]),s._v(" "),a("h2",{attrs:{id:"使用-apt-安装-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-apt-安装-docker"}},[s._v("#")]),s._v(" 使用 APT 安装 Docker")]),s._v(" "),a("h3",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('    # 更新软件源\n    sudo apt-get update\n    # 安装所需依赖\n    sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common\n    # 安装 GPG 证书\n    curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -\n    # 新增软件源信息\n    sudo add-apt-repository "deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable"\n    # 再次更新软件源\n    sudo apt-get -y update\n    # 安装 Docker CE 版\n    sudo apt-get -y install docker-ce\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h3",{attrs:{id:"验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[s._v("#")]),s._v(" 验证")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    docker version\n    Client:\n     Version:           18.09.6\n     API version:       1.39\n     Go version:        go1.10.8\n     Git commit:        481bc77\n     Built:             Sat May  4 02:35:57 2019\n     OS/Arch:           linux/amd64\n     Experimental:      false\n    \n    Server: Docker Engine - Community\n     Engine:\n      Version:          18.09.6\n      API version:      1.39 (minimum version 1.12)\n      Go version:       go1.10.8\n      Git commit:       481bc77\n      Built:            Sat May  4 01:59:36 2019\n      OS/Arch:          linux/amd64\n      Experimental:     false\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("h3",{attrs:{id:"配置加速器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置加速器"}},[s._v("#")]),s._v(" 配置加速器")]),s._v(" "),a("p",[s._v("对于使用 "),a("strong",[s._v("systemd")]),s._v(" 的系统，请在 "),a("code",[s._v("/etc/docker/daemon.json")]),s._v(" 中写入如下内容（如果文件不存在请新建该文件）")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('    {\n      "registry-mirrors": [\n        "https://registry.docker-cn.com"\n      ]\n    }\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("blockquote",[a("p",[s._v("注意，一定要保证该文件符合 JSON 规范，否则 Docker 将不能启动。")])]),s._v(" "),a("p",[s._v("验证加速器是否配置成功：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    sudo systemctl restart docker\n    docker info\n    ...\n    # 出现如下语句即表示配置成功\n    Registry Mirrors:\n     https://registry.docker-cn.com/\n    ...\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h2",{attrs:{id:"修改主机名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改主机名"}},[s._v("#")]),s._v(" 修改主机名")]),s._v(" "),a("p",[s._v("在同一局域网中主机名不应该相同，所以我们需要做修改，下列操作步骤为修改 "),a("strong",[s._v("18.04")]),s._v(" 版本的 Hostname，如果是 16.04 或以下版本则直接修改 "),a("code",[s._v("/etc/hostname")]),s._v(" 里的名称即可")]),s._v(" "),a("p",[a("strong",[s._v("查看当前 Hostname")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    # 查看当前主机名\n    hostnamectl\n    # 显示如下内容\n       Static hostname: ubuntu\n             Icon name: computer-vm\n               Chassis: vm\n            Machine ID: 33011e0a95094672b99a198eff07f652\n               Boot ID: dc856039f0d24164a9f8a50c506be96d\n        Virtualization: vmware\n      Operating System: Ubuntu 18.04.2 LTS\n                Kernel: Linux 4.15.0-48-generic\n          Architecture: x86-64\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[a("strong",[s._v("修改 Hostname")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    # 使用 hostnamectl 命令修改，其中 kubernetes-master 为新的主机名\n    hostnamectl set-hostname kubernetes-master\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("修改 cloud.cfg")])]),s._v(" "),a("p",[s._v("如果 "),a("code",[s._v("cloud-init package")]),s._v(" 安装了，需要修改 "),a("code",[s._v("cloud.cfg")]),s._v(" 文件。该软件包通常缺省安装用于处理 cloud")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    # 如果有该文件\n    vi /etc/cloud/cloud.cfg\n    \n    # 该配置默认为 false，修改为 true 即可\n    preserve_hostname: true\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("strong",[s._v("验证")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("    root@kubernetes-master:~# hostnamectl\n       Static hostname: kubernetes-master\n             Icon name: computer-vm\n               Chassis: vm\n            Machine ID: 33011e0a95094672b99a198eff07f652\n               Boot ID: 8c0fd75d08c644abaad3df565e6e4cbd\n        Virtualization: vmware\n      Operating System: Ubuntu 18.04.2 LTS\n                Kernel: Linux 4.15.0-48-generic\n          Architecture: x86-64\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])])])}),[],!1,null,null,null);e.default=t.exports}}]);