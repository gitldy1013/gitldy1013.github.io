(window.webpackJsonp=window.webpackJsonp||[]).push([[862],{1560:function(s,n,e){"use strict";e.r(n);var a=e(5),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"通过资源配置运行容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#通过资源配置运行容器"}},[s._v("#")]),s._v(" 通过资源配置运行容器")]),s._v(" "),e("h2",{attrs:{id:"概述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[s._v("#")]),s._v(" 概述")]),s._v(" "),e("p",[s._v("我们知道通过 "),e("code",[s._v("run")]),s._v(" 命令启动容器非常麻烦，Docker 提供了 Compose 为我们解决了这个问题。那 Kubernetes 是如何解决这个问题的呢？其实很简单，使用 "),e("code",[s._v("kubectl create")]),s._v(" 命令就可以做到和 Compose 一样的效果了，该命令可以通过配置文件快速创建一个集群资源对象。")]),s._v(" "),e("h2",{attrs:{id:"创建-yaml-配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建-yaml-配置文件"}},[s._v("#")]),s._v(" 创建 YAML 配置文件")]),s._v(" "),e("p",[s._v("以部署 Nginx 为例")]),s._v(" "),e("h3",{attrs:{id:"部署-deployment"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署-deployment"}},[s._v("#")]),s._v(" 部署 Deployment")]),s._v(" "),e("p",[s._v("创建一个名为 "),e("code",[s._v("nginx-deployment.yml")]),s._v(" 的配置文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("    # API 版本号\n    apiVersion: extensions/v1beta1\n    # 类型，如：Pod/ReplicationController/Deployment/Service/Ingress\n    kind: Deployment\n    # 元数据\n    metadata:\n      # Kind 的名称\n      name: nginx-app\n    spec:\n      # 部署的实例数量\n      replicas: 2\n      template:\n        metadata:\n          labels:\n            # 容器标签的名字，发布 Service 时，selector 需要和这里对应\n            name: nginx\n        spec:\n          # 配置容器，数组类型，说明可以配置多个容器\n          containers:\n          # 容器名称\n          - name: nginx\n            # 容器镜像\n            image: nginx\n            # 暴露端口\n            ports:\n            # Pod 端口\n            - containerPort: 80\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("    # 部署\n    kubectl create -f nginx-deployment.yml\n    \n    # 删除\n    kubectl delete -f nginx-deployment.yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"发布-service"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#发布-service"}},[s._v("#")]),s._v(" 发布 Service")]),s._v(" "),e("p",[s._v("创建一个名为 "),e("code",[s._v("nginx-service.yml")]),s._v(" 的配置文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("    # API 版本号\n    apiVersion: v1\n    # 类型，如：Pod/ReplicationController/Deployment/Service/Ingress\n    kind: Service\n    # 元数据\n    metadata:\n      # Kind 的名称\n      name: nginx-http\n    spec:\n      # 暴露端口\n      ports:\n        ## Service 暴露的端口\n        - port: 80\n          ## Pod 上的端口，这里是将 Service 暴露的端口转发到 Pod 端口上\n          targetPort: 80\n      # 类型\n      type: LoadBalancer\n      # 标签选择器\n      selector:\n        # 需要和上面部署的 Deployment 标签名对应\n        name: nginx\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("    # 部署\n    kubectl create -f nginx-service.yml\n    \n    # 删除\n    kubectl delete -f nginx-service.yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h2",{attrs:{id:"验证是否生效"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#验证是否生效"}},[s._v("#")]),s._v(" 验证是否生效")]),s._v(" "),e("h3",{attrs:{id:"查看-pod-列表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看-pod-列表"}},[s._v("#")]),s._v(" 查看 Pod 列表")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("    kubectl get pods\n    \n    # 输出如下\n    NAME                         READY   STATUS    RESTARTS   AGE\n    nginx-app-64bb598779-2pplx   1/1     Running   0          25m\n    nginx-app-64bb598779-824lc   1/1     Running   0          25m\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h3",{attrs:{id:"查看-deployment-列表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看-deployment-列表"}},[s._v("#")]),s._v(" 查看 Deployment 列表")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("    kubectl get deployment\n    \n    # 输出如下\n    NAME        READY   UP-TO-DATE   AVAILABLE   AGE\n    nginx-app   2/2     2            2           25m\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h3",{attrs:{id:"查看-service-列表"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看-service-列表"}},[s._v("#")]),s._v(" 查看 Service 列表")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("    kubectl get service\n    \n    # 输出如下\n    NAME         TYPE           CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE\n    kubernetes   ClusterIP      10.96.0.1      <none>        443/TCP        20h\n    nginx-http    LoadBalancer   10.98.49.142   <pending>     80:31631/TCP   14m\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h3",{attrs:{id:"查看-service-详情"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看-service-详情"}},[s._v("#")]),s._v(" 查看 Service 详情")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("    kubectl describe service nginx-app\n    \n    # 输出如下\n    Name:                     nginx-http\n    Namespace:                default\n    Labels:                   <none>\n    Annotations:              <none>\n    Selector:                 name=nginx\n    Type:                     LoadBalancer\n    IP:                       10.98.49.142\n    Port:                     <unset>  80/TCP\n    TargetPort:               80/TCP\n    NodePort:                 <unset>  31631/TCP\n    Endpoints:                10.244.141.205:80,10.244.2.4:80\n    Session Affinity:         None\n    External Traffic Policy:  Cluster\n    Events:                   <none>\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("h3",{attrs:{id:"通过浏览器访问"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#通过浏览器访问"}},[s._v("#")]),s._v(" 通过浏览器访问")]),s._v(" "),e("p",[s._v("通过浏览器访问 http://192.168.141.150:31631/ ，出现 Nginx 欢迎页即表示成功")]),s._v(" "),e("h2",{attrs:{id:"集成环境部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#集成环境部署"}},[s._v("#")]),s._v(" 集成环境部署")]),s._v(" "),e("p",[s._v("也可以不区分配置文件，一次性部署 Deployment 和 Service，创建一个名为 "),e("code",[s._v("nginx.yml")]),s._v(" 的配置文件，配置内容如下：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("    apiVersion: extensions/v1beta1\n    kind: Deployment\n    metadata:\n      name: nginx-app\n    spec:\n      replicas: 2\n      template:\n        metadata:\n          labels:\n            name: nginx\n        spec:\n          containers:\n          - name: nginx\n            image: nginx\n            ports:\n            - containerPort: 80\n    ---\n    apiVersion: v1\n    kind: Service\n    metadata:\n      name: nginx-http\n    spec:\n      ports:\n        - port: 80\n          targetPort: 80\n          # 可以指定 NodePort 端口，默认范围是：30000-32767\n          # nodePort: 30080\n      type: LoadBalancer\n      selector:\n        name: nginx\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br")])]),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("    # 部署\n    kubectl create -f nginx.yml\n    \n    # 删除\n    kubectl delete -f nginx.yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h2",{attrs:{id:"附-修改默认的端口范围"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#附-修改默认的端口范围"}},[s._v("#")]),s._v(" 附：修改默认的端口范围")]),s._v(" "),e("p",[s._v("Kubernetes 服务的 NodePort 默认端口范围是 30000-32767，在某些场合下，这个限制不太适用，我们可以自定义它的端口范围，操作步骤如下：")]),s._v(" "),e("p",[s._v("编辑 "),e("code",[s._v("vi /etc/kubernetes/manifests/kube-apiserver.yaml")]),s._v(" 配置文件，增加配置 "),e("code",[s._v("--service-node-port-range=2-65535")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("    apiVersion: v1\n    kind: Pod\n    metadata:\n      creationTimestamp: null\n      labels:\n        component: kube-apiserver\n        tier: control-plane\n      name: kube-apiserver\n      namespace: kube-system\n    spec:\n      containers:\n      - command:\n        - kube-apiserver\n        # 在这里增加配置即可\n        - --service-node-port-range=2-65535\n        - --advertise-address=192.168.141.150\n        - --allow-privileged=true\n        - --authorization-mode=Node,RBAC\n        - --client-ca-file=/etc/kubernetes/pki/ca.crt\n        - --enable-admission-plugins=NodeRestriction\n        - --enable-bootstrap-token-auth=true\n        - --etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt\n        - --etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt\n    // 以下配置省略...\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br")])]),e("p",[s._v("使用 "),e("code",[s._v("docker ps")]),s._v(" 命令找到 "),e("code",[s._v("kube-apiserver")]),s._v(" 容器，再使用 "),e("code",[s._v("docker restart <ApiServer 容器 ID>")]),s._v(" 即可生效。")])])}),[],!1,null,null,null);n.default=t.exports}}]);