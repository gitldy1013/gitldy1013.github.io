(window.webpackJsonp=window.webpackJsonp||[]).push([[60],{757:function(s,t,a){"use strict";a.r(t);var n=a(5),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"go操作消息队列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#go操作消息队列"}},[s._v("#")]),s._v(" Go操作消息队列")]),s._v(" "),a("p",[s._v("NSQ是目前比较流行的一个分布式的消息队列，本文主要介绍了NSQ及Go语言如何操作NSQ。")]),s._v(" "),a("p",[s._v("使用消息队列的主要目的，异步、解耦、削峰")]),s._v(" "),a("h2",{attrs:{id:"nsq介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nsq介绍"}},[s._v("#")]),s._v(" NSQ介绍")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://nsq.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("NSQ"),a("OutboundLink")],1),s._v("是Go语言编写的一个开源的实时分布式内存消息队列，其性能十分优异。 NSQ的优势有以下优势：")]),s._v(" "),a("ol",[a("li",[s._v("NSQ提倡分布式和分散的拓扑，没有单点故障，支持容错和高可用性，并提供可靠的消息交付保证")]),s._v(" "),a("li",[s._v("NSQ支持横向扩展，没有任何集中式代理。")]),s._v(" "),a("li",[s._v("NSQ易于配置和部署，并且内置了管理界面。")])]),s._v(" "),a("h2",{attrs:{id:"nsq的应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nsq的应用场景"}},[s._v("#")]),s._v(" NSQ的应用场景")]),s._v(" "),a("p",[s._v("通常来说，消息队列都适用以下场景。")]),s._v(" "),a("h3",{attrs:{id:"异步处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异步处理"}},[s._v("#")]),s._v(" 异步处理")]),s._v(" "),a("p",[s._v("参照下图利用消息队列把业务流程中的非关键流程异步化，从而显著降低业务请求的响应时间。"),a("img",{attrs:{src:"/images/nsq1.png",alt:"nsq应用场景1"}})]),s._v(" "),a("h3",{attrs:{id:"应用解耦"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用解耦"}},[s._v("#")]),s._v(" 应用解耦")]),s._v(" "),a("p",[s._v("通过使用消息队列将不同的业务逻辑解耦，降低系统间的耦合，提高系统的健壮性。后续有其他业务要使用订单数据可直接订阅消息队列，提高系统的灵活性。"),a("img",{attrs:{src:"/images/nsq2.png",alt:"nsq应用场景1"}})]),s._v(" "),a("h3",{attrs:{id:"流量削峰"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#流量削峰"}},[s._v("#")]),s._v(" 流量削峰")]),s._v(" "),a("p",[s._v("类似秒杀（大秒）等场景下，某一时间可能会产生大量的请求，使用消息队列能够为后端处理请求提供一定的缓冲区，保证后端服务的稳定性。"),a("img",{attrs:{src:"/images/nsq3.png",alt:"nsq应用场景1"}})]),s._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://nsq.io/deployment/installing.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方下载页面"),a("OutboundLink")],1),s._v("根据自己的平台下载并解压即可。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/images/image-20200901105947668.png",alt:"image-20200901105947668"}})]),s._v(" "),a("h2",{attrs:{id:"nsq组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nsq组件"}},[s._v("#")]),s._v(" NSQ组件")]),s._v(" "),a("h3",{attrs:{id:"nsqd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nsqd"}},[s._v("#")]),s._v(" nsqd")]),s._v(" "),a("p",[s._v("nsqd是一个守护进程，它接收、排队并向客户端发送消息。")]),s._v(" "),a("p",[s._v("启动"),a("code",[s._v("nsqd")]),s._v("，指定"),a("code",[s._v("-broadcast-address=127.0.0.1")]),s._v("来配置广播地址")]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nsqd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("broadcast"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果是在搭配"),a("code",[s._v("nsqlookupd")]),s._v("使用的模式下需要还指定"),a("code",[s._v("nsqlookupd")]),s._v("地址:")]),s._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./nsqd -broadcast-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -lookupd-tcp-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:4160\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("最后我们还需要启动图形化的界面 nsqadmin")]),s._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("nsqadmin -lookupd-http-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:4161\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后在启动成功后，在浏览器输入 127.0.0.1:4171，即可进入图形化界面")]),s._v(" "),a("p",[a("img",{attrs:{src:"/images/image-20200901125118515.png",alt:"image-20200901125118515"}})]),s._v(" "),a("p",[s._v("如果是部署了多个"),a("code",[s._v("nsqlookupd")]),s._v("节点的集群，那还可以指定多个"),a("code",[s._v("-lookupd-tcp-address")]),s._v("。")]),s._v(" "),a("p",[a("code",[s._v("nsqdq")]),s._v("相关配置项如下：")]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("auth"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address value\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("addr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" to query auth server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("may be given multiple times"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("broadcast"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    address that will be registered with lookupd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("defaults to the OS hostname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PROSNAKES.local"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    path to config file\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("path "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    path to store disk"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("backed messages\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deflate\n    enable deflate feature negotiation "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("client compression"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("e2e"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("processing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("latency"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("percentile value\n    message processing time percentiles "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("as float "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" to track "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("can be specified multiple times or comma separated '"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.99")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.95")]),s._v("'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("e2e"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("processing"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("latency"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("window"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("time duration\n    calculate end to end latency quantiles "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" this duration of time "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ie"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 60s would only show quantile calculations from the past "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" seconds"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 10m0s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("addr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" to listen on "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" HTTP clients "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0:4151"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("connect"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout duration\n    timeout "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" HTTP connect "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 2s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("request"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout duration\n    timeout "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" HTTP request "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("https"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("addr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" to listen on "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" HTTPS clients "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0:4152"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("prefix "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    log message prefix "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[nsqd] "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("lookupd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tcp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address value\n    lookupd TCP address "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("may be given multiple times"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("body"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("size "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("\n    maximum size of a single command body "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5242880")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bytes"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("per"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("\n    number of bytes per diskqueue file before rolling "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("104857600")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("deflate"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("level "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("\n    max deflate compression level a client can negotiate "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" values "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" nsqd CPU usage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("heartbeat"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("interval duration\n    maximum client configurable duration of time between client heartbeats "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 1m0s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("size "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("\n    maximum size of a single message in bytes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1048576")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout duration\n    maximum duration before a message will timeout "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 15m0s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("output"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("buffer"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("size "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("\n    maximum client configurable size "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("in bytes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" a client output buffer "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("output"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("buffer"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout duration\n    maximum client configurable duration of time between flushing to a client "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 1s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rdy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("count "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("\n    maximum RDY count "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" a client "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("max"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("req"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout duration\n    maximum requeuing timeout "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" a message "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 1h0m0s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("mem"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("queue"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("size "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("\n    number of messages to keep in memory "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("per topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("channel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    duration to wait before auto"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("requeing a message "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1m0s"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("id "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("\n    unique part "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" message IDs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" in "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("range")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" is hash of hostname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("616")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("snappy\n    enable snappy feature negotiation "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("client compression"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("statsd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    UDP "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("addr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" of a statsd daemon "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" pushing stats\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("statsd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("interval "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    duration between pushing to statsd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1m0s"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("statsd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("mem"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("stats\n    toggle sending memory and GC stats to statsd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("statsd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("prefix "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    prefix used "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" keys sent to statsd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("s "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" host replacement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nsq.%s"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sync"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("every "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("\n    number of messages per diskqueue fsync "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sync"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout duration\n    duration of time per diskqueue fsync "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 2s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tcp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("addr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" to listen on "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" TCP clients "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0:4150"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    path to certificate file\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("auth"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("policy "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    client certificate auth policy "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token char"}},[s._v("'require'")]),s._v(" or 'require"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("verify'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    path to key file\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("min"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("version value\n    minimum SSL"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("TLS version acceptable "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token char"}},[s._v("'ssl3.0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token char"}},[s._v("'tls1.0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token char"}},[s._v("'tls1.1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" or "),a("span",{pre:!0,attrs:{class:"token char"}},[s._v("'tls1.2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("769")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("required\n    require TLS "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" client connections "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" tcp"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    path to certificate authority file\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("verbose\n    enable verbose logging\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("version\n    "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("print")]),s._v(" version "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("worker"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("id\n    do NOT use this"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" use "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("node"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("id\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br")])]),a("h3",{attrs:{id:"nsqlookupd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nsqlookupd"}},[s._v("#")]),s._v(" nsqlookupd")]),s._v(" "),a("p",[s._v("nsqlookupd是维护所有nsqd状态、提供服务发现的守护进程。它能为消费者查找特定"),a("code",[s._v("topic")]),s._v("下的nsqd提供了运行时的自动发现服务。 它不维持持久状态，也不需要与任何其他nsqlookupd实例协调以满足查询。因此根据你系统的冗余要求尽可能多地部署"),a("code",[s._v("nsqlookupd")]),s._v("节点。它们消耗的资源很少，可以与其他服务共存。我们的建议是为每个数据中心运行至少3个集群。")]),s._v(" "),a("p",[a("code",[s._v("nsqlookupd")]),s._v("相关配置项如下：")]),s._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("-broadcast-address string\n    address of this lookupd node, "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default to the OS "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("hostname")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"PROSNAKES.local"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n-config string\n    path to config "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n-http-address string\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("addr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" to listen on "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" HTTP clients "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0:4161"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n-inactive-producer-timeout duration\n    duration of "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" a producer will remain "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the active list since its last "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default 5m0s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n-log-prefix string\n    log message prefix "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[nsqlookupd] "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n-tcp-address string\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("addr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" to listen on "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" TCP clients "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0:4160"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n-tombstone-lifetime duration\n    duration of "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" a producer will remain tombstoned "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" registration remains "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("default 45s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n-verbose\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" verbose logging\n-version\n    print version string\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("h3",{attrs:{id:"nsqadmin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nsqadmin"}},[s._v("#")]),s._v(" nsqadmin")]),s._v(" "),a("p",[s._v("一个实时监控集群状态、执行各种管理任务的Web管理平台。 启动"),a("code",[s._v("nsqadmin")]),s._v("，指定"),a("code",[s._v("nsqlookupd")]),s._v("地址:")]),s._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("./nsqadmin -lookupd-http-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:4161\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("我们可以使用浏览器打开"),a("code",[s._v("http://127.0.0.1:4171/")]),s._v("访问如下管理界面。"),a("img",{attrs:{src:"/images/nsqadmin0.png",alt:"nsqadmin管理界面"}})]),s._v(" "),a("p",[a("code",[s._v("nsqadmin")]),s._v("相关的配置项如下：")]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("allow"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("from"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cidr "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    A CIDR from which to allow HTTP requests to the "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("config endpoint "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1/8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    path to config file\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("graphite"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("url "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    graphite HTTP address\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("addr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" to listen on "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" HTTP clients "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0:4171"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("connect"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout duration\n    timeout "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" HTTP connect "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 2s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("request"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("timeout duration\n    timeout "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" HTTP request "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 5s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cert "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    path to certificate file "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the HTTP client\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("insecure"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("skip"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("verify\n    configure the HTTP client to skip verification of TLS certificates\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("key "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    path to key file "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the HTTP client\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("tls"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ca"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("file "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    path to CA file "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the HTTP client\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("prefix "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    log message prefix "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[nsqadmin] "')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("lookupd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address value\n    lookupd HTTP address "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("may be given multiple times"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("notification"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("endpoint "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    HTTP endpoint "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fully qualified"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" to which POST notifications of admin actions will be sent\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nsqd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("address value\n    nsqd HTTP address "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("may be given multiple times"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("proxy"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("graphite\n    proxy HTTP requests to graphite\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("statsd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("counter"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("format "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    The counter stats key formatting applied by the implementation of statsd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" If no formatting is desired"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" set this to an empty "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stats.counters.%s.count"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("statsd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("gauge"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("format "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    The gauge stats key formatting applied by the implementation of statsd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" If no formatting is desired"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" set this to an empty "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stats.gauges.%s"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("statsd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("interval duration\n    time interval nsqd is configured to push to statsd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("must match nsqd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" 1m0s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("statsd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("prefix "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n    prefix used "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" keys sent to statsd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("s "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" host replacement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" must match nsqd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nsq.%s"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("version\n    "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("print")]),s._v(" version "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br")])]),a("h2",{attrs:{id:"nsq架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nsq架构"}},[s._v("#")]),s._v(" NSQ架构")]),s._v(" "),a("h3",{attrs:{id:"nsq工作模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nsq工作模式"}},[s._v("#")]),s._v(" NSQ工作模式")]),s._v(" "),a("p",[a("img",{attrs:{src:"/images/nsq4.png",alt:"nsq架构设计"}})]),s._v(" "),a("h3",{attrs:{id:"topic和channel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#topic和channel"}},[s._v("#")]),s._v(" Topic和Channel")]),s._v(" "),a("p",[s._v("每个nsqd实例旨在一次处理多个数据流。这些数据流称为"),a("code",[s._v("“topics”")]),s._v("，一个"),a("code",[s._v("topic")]),s._v("具有1个或多个"),a("code",[s._v("“channels”")]),s._v("。每个"),a("code",[s._v("channel")]),s._v("都会收到"),a("code",[s._v("topic")]),s._v("所有消息的副本，实际上下游的服务是通过对应的"),a("code",[s._v("channel")]),s._v("来消费"),a("code",[s._v("topic")]),s._v("消息。")]),s._v(" "),a("p",[a("code",[s._v("topic")]),s._v("和"),a("code",[s._v("channel")]),s._v("不是预先配置的。"),a("code",[s._v("topic")]),s._v("在首次使用时创建，方法是将其发布到指定"),a("code",[s._v("topic")]),s._v("，或者订阅指定"),a("code",[s._v("topic")]),s._v("上的"),a("code",[s._v("channel")]),s._v("。"),a("code",[s._v("channel")]),s._v("是通过订阅指定的"),a("code",[s._v("channel")]),s._v("在第一次使用时创建的。")]),s._v(" "),a("p",[a("code",[s._v("topic")]),s._v("和"),a("code",[s._v("channel")]),s._v("都相互独立地缓冲数据，防止缓慢的消费者导致其他"),a("code",[s._v("chennel")]),s._v("的积压（同样适用于"),a("code",[s._v("topic")]),s._v("级别）。")]),s._v(" "),a("p",[a("code",[s._v("channel")]),s._v("可以并且通常会连接多个客户端。假设所有连接的客户端都处于准备接收消息的状态，则每条消息将被传递到随机客户端。例如：")]),s._v(" "),a("p",[a("img",{attrs:{src:"/images/nsq5.gif",alt:"nsq架构设计"}}),s._v("总而言之，消息是从"),a("code",[s._v("topic -> channel")]),s._v("（每个channel接收该topic的所有消息的副本）多播的，但是从"),a("code",[s._v("channel -> consumers")]),s._v("均匀分布（每个消费者接收该channel的一部分消息）。")]),s._v(" "),a("h3",{attrs:{id:"nsq接收和发送消息流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nsq接收和发送消息流程"}},[s._v("#")]),s._v(" NSQ接收和发送消息流程")]),s._v(" "),a("p",[a("img",{attrs:{src:"/images/nsq6.png",alt:"nsq架构设计"}})]),s._v(" "),a("ul",[a("li",[s._v("input Chan：就是go语言中的通道")]),s._v(" "),a("li",[s._v("In-Memory Chan：是内存的通道，负责将消息进行持久化")]),s._v(" "),a("li",[s._v("Output Chan：")])]),s._v(" "),a("h2",{attrs:{id:"nsq特性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nsq特性"}},[s._v("#")]),s._v(" NSQ特性")]),s._v(" "),a("ul",[a("li",[s._v("消息默认不持久化，可以配置成持久化模式。nsq采用的方式时内存+硬盘的模式，当内存到达一定程度时就会将数据持久化到硬盘。\n"),a("ul",[a("li",[s._v("如果将"),a("code",[s._v("--mem-queue-size")]),s._v("设置为0，所有的消息将会存储到磁盘。")]),s._v(" "),a("li",[s._v("服务器重启时也会将当时在内存中的消息持久化。")])])]),s._v(" "),a("li",[s._v("每条消息至少传递一次。")]),s._v(" "),a("li",[s._v("消息不保证有序。")])]),s._v(" "),a("h2",{attrs:{id:"go操作nsq"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#go操作nsq"}},[s._v("#")]),s._v(" Go操作NSQ")]),s._v(" "),a("p",[s._v("官方提供了Go语言版的客户端："),a("a",{attrs:{href:"https://github.com/nsqio/go-nsq",target:"_blank",rel:"noopener noreferrer"}},[s._v("go-nsq"),a("OutboundLink")],1),s._v("，更多客户端支持请查看"),a("a",{attrs:{href:"https://nsq.io/clients/client_libraries.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("CLIENT LIBRARIES"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),a("p",[s._v("首先进入bin目录下，打开cmd，输入")]),s._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("nsqlookupd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后就开启了nsq服务，端口号是4160")]),s._v(" "),a("p",[a("img",{attrs:{src:"/images/image-20200901110859477.png",alt:"image-20200901110859477"}})]),s._v(" "),a("p",[s._v("然后我们在启动一个cmd界面，输入下面的代码，启动nsqd，nsqd是一个守护进程，它用于接收、排队并向客户端发送消息，启动nsqd，指定 "),a("code",[s._v("-broadcast-address=127.0.0.1")]),s._v(" 来配置广播地址")]),s._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("nsqd -broadcast-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果是在搭配 "),a("code",[s._v("nsqlookupd")]),s._v("，使用的模式下需要还指定"),a("code",[s._v("nsqlookupd")]),s._v("的地址")]),s._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("nsqd -broadcast-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -lookupd-tcp-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:4160\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("启动成功的图片如下所示")]),s._v(" "),a("p",[a("img",{attrs:{src:"/images/image-20200901111133414.png",alt:"image-20200901111133414"}})]),s._v(" "),a("h3",{attrs:{id:"安装-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装-2"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("go get -u github.com/nsqio/go-nsq\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"生产者"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生产者"}},[s._v("#")]),s._v(" 生产者")]),s._v(" "),a("p",[s._v("一个简单的生产者示例代码如下：")]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// nsq_producer/main.go")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" main\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bufio"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fmt"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"os"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"strings"')]),s._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"github.com/nsqio/go-nsq"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// NSQ Producer Demo")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" producer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("nsq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Producer\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 初始化生产者")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("initProducer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("str "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tconfig "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" nsq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tproducer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" nsq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewProducer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("str"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tfmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"create producer failed, err:%v\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" err\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tnsqAddress "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:4150"')]),s._v("\n\terr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("initProducer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nsqAddress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tfmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"init producer failed, err:%v\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\treader "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" bufio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewReader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Stdin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 从标准输入读取")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tdata"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" reader"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ReadString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token char"}},[s._v("'\\n'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\tfmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"read string from stdin failed, err:%v\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t\tdata "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" strings"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("TrimSpace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" strings"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ToUpper")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Q"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 输入Q退出")]),s._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 向 'topic_demo' publish 数据")]),s._v("\n\t\terr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" producer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Publish")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic_demo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("byte")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\tfmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"publish msg to nsq failed, err:%v\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br")])]),a("p",[s._v("将上面的代码编译执行，然后在终端输入两条数据"),a("code",[s._v("123")]),s._v("和"),a("code",[s._v("456")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ ./nsq_producer \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("/10/22 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":41:20 INF    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:4150"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" connecting to nsqd\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("456")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("使用浏览器打开"),a("code",[s._v("http://127.0.0.1:4171/")]),s._v("可以查看到类似下面的页面： 在下面这个页面能看到当前的"),a("code",[s._v("topic")]),s._v("信息："),a("img",{attrs:{src:"/images/nsqadmin1.png",alt:"nsqadmin界面1"}})]),s._v(" "),a("p",[s._v("点击页面上的"),a("code",[s._v("topic_demo")]),s._v("就能进入一个展示更多详细信息的页面，在这个页面上我们可以查看和管理"),a("code",[s._v("topic")]),s._v("，同时能够看到目前在"),a("code",[s._v("LWZMBP:4151 (127.0.01:4151)")]),s._v("这个"),a("code",[s._v("nsqd")]),s._v("上有2条message。又因为没有消费者接入所以暂时没有创建"),a("code",[s._v("channel")]),s._v("。"),a("img",{attrs:{src:"/images/nsqadmin2.png",alt:"nsqadmin界面2"}})]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("/nodes")]),s._v("这个页面我们能够很方便的查看当前接入"),a("code",[s._v("lookupd")]),s._v("的"),a("code",[s._v("nsqd")]),s._v("节点。"),a("img",{attrs:{src:"/images/nsqadmin3.png",alt:"nsqadmin界面3"}})]),s._v(" "),a("p",[s._v("这个"),a("code",[s._v("/counter")]),s._v("页面显示了处理的消息数量，因为我们没有接入消费者，所以处理的消息数量为0。![images/nsqadmin4.png)")]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("/lookup")]),s._v("界面支持创建"),a("code",[s._v("topic")]),s._v("和"),a("code",[s._v("channel")]),s._v("。"),a("img",{attrs:{src:"/images/nsqadmin5.png",alt:"nsqadmin界面5"}})]),s._v(" "),a("h3",{attrs:{id:"消费者"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#消费者"}},[s._v("#")]),s._v(" 消费者")]),s._v(" "),a("p",[s._v("一个简单的消费者示例代码如下：")]),s._v(" "),a("div",{staticClass:"language-go line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// nsq_consumer/main.go")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" main\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fmt"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"os"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"os/signal"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"syscall"')]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time"')]),s._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"github.com/nsqio/go-nsq"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// NSQ Consumer Demo")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// MyHandler 是一个消费者类型")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" MyHandler "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tTitle "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// HandleMessage 是需要实现的处理消息的方法")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("m "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("MyHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("HandleMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("nsq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tfmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%s recv from %v, msg:%v\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Title"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("NSQDAddress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 初始化消费者")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("initConsumer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("topic "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" channel "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" address "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tconfig "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" nsq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tconfig"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("LookupdPollInterval "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Second\n\tc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" nsq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewConsumer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("topic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" channel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tfmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"create consumer failed, err:%v\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\tconsumer "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("MyHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tTitle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"沙河1号"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\tc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("AddHandler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("consumer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// if err := c.ConnectToNSQD(address); err != nil { // 直接连NSQD")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ConnectToNSQLookupd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("address"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 通过lookupd查询")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" err\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\terr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("initConsumer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"topic_demo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"first"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:4161"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tfmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"init consumer failed, err:%v\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\tc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("chan")]),s._v(" os"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Signal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 定义一个信号的通道")]),s._v("\n\tsignal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Notify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" syscall"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SIGINT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 转发键盘中断信号到c")]),s._v("\n\t"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<-")]),s._v("c                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 阻塞")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br")])]),a("p",[s._v("将上面的代码保存之后编译执行，就能够获取之前我们publish的两条消息了：")]),s._v(" "),a("div",{staticClass:"language-shell script line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ ./nsq_consumer \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("/10/22 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":49:06 INF    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("topic_demo/first"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" querying nsqlookupd http://127.0.0.1:4161/lookup?topic"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("topic_demo\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("/10/22 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":49:06 INF    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("topic_demo/first"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:4150"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" connecting to nsqd\n沙河1号 recv from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:4150, msg:123\n沙河1号 recv from "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:4150, msg:456\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("同时在nsqadmin的"),a("code",[s._v("/counter")]),s._v("页面查看到处理的数据数量为2。"),a("img",{attrs:{src:"/images/nsqadmin6.png",alt:"nsqadmin界面5"}})]),s._v(" "),a("p",[s._v("关于"),a("code",[s._v("go-nsq")]),s._v("的更多内容请阅读"),a("a",{attrs:{href:"https://godoc.org/github.com/nsqio/go-nsq",target:"_blank",rel:"noopener noreferrer"}},[s._v("go-nsq的官方文档"),a("OutboundLink")],1),s._v("。")])])}),[],!1,null,null,null);t.default=e.exports}}]);