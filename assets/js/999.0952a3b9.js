(window.webpackJsonp=window.webpackJsonp||[]).push([[999],{1695:function(n,s,a){"use strict";a.r(s);var e=a(5),r=Object(e.a)({},(function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("h1",{attrs:{id:"创建服务消费者-ribbon"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建服务消费者-ribbon"}},[n._v("#")]),n._v(" 创建服务消费者（Ribbon）")]),n._v(" "),a("h2",{attrs:{id:"概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[n._v("#")]),n._v(" 概述")]),n._v(" "),a("p",[n._v("在微服务架构中，业务都会被拆分成一个独立的服务，服务与服务的通讯是基于 http restful 的。Spring cloud 有两种服务调用方式，一种是 ribbon + restTemplate，另一种是 feign。在这一篇文章首先讲解下基于 ribbon + rest。")]),n._v(" "),a("h2",{attrs:{id:"ribbon-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ribbon-简介"}},[n._v("#")]),n._v(" Ribbon 简介")]),n._v(" "),a("p",[n._v("Ribbon 是一个负载均衡客户端，可以很好的控制 "),a("code",[n._v("http")]),n._v(" 和 "),a("code",[n._v("tcp")]),n._v(" 的一些行为。")]),n._v(" "),a("h2",{attrs:{id:"准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[n._v("#")]),n._v(" 准备工作")]),n._v(" "),a("ul",[a("li",[n._v("启动服务提供者（本教程案例工程为："),a("code",[n._v("hello-spring-cloud-service-admin")]),n._v("），端口号为："),a("code",[n._v("8762")])]),n._v(" "),a("li",[n._v("修改配置文件的端口号为："),a("code",[n._v("8763")]),n._v("，启动后在 Eureka 中会注册两个实例，这相当于一个小集群")])]),n._v(" "),a("p",[a("img",{attrs:{src:"/img/201805292246003.png",alt:""}})]),n._v(" "),a("h2",{attrs:{id:"创建服务消费者"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建服务消费者"}},[n._v("#")]),n._v(" 创建服务消费者")]),n._v(" "),a("p",[n._v("创建一个工程名为 "),a("code",[n._v("hello-spring-cloud-web-admin-ribbon")]),n._v(" 的服务消费者项目，"),a("code",[n._v("pom.xml")]),n._v(" 配置如下：")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('    <?xml version="1.0" encoding="UTF-8"?>\n    <project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n             xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">\n        <modelVersion>4.0.0</modelVersion>\n    \n        <parent>\n            <groupId>com.cmcc</groupId>\n            <artifactId>hello-spring-cloud-dependencies</artifactId>\n            <version>1.0.0-SNAPSHOT</version>\n            <relativePath>../hello-spring-cloud-dependencies/pom.xml</relativePath>\n        </parent>\n    \n        <artifactId>hello-spring-cloud-web-admin-ribbon</artifactId>\n        <packaging>jar</packaging>\n    \n        <name>hello-spring-cloud-web-admin-ribbon</name>\n        <url>http://www.cmcc.com</url>\n        <inceptionYear>2018-Now</inceptionYear>\n    \n        <dependencies>\n            \x3c!-- Spring Boot Begin --\x3e\n            <dependency>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-starter-web</artifactId>\n            </dependency>\n            <dependency>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-starter-tomcat</artifactId>\n            </dependency>\n            <dependency>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-starter-thymeleaf</artifactId>\n            </dependency>\n            <dependency>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-starter-actuator</artifactId>\n            </dependency>\n            <dependency>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-starter-test</artifactId>\n                <scope>test</scope>\n            </dependency>\n            \x3c!-- Spring Boot End --\x3e\n    \n            \x3c!-- Spring Cloud Begin --\x3e\n            <dependency>\n                <groupId>org.springframework.cloud</groupId>\n                <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>\n            </dependency>\n            <dependency>\n                <groupId>org.springframework.cloud</groupId>\n                <artifactId>spring-cloud-starter-netflix-ribbon</artifactId>\n            </dependency>\n            \x3c!-- Spring Cloud End --\x3e\n    \n            \x3c!-- 解决 thymeleaf 模板引擎一定要执行严格的 html5 格式校验问题 --\x3e\n            <dependency>\n                <groupId>net.sourceforge.nekohtml</groupId>\n                <artifactId>nekohtml</artifactId>\n            </dependency>\n        </dependencies>\n    \n        <build>\n            <plugins>\n                <plugin>\n                    <groupId>org.springframework.boot</groupId>\n                    <artifactId>spring-boot-maven-plugin</artifactId>\n                    <configuration>\n                        <mainClass>com.cmcc.hello.spring.cloud.web.admin.ribbon.WebAdminRibbonApplication</mainClass>\n                    </configuration>\n                </plugin>\n            </plugins>\n        </build>\n    </project>\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br"),a("span",{staticClass:"line-number"},[n._v("45")]),a("br"),a("span",{staticClass:"line-number"},[n._v("46")]),a("br"),a("span",{staticClass:"line-number"},[n._v("47")]),a("br"),a("span",{staticClass:"line-number"},[n._v("48")]),a("br"),a("span",{staticClass:"line-number"},[n._v("49")]),a("br"),a("span",{staticClass:"line-number"},[n._v("50")]),a("br"),a("span",{staticClass:"line-number"},[n._v("51")]),a("br"),a("span",{staticClass:"line-number"},[n._v("52")]),a("br"),a("span",{staticClass:"line-number"},[n._v("53")]),a("br"),a("span",{staticClass:"line-number"},[n._v("54")]),a("br"),a("span",{staticClass:"line-number"},[n._v("55")]),a("br"),a("span",{staticClass:"line-number"},[n._v("56")]),a("br"),a("span",{staticClass:"line-number"},[n._v("57")]),a("br"),a("span",{staticClass:"line-number"},[n._v("58")]),a("br"),a("span",{staticClass:"line-number"},[n._v("59")]),a("br"),a("span",{staticClass:"line-number"},[n._v("60")]),a("br"),a("span",{staticClass:"line-number"},[n._v("61")]),a("br"),a("span",{staticClass:"line-number"},[n._v("62")]),a("br"),a("span",{staticClass:"line-number"},[n._v("63")]),a("br"),a("span",{staticClass:"line-number"},[n._v("64")]),a("br"),a("span",{staticClass:"line-number"},[n._v("65")]),a("br"),a("span",{staticClass:"line-number"},[n._v("66")]),a("br"),a("span",{staticClass:"line-number"},[n._v("67")]),a("br"),a("span",{staticClass:"line-number"},[n._v("68")]),a("br"),a("span",{staticClass:"line-number"},[n._v("69")]),a("br"),a("span",{staticClass:"line-number"},[n._v("70")]),a("br"),a("span",{staticClass:"line-number"},[n._v("71")]),a("br"),a("span",{staticClass:"line-number"},[n._v("72")]),a("br"),a("span",{staticClass:"line-number"},[n._v("73")]),a("br"),a("span",{staticClass:"line-number"},[n._v("74")]),a("br")])]),a("p",[n._v("主要是增加了 Ribbon 的依赖")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("    <dependency>\n        <groupId>org.springframework.cloud</groupId>\n        <artifactId>spring-cloud-starter-netflix-ribbon</artifactId>\n    </dependency>\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br")])]),a("h3",{attrs:{id:"application"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#application"}},[n._v("#")]),n._v(" Application")]),n._v(" "),a("p",[n._v("通过 "),a("code",[n._v("@EnableDiscoveryClient")]),n._v(" 注解注册到服务中心")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("    package com.cmcc.hello.spring.cloud.web.admin.ribbon;\n    \n    import org.springframework.boot.SpringApplication;\n    import org.springframework.boot.autoconfigure.SpringBootApplication;\n    import org.springframework.cloud.client.discovery.EnableDiscoveryClient;\n    \n    @SpringBootApplication\n    @EnableDiscoveryClient\n    public class WebAdminRibbonApplication {\n        public static void main(String[] args) {\n            SpringApplication.run(WebAdminRibbonApplication.class, args);\n        }\n    }\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br")])]),a("h3",{attrs:{id:"application-yml"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#application-yml"}},[n._v("#")]),n._v(" application.yml")]),n._v(" "),a("p",[n._v("设置程序端口号为："),a("code",[n._v("8764")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("    spring:\n      application:\n        name: hello-spring-cloud-web-admin-ribbon\n      thymeleaf:\n        cache: false\n        mode: LEGACYHTML5\n        encoding: UTF-8\n        servlet:\n          content-type: text/html\n    \n    server:\n      port: 8764\n    \n    eureka:\n      client:\n        serviceUrl:\n          defaultZone: http://localhost:8761/eureka/\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br")])]),a("h3",{attrs:{id:"configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuration"}},[n._v("#")]),n._v(" Configuration")]),n._v(" "),a("p",[n._v("配置注入 "),a("code",[n._v("RestTemplate")]),n._v(" 的 Bean，并通过 "),a("code",[n._v("@LoadBalanced")]),n._v(" 注解表明开启负载均衡功能")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("    package com.cmcc.hello.spring.cloud.web.admin.ribbon.config;\n    \n    import org.springframework.cloud.client.loadbalancer.LoadBalanced;\n    import org.springframework.context.annotation.Bean;\n    import org.springframework.context.annotation.Configuration;\n    import org.springframework.web.client.RestTemplate;\n    \n    @Configuration\n    public class RestTemplateConfiguration {\n    \n        @Bean\n        @LoadBalanced\n        public RestTemplate restTemplate() {\n            return new RestTemplate();\n        }\n    }\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br")])]),a("h3",{attrs:{id:"创建测试用的-service"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建测试用的-service"}},[n._v("#")]),n._v(" 创建测试用的 Service")]),n._v(" "),a("p",[n._v("在这里我们直接用的程序名替代了具体的 URL 地址，在 Ribbon 中它会根据服务名来选择具体的服务实例，根据服务实例在请求的时候会用具体的 URL 替换掉服务名，代码如下：")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('    package com.cmcc.hello.spring.cloud.web.admin.ribbon.service;\n    \n    import org.springframework.beans.factory.annotation.Autowired;\n    import org.springframework.stereotype.Service;\n    import org.springframework.web.client.RestTemplate;\n    \n    @Service\n    public class AdminService {\n    \n        @Autowired\n        private RestTemplate restTemplate;\n    \n        public String sayHi(String message) {\n            return restTemplate.getForObject("http://HELLO-SPRING-CLOUD-SERVICE-ADMIN/hi?message=" + message, String.class);\n        }\n    }\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br")])]),a("h3",{attrs:{id:"创建测试用的-controller"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建测试用的-controller"}},[n._v("#")]),n._v(" 创建测试用的 Controller")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('    package com.cmcc.hello.spring.cloud.web.admin.ribbon.controller;\n    \n    import com.cmcc.hello.spring.cloud.web.admin.ribbon.service.AdminService;\n    import org.springframework.beans.factory.annotation.Autowired;\n    import org.springframework.web.bind.annotation.RequestMapping;\n    import org.springframework.web.bind.annotation.RequestMethod;\n    import org.springframework.web.bind.annotation.RequestParam;\n    import org.springframework.web.bind.annotation.RestController;\n    \n    @RestController\n    public class AdminController {\n    \n        @Autowired\n        private AdminService adminService;\n    \n        @RequestMapping(value = "hi", method = RequestMethod.GET)\n        public String sayHi(@RequestParam String message) {\n            return adminService.sayHi(message);\n        }\n    }\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br")])]),a("h3",{attrs:{id:"测试访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试访问"}},[n._v("#")]),n._v(" 测试访问")]),n._v(" "),a("p",[n._v("在浏览器上多次访问 http://localhost:8764/hi?message=HelloRibbon")]),n._v(" "),a("p",[n._v("浏览器交替显示：")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('    Hi，your message is :"HelloRibbon" i am from port：8762\n    Hi，your message is :"HelloRibbon" i am from port：8763\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br")])]),a("p",[n._v("请求成功则表示我们已经成功实现了负载均衡功能来访问不同端口的实例")]),n._v(" "),a("h2",{attrs:{id:"此时的架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#此时的架构"}},[n._v("#")]),n._v(" 此时的架构")]),n._v(" "),a("p",[a("img",{attrs:{src:"/img/201805292246004.png",alt:""}})]),n._v(" "),a("ul",[a("li",[n._v("一个服务注册中心，Eureka Server，端口号为："),a("code",[n._v("8761")])]),n._v(" "),a("li",[a("code",[n._v("service-admin")]),n._v(" 工程运行了两个实例，端口号分别为："),a("code",[n._v("8762")]),n._v("，"),a("code",[n._v("8763")])]),n._v(" "),a("li",[a("code",[n._v("web-admin-ribbon")]),n._v(" 工程端口号为："),a("code",[n._v("8764")])]),n._v(" "),a("li",[a("code",[n._v("web-admin-ribbon")]),n._v(" 通过 "),a("code",[n._v("RestTemplate")]),n._v(" 调用 "),a("code",[n._v("service-admin")]),n._v(" 接口时因为启用了负载均衡功能故会轮流调用它的 "),a("code",[n._v("8762")]),n._v(" 和 "),a("code",[n._v("8763")]),n._v(" 端口")])]),n._v(" "),a("h2",{attrs:{id:"附"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#附"}},[n._v("#")]),n._v(" 附")]),n._v(" "),a("h3",{attrs:{id:"在-idea-中配置一个工程启动多个实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在-idea-中配置一个工程启动多个实例"}},[n._v("#")]),n._v(" 在 IDEA 中配置一个工程启动多个实例")]),n._v(" "),a("h4",{attrs:{id:"步骤一"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤一"}},[n._v("#")]),n._v(" 步骤一")]),n._v(" "),a("p",[n._v("点击 "),a("code",[n._v("Run -> Edit Configurations...")])]),n._v(" "),a("p",[a("img",{attrs:{src:"/img/201805292246005.png",alt:""}})]),n._v(" "),a("h4",{attrs:{id:"步骤二"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤二"}},[n._v("#")]),n._v(" 步骤二")]),n._v(" "),a("p",[n._v("选择需要启动多实例的项目并去掉 "),a("code",[n._v("Single instance only")]),n._v(" 前面的勾")]),n._v(" "),a("p",[a("img",{attrs:{src:"/img/201805292246006.png",alt:""}})]),n._v(" "),a("h4",{attrs:{id:"步骤三"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤三"}},[n._v("#")]),n._v(" 步骤三")]),n._v(" "),a("p",[n._v("通过修改 "),a("code",[n._v("application.yml")]),n._v(" 配置文件的 "),a("code",[n._v("server.port")]),n._v(" 的端口，启动多个实例，需要多个端口，分别进行启动即可。")])])}),[],!1,null,null,null);s.default=r.exports}}]);