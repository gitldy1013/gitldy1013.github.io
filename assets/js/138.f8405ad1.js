(window.webpackJsonp=window.webpackJsonp||[]).push([[138],{834:function(s,a,e){"use strict";e.r(a);var t=e(5),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"kubernetes核心技术-controller"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes核心技术-controller"}},[s._v("#")]),s._v(" Kubernetes核心技术-Controller")]),s._v(" "),e("h2",{attrs:{id:"内容"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#内容"}},[s._v("#")]),s._v(" 内容")]),s._v(" "),e("ul",[e("li",[s._v("什么是Controller")]),s._v(" "),e("li",[s._v("Pod和Controller的关系")]),s._v(" "),e("li",[s._v("Deployment控制器应用场景")]),s._v(" "),e("li",[s._v("yaml文件字段说明")]),s._v(" "),e("li",[s._v("Deployment控制器部署应用")]),s._v(" "),e("li",[s._v("升级回滚")]),s._v(" "),e("li",[s._v("弹性伸缩")])]),s._v(" "),e("h2",{attrs:{id:"什么是controller"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#什么是controller"}},[s._v("#")]),s._v(" 什么是Controller")]),s._v(" "),e("p",[s._v("Controller是在集群上管理和运行容器的对象，Controller是实际存在的，Pod是虚拟机的")]),s._v(" "),e("h2",{attrs:{id:"pod和controller的关系"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pod和controller的关系"}},[s._v("#")]),s._v(" Pod和Controller的关系")]),s._v(" "),e("p",[s._v("Pod是通过Controller实现应用的运维，比如弹性伸缩，滚动升级等")]),s._v(" "),e("p",[s._v("Pod 和 Controller之间是通过label标签来建立关系，同时Controller又被称为控制器工作负载")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20201116092431237.png",alt:"image-20201116092431237"}})]),s._v(" "),e("h2",{attrs:{id:"deployment控制器应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#deployment控制器应用"}},[s._v("#")]),s._v(" Deployment控制器应用")]),s._v(" "),e("ul",[e("li",[s._v("Deployment控制器可以部署无状态应用")]),s._v(" "),e("li",[s._v("管理Pod和ReplicaSet")]),s._v(" "),e("li",[s._v("部署，滚动升级等功能")]),s._v(" "),e("li",[s._v("应用场景：web服务，微服务")])]),s._v(" "),e("p",[s._v("Deployment表示用户对K8S集群的一次更新操作。Deployment是一个比RS( Replica Set, RS) 应用模型更广的 API 对象，可以是创建一个新的服务，更新一个新的服务，也可以是滚动升级一个服务。滚动升级一个服务，实际是创建一个新的RS，然后逐渐将新 RS 中副本数增加到理想状态，将旧RS中的副本数减少到0的复合操作。")]),s._v(" "),e("p",[s._v("这样一个复合操作用一个RS是不好描述的，所以用一个更通用的Deployment来描述。以K8S的发展方向，未来对所有长期伺服型的业务的管理，都会通过Deployment来管理。")]),s._v(" "),e("h2",{attrs:{id:"deployment部署应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#deployment部署应用"}},[s._v("#")]),s._v(" Deployment部署应用")]),s._v(" "),e("p",[s._v("之前我们也使用Deployment部署过应用，如下代码所示")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectrl create deployment web --image"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("但是上述代码不是很好的进行复用，因为每次我们都需要重新输入代码，所以我们都是通过YAML进行配置")]),s._v(" "),e("p",[s._v("但是我们可以尝试使用上面的代码创建一个镜像【只是尝试，不会创建】")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl create deployment web --image"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx --dry-run -o yaml "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" nginx.yaml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("然后输出一个yaml配置文件 "),e("code",[s._v("nginx.yml")]),s._v(" ，配置文件如下所示")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  creationTimestamp: null\n  labels:\n    app: web\n  name: web\nspec:\n  replicas: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  selector:\n    matchLabels:\n      app: web\n  strategy: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        app: web\n    spec:\n      containers:\n      - image: nginx\n        name: nginx\n        resources: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nstatus: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br")])]),e("p",[s._v("我们看到的 selector 和 label 就是我们Pod 和 Controller之间建立关系的桥梁")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20201116093638951.png",alt:"image-20201116093638951"}})]),s._v(" "),e("h3",{attrs:{id:"使用yaml创建pod"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用yaml创建pod"}},[s._v("#")]),s._v(" 使用YAML创建Pod")]),s._v(" "),e("p",[s._v("通过刚刚的代码，我们已经生成了YAML文件，下面我们就可以使用该配置文件快速创建Pod镜像了")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl apply -f nginx.yaml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"/images/image-20201116094046007.png",alt:"image-20201116094046007"}})]),s._v(" "),e("p",[s._v("但是因为这个方式创建的，我们只能在集群内部进行访问，所以我们还需要对外暴露端口")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl expose deployment web --port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --type"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NodePort --target-port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("web1\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("关于上述命令，有几个参数")]),s._v(" "),e("ul",[e("li",[s._v("--port：就是我们内部的端口号")]),s._v(" "),e("li",[s._v("--target-port：就是暴露外面访问的端口号")]),s._v(" "),e("li",[s._v("--name：名称")]),s._v(" "),e("li",[s._v("--type：类型")])]),s._v(" "),e("p",[s._v("同理，我们一样可以导出对应的配置文件")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl expose deployment web --port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --type"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NodePort --target-port"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --name"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("web1 -o yaml "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" web1.yaml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("得到的web1.yaml如下所示")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("apiVersion: v1\nkind: Service\nmetadata:\n  creationTimestamp: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2020-11-16T02:26:53Z"')]),s._v("\n  labels:\n    app: web\n  managedFields:\n  - apiVersion: v1\n    fieldsType: FieldsV1\n    fieldsV1:\n      f:metadata:\n        f:labels:\n          .: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n          f:app: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      f:spec:\n        f:externalTrafficPolicy: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        f:ports:\n          .: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n          k:"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"port"')]),s._v(":80,"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"protocol"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TCP"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(":\n            .: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            f:port: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            f:protocol: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            f:targetPort: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        f:selector:\n          .: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n          f:app: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        f:sessionAffinity: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        f:type: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    manager: kubectl\n    operation: Update\n    time: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2020-11-16T02:26:53Z"')]),s._v("\n  name: web2\n  namespace: default\n  resourceVersion: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"113693"')]),s._v("\n  selfLink: /api/v1/namespaces/default/services/web2\n  uid: d570437d-a6b4-4456-8dfb-950f09534516\nspec:\n  clusterIP: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.104")]),s._v(".174.145\n  externalTrafficPolicy: Cluster\n  ports:\n  - nodePort: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("32639")]),s._v("\n    port: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    protocol: TCP\n    targetPort: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n  selector:\n    app: web\n  sessionAffinity: None\n  type: NodePort\nstatus:\n  loadBalancer: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br")])]),e("p",[s._v("然后我们可以通过下面的命令来查看对外暴露的服务")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl get pods,svc\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"/images/image-20201116104021357.png",alt:"image-20201116104021357"}})]),s._v(" "),e("p",[s._v("然后我们访问对应的url，即可看到 nginx了 "),e("code",[s._v("http://192.168.177.130:32639/")])]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20201116104131968.png",alt:"image-20201116104131968"}})]),s._v(" "),e("h2",{attrs:{id:"升级回滚和弹性伸缩"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#升级回滚和弹性伸缩"}},[s._v("#")]),s._v(" 升级回滚和弹性伸缩")]),s._v(" "),e("ul",[e("li",[s._v("升级：  假设从版本为1.14 升级到 1.15 ，这就叫应用的升级【升级可以保证服务不中断】")]),s._v(" "),e("li",[s._v("回滚：从版本1.15 变成 1.14，这就叫应用的回滚")]),s._v(" "),e("li",[s._v("弹性伸缩：我们根据不同的业务场景，来改变Pod的数量对外提供服务，这就是弹性伸缩")])]),s._v(" "),e("h3",{attrs:{id:"应用升级和回滚"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#应用升级和回滚"}},[s._v("#")]),s._v(" 应用升级和回滚")]),s._v(" "),e("p",[s._v("首先我们先创建一个 1.14版本的Pod")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  creationTimestamp: null\n  labels:\n    app: web\n  name: web\nspec:\n  replicas: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  selector:\n    matchLabels:\n      app: web\n  strategy: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        app: web\n    spec:\n      containers:\n      - image: nginx:1.14\n        name: nginx\n        resources: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nstatus: "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br")])]),e("p",[s._v("我们先指定版本为1.14，然后开始创建我们的Pod")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl apply -f nginx.yaml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("同时，我们使用docker images命令，就能看到我们成功拉取到了一个 1.14版本的镜像")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20201116105710966.png",alt:"image-20201116105710966"}})]),s._v(" "),e("p",[s._v("我们使用下面的命令，可以将nginx从 1.14 升级到 1.15")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" image deployment web "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nginx")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx:1.15\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("在我们执行完命令后，能看到升级的过程")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20201116105847069.png",alt:"image-20201116105847069"}})]),s._v(" "),e("ul",[e("li",[s._v("首先是开始的nginx 1.14版本的Pod在运行，然后 1.15版本的在创建")]),s._v(" "),e("li",[s._v("然后在1.15版本创建完成后，就会暂停1.14版本")]),s._v(" "),e("li",[s._v("最后把1.14版本的Pod移除，完成我们的升级")])]),s._v(" "),e("p",[s._v("我们在下载 1.15版本，容器就处于ContainerCreating状态，然后下载完成后，就用 1.15版本去替换1.14版本了，这么做的好处就是：升级可以保证服务不中断")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20201116111614085.png",alt:"image-20201116111614085"}})]),s._v(" "),e("p",[s._v("我们到我们的node2节点上，查看我们的 docker images;")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20201116111315000.png",alt:"image-20201116111315000"}})]),s._v(" "),e("p",[s._v("能够看到，我们已经成功拉取到了 1.15版本的nginx了")]),s._v(" "),e("h4",{attrs:{id:"查看升级状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看升级状态"}},[s._v("#")]),s._v(" 查看升级状态")]),s._v(" "),e("p",[s._v("下面可以，查看升级状态")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl rollout status deployment web\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"/images/image-20201116112139645.png",alt:"image-20201116112139645"}})]),s._v(" "),e("h4",{attrs:{id:"查看历史版本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看历史版本"}},[s._v("#")]),s._v(" 查看历史版本")]),s._v(" "),e("p",[s._v("我们还可以查看历史版本")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl rollout "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v(" deployment web\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h4",{attrs:{id:"应用回滚"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#应用回滚"}},[s._v("#")]),s._v(" 应用回滚")]),s._v(" "),e("p",[s._v("我们可以使用下面命令，完成回滚操作，也就是回滚到上一个版本")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl rollout undo deployment web\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("然后我们就可以查看状态")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl rollout status deployment web\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("img",{attrs:{src:"/images/image-20201116112524601.png",alt:"image-20201116112524601"}})]),s._v(" "),e("p",[s._v("同时我们还可以回滚到指定版本")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl rollout undo deployment web --to-revision"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"弹性伸缩"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#弹性伸缩"}},[s._v("#")]),s._v(" 弹性伸缩")]),s._v(" "),e("p",[s._v("弹性伸缩，也就是我们通过命令一下创建多个副本")]),s._v(" "),e("div",{staticClass:"language-shell script line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl scale deployment web --replicas"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("能够清晰看到，我们一下创建了10个副本")]),s._v(" "),e("p",[e("img",{attrs:{src:"/images/image-20201117092841865.png",alt:"image-20201117092841865"}})])])}),[],!1,null,null,null);a.default=n.exports}}]);